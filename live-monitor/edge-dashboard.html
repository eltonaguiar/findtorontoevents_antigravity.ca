<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edge Finder | High Conviction Trades</title>
    <style>
        :root {
            --bg: #0a0a1a; --card: #12122a; --card2: #1a1a3a; --border: #2a2a4a;
            --text: #e0e0f0; --dim: #8888aa; --accent: #6366f1;
            --green: #22c55e; --red: #ef4444; --yellow: #eab308; --blue: #3b82f6;
            --gold: #fbbf24; --purple: #a855f7; --radius: 12px;
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; background:var(--bg); color:var(--text); min-height:100vh; }
        a { color:var(--accent); text-decoration:none; }

        .header { background:linear-gradient(135deg,#12122a,#1e1e3f); border-bottom:1px solid var(--border); padding:1.5rem 2rem 1rem; text-align:center; }
        .header h1 { font-size:2.2rem; background:linear-gradient(135deg,var(--gold),var(--green),var(--accent)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
        .header p { color:var(--dim); font-size:0.95rem; margin-top:0.3rem; }
        .nav { display:flex; gap:1.5rem; justify-content:center; margin-top:0.8rem; font-size:0.9rem; flex-wrap:wrap; }
        .nav a { color:var(--dim); } .nav a:hover { color:var(--text); }

        .container { max-width:1400px; margin:0 auto; padding:1.5rem; }

        /* Market status */
        .market-status { display:flex; gap:1rem; align-items:center; justify-content:center; padding:0.8rem; background:var(--card); border:1px solid var(--border); border-radius:var(--radius); margin-bottom:1.5rem; font-size:0.85rem; flex-wrap:wrap; }
        .status-dot { width:10px; height:10px; border-radius:50%; display:inline-block; margin-right:4px; }
        .status-dot.on { background:var(--green); box-shadow:0 0 8px var(--green); }
        .status-dot.off { background:var(--red); }
        .status-dot.warn { background:var(--yellow); box-shadow:0 0 6px var(--yellow); }

        /* Key insight banner */
        .insight-banner { background:linear-gradient(135deg,rgba(251,191,36,0.1),rgba(34,197,94,0.1)); border:1px solid var(--gold); border-radius:var(--radius); padding:1.2rem 1.5rem; margin-bottom:1.5rem; }
        .insight-banner h3 { color:var(--gold); font-size:1rem; margin-bottom:0.4rem; }
        .insight-banner .stat-row { display:flex; gap:2rem; flex-wrap:wrap; }
        .insight-banner .stat { font-size:0.9rem; }
        .insight-banner .stat b { color:var(--green); font-size:1.2rem; }

        /* Conviction cards */
        .tier-section { margin-bottom:2rem; }
        .tier-header { display:flex; align-items:center; gap:0.8rem; margin-bottom:1rem; }
        .tier-header h2 { font-size:1.2rem; }
        .tier-badge { padding:0.2rem 0.8rem; border-radius:20px; font-size:0.75rem; font-weight:700; }
        .tier-badge.very-high { background:rgba(34,197,94,0.2); color:var(--green); border:1px solid var(--green); }
        .tier-badge.high { background:rgba(99,102,241,0.2); color:var(--accent); border:1px solid var(--accent); }
        .tier-badge.medium { background:rgba(234,179,8,0.2); color:var(--yellow); border:1px solid var(--yellow); }

        .setup-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(340px,1fr)); gap:1rem; }
        .setup-card { background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:1.2rem; transition:transform 0.2s,box-shadow 0.2s; }
        .setup-card:hover { transform:translateY(-2px); box-shadow:0 4px 20px rgba(99,102,241,0.15); }
        .setup-card.very-high { border-left:3px solid var(--green); }
        .setup-card.high { border-left:3px solid var(--accent); }
        .setup-card.medium { border-left:3px solid var(--yellow); }

        .card-top { display:flex; justify-content:space-between; align-items:center; margin-bottom:0.8rem; }
        .card-ticker { font-size:1.5rem; font-weight:800; }
        .card-conviction { font-size:0.8rem; padding:0.2rem 0.6rem; border-radius:8px; font-weight:600; }

        .card-metrics { display:grid; grid-template-columns:1fr 1fr 1fr; gap:0.5rem; margin-bottom:0.8rem; }
        .metric { text-align:center; padding:0.4rem; background:var(--bg); border-radius:6px; }
        .metric .label { font-size:0.65rem; color:var(--dim); text-transform:uppercase; }
        .metric .val { font-size:1rem; font-weight:700; }

        .card-levels { display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:0.6rem; padding:0.5rem; background:var(--bg); border-radius:6px; }
        .level-item { text-align:center; }
        .level-item .lbl { color:var(--dim); font-size:0.7rem; }

        .card-sources { font-size:0.75rem; color:var(--dim); border-top:1px solid var(--border); padding-top:0.6rem; margin-top:0.4rem; }
        .card-sources .src-tag { display:inline-block; padding:0.1rem 0.4rem; border-radius:3px; background:rgba(99,102,241,0.15); color:var(--accent); margin:0.1rem 0.2rem 0.1rem 0; font-size:0.7rem; }

        .badge { display:inline-block; padding:0.1rem 0.4rem; border-radius:4px; font-size:0.75rem; font-weight:600; }
        .badge-green { background:rgba(34,197,94,0.15); color:var(--green); }
        .badge-red { background:rgba(239,68,68,0.15); color:var(--red); }
        .badge-gold { background:rgba(251,191,36,0.15); color:var(--gold); }

        /* Edge algo table */
        .section { background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:1.5rem; margin-bottom:1.5rem; }
        .section h2 { font-size:1.1rem; margin-bottom:1rem; }
        table { width:100%; border-collapse:collapse; font-size:0.85rem; }
        th { text-align:left; padding:0.5rem 0.8rem; background:var(--bg); color:var(--dim); font-size:0.75rem; text-transform:uppercase; }
        td { padding:0.5rem 0.8rem; border-bottom:1px solid rgba(42,42,74,0.5); }
        tr:hover td { background:var(--card2); }

        .loading { text-align:center; padding:3rem; color:var(--dim); }
        .no-data { text-align:center; padding:2rem; color:var(--dim); font-style:italic; }
        .refresh-info { text-align:center; font-size:0.8rem; color:var(--dim); margin-top:0.5rem; }

        /* Glossary / Education */
        .info-tip{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border-radius:50%;background:rgba(99,102,241,0.2);color:var(--accent);font-size:10px;font-weight:700;cursor:help;position:relative;vertical-align:middle;margin-left:4px;flex-shrink:0;font-style:normal}
        .info-tip:hover{background:rgba(99,102,241,0.4)}
        .info-tip .tip-text{display:none;position:absolute;bottom:calc(100% + 8px);left:50%;transform:translateX(-50%);background:#1e1e3a;border:1px solid var(--accent);border-radius:8px;padding:10px 12px;font-size:12px;font-weight:400;color:var(--text);width:260px;line-height:1.5;z-index:100;box-shadow:0 4px 20px rgba(0,0,0,0.5);pointer-events:none}
        .info-tip:hover .tip-text{display:block}
        .info-tip .tip-text::after{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:6px solid transparent;border-top-color:var(--accent)}
        .edu-section{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);margin-top:1.5rem;overflow:hidden}
        .edu-header{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;cursor:pointer;user-select:none}
        .edu-header:hover{background:rgba(255,255,255,0.02)}
        .edu-header h3{font-size:15px;font-weight:600;margin:0;display:flex;align-items:center;gap:8px}
        .edu-arrow{font-size:12px;color:var(--dim);transition:transform 0.2s}
        .edu-arrow.open{transform:rotate(180deg)}
        .edu-body{padding:0 18px 18px;display:none}
        .edu-body.open{display:block}
        .glossary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:10px;margin-top:8px}
        .glossary-card{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);border-radius:8px;padding:12px}
        .glossary-card .g-term{font-weight:700;color:#fff;font-size:13px;margin-bottom:4px}
        .glossary-card .g-desc{font-size:12px;color:#bbb;line-height:1.6}
        .glossary-card .g-why{font-size:11px;color:var(--dim);margin-top:5px;font-style:italic}

        @media (max-width:768px) { .setup-grid { grid-template-columns:1fr; } .container { padding:1rem; } .header h1 { font-size:1.6rem; } .glossary-grid{grid-template-columns:1fr} .info-tip .tip-text{width:200px;left:0;transform:none} }
    </style>
</head>
<body>
    <div class="header">
        <h1>Edge Finder</h1>
        <p>High conviction trades — CDR stocks, zero commission, 72-86% proven win rate algorithms</p>
        <div class="nav">
            <a href="live-monitor.html">Live Monitor</a>
            <a href="sports-betting.html">Sports Betting</a>
            <a href="winning-patterns.html">Winning Patterns</a>
            <a href="hour-learning.html">Hour Learning</a>
            <a href="/findstocks/portfolio2/consolidated.html">Consensus Picks</a>
            <a href="/investments/">All Investments</a>
        </div>
    </div>

    <div class="container">
        <!-- Market Status -->
        <div class="market-status" id="marketStatus">
            <span><span class="status-dot off" id="stockDot"></span> Stocks: Loading...</span>
            <span><span class="status-dot on"></span> Crypto: 24/7</span>
            <span><span class="status-dot warn" id="fxDot"></span> Forex: Loading...</span>
            <span id="timeDisplay"></span>
        </div>

        <!-- Key Insight -->
        <div class="insight-banner" id="insightBanner">
            <h3>Why This Works</h3>
            <div class="stat-row">
                <div class="stat"><b>85%</b> Cursor Genius win rate <span style="font-size:0.7rem;color:var(--dim)">(backtest)</span></div>
                <div class="stat"><b>82%</b> ETF Masters win rate <span style="font-size:0.7rem;color:var(--dim)">(backtest)</span></div>
                <div class="stat"><b>80%</b> Blue Chip Growth win rate <span style="font-size:0.7rem;color:var(--dim)">(backtest)</span></div>
                <div class="stat"><b>$0</b> CDR commission</div>
            </div>
            <div style="font-size:0.72rem;color:var(--dim);margin-top:0.5rem;">Win rates shown are from historical backtesting and may differ from live performance.</div>
        </div>

        <!-- Setups -->
        <div id="setupsContainer"><div class="loading">Scanning for high-conviction setups across all algorithms...</div></div>

        <!-- Edge Algorithm Performance -->
        <div class="section">
            <h2>Algorithm Edge Statistics</h2>
            <table>
                <thead><tr><th>Algorithm</th><th>Source</th><th>Proven WR</th><th>Min Score</th><th>Edge?</th></tr></thead>
                <tbody id="edgeTable"><tr><td colspan="5" class="loading">Loading algorithm edge statistics...</td></tr></tbody>
            </table>
        </div>

        <!-- Historical Performance -->
        <div class="section">
            <h2>Historical Edge-Filtered Performance (Last 30 Days)</h2>
            <div id="historyStats" class="loading">Loading 30-day historical performance data...</div>
            <div style="overflow-x:auto;margin-top:1rem">
                <table>
                    <thead><tr><th>Ticker</th><th>Algorithm</th><th>Entry</th><th>Latest</th><th>Return</th><th>Score</th><th>Date</th></tr></thead>
                    <tbody id="historyTable"></tbody>
                </table>
            </div>
        </div>

        <!-- ═══ GLOSSARY ═══ -->
        <div class="edu-section">
          <div class="edu-header" onclick="toggleEdu(this)">
            <h3>Glossary of Terms <i class="info-tip">i<span class="tip-text">Plain-language explanations of every term on this page.</span></i></h3>
            <span class="edu-arrow">&#9660;</span>
          </div>
          <div class="edu-body">
            <div class="glossary-grid">
              <div class="glossary-card">
                <div class="g-term">CDR (Canadian Depository Receipt)</div>
                <div class="g-desc">A way to buy fractions of US stocks (like Apple, Google) on Canadian exchanges in Canadian dollars. CDRs trade on NEO Exchange and TSX. <strong>Commission-free</strong> on platforms like Wealthsimple Trade and Neo.</div>
                <div class="g-why">Why it matters: $0 commission means even small gains are pure profit — no fees eating into your returns.</div>
              </div>
              <div class="glossary-card">
                <div class="g-term">Conviction Tier</div>
                <div class="g-desc"><strong>VERY HIGH</strong> — multiple independent algorithms + multiple data sources all agree. Strongest consensus.<br><strong>HIGH</strong> — strong algorithm agreement with solid technical backing.<br><strong>MEDIUM</strong> — single strong signal or weaker multi-signal alignment.</div>
                <div class="g-why">Higher conviction = more independent systems agreeing = lower chance of being wrong.</div>
              </div>
              <div class="glossary-card">
                <div class="g-term">Win Rate</div>
                <div class="g-desc">Percentage of past trades from this algorithm that made money. Example: "85% win rate" means 85 out of 100 trades were profitable based on 30-day historical backtesting.</div>
                <div class="g-why">We only use algorithms with 72%+ proven win rate — well above the 50% coin-flip threshold.</div>
              </div>
              <div class="glossary-card">
                <div class="g-term">Algorithm Consensus</div>
                <div class="g-desc">When multiple independent stock-picking systems (stock_picks, miracle v2, miracle v3) all recommend the same ticker. Each uses different logic, so agreement is meaningful — not echo-chamber overlap.</div>
                <div class="g-why">One algorithm being right could be luck. Three independent ones agreeing is a pattern.</div>
              </div>
              <div class="glossary-card">
                <div class="g-term">Edge</div>
                <div class="g-desc">A statistical advantage over random chance. If a strategy wins 70% of the time, the "edge" is 20% above the 50/50 baseline. The Edge Finder specifically looks for setups where the historical edge is largest.</div>
              </div>
              <div class="glossary-card">
                <div class="g-term">Backtested</div>
                <div class="g-desc">Tested against historical data. "30-day backtest" means we replayed the last 30 days of real market data through the algorithm to see how it would have performed. <strong>Caution:</strong> past performance does not guarantee future results.</div>
              </div>
            </div>
          </div>
        </div>

        <div class="refresh-info" id="refreshInfo">Auto-refreshes every 5 minutes during market hours</div>
        <div class="refresh-info" id="lastUpdated" style="margin-top:0.3rem">Last updated: --</div>
        <div style="text-align:center;font-size:0.75rem;color:#555;margin-top:1rem;padding:0.8rem;border:1px solid rgba(255,255,255,0.04);border-radius:8px">
          <strong>Not financial advice.</strong> For educational and research purposes only. Past performance does not guarantee future results. Always do your own research before trading.
        </div>
    </div>

<script>
function toggleEdu(el){var b=el.nextElementSibling,a=el.querySelector('.edu-arrow');if(b.classList.contains('open')){b.classList.remove('open');a.classList.remove('open');}else{b.classList.add('open');a.classList.add('open');}}
var API = window.location.hostname === 'localhost' ? 'api' : '/live-monitor/api';
var refreshTimer = null;

function apiGet(url, cb) {
    var x = new XMLHttpRequest();
    x.open('GET', API + '/' + url, true);
    x.onload = function() {
        try { cb(JSON.parse(x.responseText)); } catch(e) { cb({ok:false}); }
    };
    x.onerror = function() { cb({ok:false}); };
    x.send();
}

function loadAll() {
    loadMarket();
    loadSetups();
    loadEdgeStats();
    loadHistory();
}

function loadMarket() {
    apiGet('edge_finder.php?action=market', function(d) {
        if (!d.ok) return;
        var stockDot = document.getElementById('stockDot');
        var fxDot = document.getElementById('fxDot');
        if (d.stock_market_open) {
            stockDot.className = 'status-dot on';
            stockDot.parentElement.innerHTML = '<span class="status-dot on"></span> Stocks: OPEN';
        } else {
            stockDot.className = 'status-dot off';
            stockDot.parentElement.innerHTML = '<span class="status-dot off"></span> Stocks: Closed' + (d.next_stock_open ? ' (next: ' + d.next_stock_open + ')' : '');
        }
        if (d.forex_market === 'open (Mon-Fri)') {
            fxDot.className = 'status-dot on';
            fxDot.parentElement.innerHTML = '<span class="status-dot on"></span> Forex: Open';
        } else {
            fxDot.className = 'status-dot off';
            fxDot.parentElement.innerHTML = '<span class="status-dot off"></span> Forex: ' + d.forex_market;
        }
        document.getElementById('timeDisplay').textContent = d.current_time_est + ' EST (' + d.day_of_week + ')';
    });
}

function loadSetups() {
    apiGet('edge_finder.php?action=scan', function(d) {
        if (!d.ok || d.total_setups === 0) {
            document.getElementById('setupsContainer').innerHTML = '<div class="no-data">No high-conviction setups found in the last 3 days. Check back after market close when algorithms run.</div>';
            return;
        }
        var html = '';
        var tiers = [
            {conf: 'VERY HIGH', cls: 'very-high', label: 'VERY HIGH', color: 'var(--green)'},
            {conf: 'HIGH', cls: 'high', label: 'HIGH', color: 'var(--accent)'},
            {conf: 'MEDIUM', cls: 'medium', label: 'MEDIUM', color: 'var(--yellow)'}
        ];

        for (var t = 0; t < tiers.length; t++) {
            var tier = tiers[t];
            var setups = [];
            for (var i = 0; i < d.setups.length; i++) {
                if (d.setups[i].confidence === tier.conf) setups.push(d.setups[i]);
            }
            if (setups.length === 0) continue;

            html += '<div class="tier-section"><div class="tier-header"><h2>' + tier.label + ' Conviction</h2><span class="tier-badge ' + tier.cls + '">' + setups.length + ' setup' + (setups.length > 1 ? 's' : '') + '</span></div><div class="setup-grid">';

            for (var j = 0; j < setups.length; j++) {
                var s = setups[j];
                var retCls = s.current_return_pct > 0 ? 'green' : (s.current_return_pct < 0 ? 'red' : 'dim');
                var retSign = s.current_return_pct > 0 ? '+' : '';

                // Source tags
                var srcHtml = '';
                for (var k = 0; k < s.sources.length; k++) {
                    srcHtml += '<span class="src-tag">' + s.sources[k].system + ': ' + s.sources[k].algorithm + ' (' + s.sources[k].proven_wr + '% WR)</span> ';
                }

                html += '<div class="setup-card ' + tier.cls + '">' +
                    '<div class="card-top">' +
                        '<div><span class="card-ticker">' + s.ticker + '</span> <span class="badge badge-gold">' + s.direction + '</span> <span class="badge badge-green">CDR $0</span></div>' +
                        '<div class="card-conviction" style="background:rgba(251,191,36,0.15);color:var(--gold)">' + s.conviction_score + ' pts</div>' +
                    '</div>' +
                    '<div class="card-metrics">' +
                        '<div class="metric"><div class="label">Algos</div><div class="val" style="color:var(--accent)">' + s.algo_count + '</div></div>' +
                        '<div class="metric"><div class="label">Systems</div><div class="val" style="color:var(--purple)">' + s.system_count + '</div></div>' +
                        '<div class="metric"><div class="label">Avg WR</div><div class="val" style="color:var(--green)">' + s.avg_proven_wr + '%</div></div>' +
                    '</div>' +
                    '<div class="card-metrics">' +
                        '<div class="metric"><div class="label">Entry</div><div class="val">$' + s.avg_entry.toFixed(2) + '</div></div>' +
                        '<div class="metric"><div class="label">Latest</div><div class="val">$' + (s.latest_price > 0 ? s.latest_price.toFixed(2) : '?') + '</div></div>' +
                        '<div class="metric"><div class="label">Return</div><div class="val" style="color:var(--' + retCls + ')">' + retSign + s.current_return_pct + '%</div></div>' +
                    '</div>' +
                    '<div class="card-levels">' +
                        '<div class="level-item"><div class="lbl">Stop Loss</div><div style="color:var(--red)">$' + s.sl_price.toFixed(2) + ' (-' + s.sl_pct + '%)</div></div>' +
                        '<div class="level-item"><div class="lbl">R:R</div><div style="color:var(--gold)">' + s.risk_reward + ':1</div></div>' +
                        '<div class="level-item"><div class="lbl">Target</div><div style="color:var(--green)">$' + s.tp_price.toFixed(2) + ' (+' + s.tp_pct + '%)</div></div>' +
                    '</div>' +
                    '<div class="card-sources">' + srcHtml + '</div>' +
                '</div>';
            }
            html += '</div></div>';
        }

        document.getElementById('setupsContainer').innerHTML = html;
        document.getElementById('refreshInfo').textContent = 'Scan time: ' + d.scan_time_est + ' EST | ' + d.total_setups + ' setups (' + d.very_high_conviction + ' very high, ' + d.high_conviction + ' high)';
    });
}

function loadEdgeStats() {
    apiGet('edge_finder.php?action=edge_stats', function(d) {
        if (!d.ok) return;
        var html = '';
        var algos = d.known_edge_algorithms || [];
        for (var i = 0; i < algos.length; i++) {
            var a = algos[i];
            var wrCls = a.proven_win_rate >= 80 ? 'badge-green' : a.proven_win_rate >= 70 ? 'badge-gold' : '';
            html += '<tr><td><strong>' + a.algorithm + '</strong></td><td>' + a.source + '</td>' +
                '<td><span class="badge ' + wrCls + '">' + a.proven_win_rate + '%</span></td>' +
                '<td>' + a.min_score_threshold + '</td>' +
                '<td><span class="badge badge-green">YES</span></td></tr>';
        }
        // Add live performance if any
        var live = d.live_performance || [];
        for (var j = 0; j < live.length; j++) {
            var l = live[j];
            html += '<tr><td>' + l.algorithm + '</td><td>' + l.source + '</td>' +
                '<td>' + l.win_rate + '% (' + l.trades + ' trades)</td>' +
                '<td>-</td>' +
                '<td>' + (l.has_edge ? '<span class="badge badge-green">YES</span>' : '<span class="badge badge-red">NO</span>') + '</td></tr>';
        }
        if (html === '') html = '<tr><td colspan="5" class="no-data">No edge data yet</td></tr>';
        document.getElementById('edgeTable').innerHTML = html;
    });
}

function loadHistory() {
    apiGet('edge_finder.php?action=history&days=30', function(d) {
        if (!d.ok) {
            document.getElementById('historyStats').innerHTML = '<div class="no-data">No history data</div>';
            return;
        }
        var wrCls = d.win_rate >= 60 ? 'green' : d.win_rate >= 45 ? 'yellow' : 'red';
        var retCls = d.avg_return_pct >= 0 ? 'green' : 'red';
        document.getElementById('historyStats').innerHTML =
            '<div style="display:flex;gap:2rem;flex-wrap:wrap;justify-content:center">' +
            '<div class="metric" style="min-width:100px"><div class="label">Picks</div><div class="val" style="color:var(--blue)">' + d.total_picks + '</div></div>' +
            '<div class="metric" style="min-width:100px"><div class="label">Win Rate</div><div class="val" style="color:var(--' + wrCls + ')">' + d.win_rate + '%</div></div>' +
            '<div class="metric" style="min-width:100px"><div class="label">Winners</div><div class="val" style="color:var(--green)">' + d.winners + '</div></div>' +
            '<div class="metric" style="min-width:100px"><div class="label">Losers</div><div class="val" style="color:var(--red)">' + d.losers + '</div></div>' +
            '<div class="metric" style="min-width:100px"><div class="label">Avg Return</div><div class="val" style="color:var(--' + retCls + ')">' + d.avg_return_pct + '%</div></div>' +
            '</div>';

        var picks = d.picks || [];
        if (picks.length === 0) {
            document.getElementById('historyTable').innerHTML = '<tr><td colspan="7" class="no-data">No edge-filtered picks in last 30 days</td></tr>';
            return;
        }
        var html = '';
        for (var i = 0; i < Math.min(picks.length, 50); i++) {
            var p = picks[i];
            var cls = p.is_winner ? 'badge-green' : 'badge-red';
            var sign = p.return_pct >= 0 ? '+' : '';
            html += '<tr><td><strong>' + p.ticker + '</strong></td><td>' + p.algorithm + '</td>' +
                '<td>$' + p.entry_price.toFixed(2) + '</td><td>$' + (p.latest_price || 0).toFixed(2) + '</td>' +
                '<td><span class="badge ' + cls + '">' + sign + p.return_pct + '%</span></td>' +
                '<td>' + p.score + '</td><td>' + p.pick_date + '</td></tr>';
        }
        document.getElementById('historyTable').innerHTML = html;
    });
}

function updateTimestamp() {
    var now = new Date();
    document.getElementById('lastUpdated').textContent = 'Last updated: ' + now.toLocaleTimeString();
}

// Auto-refresh every 5 minutes
loadAll();
updateTimestamp();
refreshTimer = setInterval(function() { loadAll(); updateTimestamp(); }, 300000);
</script>
<script src="/findstocks/portfolio2/stock-nav.js"></script>
</body>
</html>
