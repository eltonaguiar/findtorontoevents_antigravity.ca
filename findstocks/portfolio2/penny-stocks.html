<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penny Stock Finder &amp; Picks | Find Toronto Events</title>
    <style>
        :root {
            --bg-dark: #0a0a1a;
            --bg-card: #12122a;
            --bg-card-hover: #1a1a3a;
            --border: #2a2a4a;
            --text: #e0e0f0;
            --text-dim: #8888aa;
            --accent: #6366f1;
            --accent-glow: rgba(99, 102, 241, 0.3);
            --green: #22c55e;
            --green-dim: rgba(34, 197, 94, 0.15);
            --red: #ef4444;
            --red-dim: rgba(239, 68, 68, 0.15);
            --yellow: #eab308;
            --yellow-dim: rgba(234, 179, 8, 0.15);
            --blue: #3b82f6;
            --orange: #f97316;
            --purple: #a855f7;
            --cyan: #06b6d4;
            --radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
        }

        a {
            color: var(--accent);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        .header {
            background: linear-gradient(135deg, #12122a 0%, #1e1e3f 100%);
            border-bottom: 1px solid var(--border);
            padding: 1.5rem 2rem;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--accent), #a78bfa, var(--blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.3rem;
        }

        .header p {
            color: var(--text-dim);
            font-size: 0.95rem;
        }

        .container {
            max-width: 1300px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .disclaimer {
            background: var(--yellow-dim);
            border: 1px solid rgba(234, 179, 8, 0.3);
            border-radius: 8px;
            padding: 0.6rem 1rem;
            font-size: 0.78rem;
            color: var(--yellow);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        /* ── Tabs ── */
        .tabs {
            display: flex;
            gap: 0;
            border: 1px solid var(--border);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .tab-btn {
            flex: 1;
            background: var(--bg-card);
            color: var(--text-dim);
            border: none;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
            text-align: center;
        }

        .tab-btn:not(:last-child) {
            border-right: 1px solid var(--border);
        }

        .tab-btn.active {
            background: var(--accent);
            color: #fff;
        }

        .tab-btn:hover:not(.active) {
            background: var(--bg-card-hover);
            color: var(--text);
        }

        .tab-btn .tab-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 1px 7px;
            border-radius: 10px;
            font-size: 11px;
            margin-left: 6px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        /* ── Filters ── */
        .filters {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.2rem;
            margin-bottom: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: flex-end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .filter-group label {
            font-size: 11px;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-group select,
        .filter-group input {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
            min-width: 120px;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .btn-search {
            background: var(--accent);
            color: #fff;
            border: none;
            padding: 8px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            height: 37px;
        }

        .btn-search:hover {
            opacity: 0.9;
        }

        .btn-search:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ── Country Toggle ── */
        .country-toggle {
            display: flex;
            gap: 0;
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .country-btn {
            background: var(--bg-dark);
            color: var(--text-dim);
            border: none;
            padding: 8px 16px;
            font-size: 13px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.15s;
        }

        .country-btn:not(:last-child) {
            border-right: 1px solid var(--border);
        }

        .country-btn.active {
            background: var(--accent);
            color: #fff;
        }

        .country-btn:hover:not(.active) {
            background: var(--bg-card-hover);
            color: var(--text);
        }

        /* ── Summary Bar ── */
        .summary {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .summary-pill {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 5px 12px;
            font-size: 12px;
            color: var(--text-dim);
        }

        .summary-pill b {
            color: var(--text);
        }

        .summary-pill .g {
            color: var(--green);
        }

        /* ── Table ── */
        .table-wrap {
            overflow-x: auto;
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        thead th {
            background: var(--bg-card);
            color: var(--text-dim);
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.5px;
            padding: 10px 12px;
            text-align: left;
            white-space: nowrap;
            cursor: pointer;
            user-select: none;
            position: sticky;
            top: 0;
            z-index: 5;
        }

        thead th:hover {
            color: var(--text);
        }

        thead th.sorted {
            color: var(--accent);
        }

        thead th .arrow {
            font-size: 10px;
            margin-left: 3px;
        }

        tbody tr {
            border-top: 1px solid var(--border);
            transition: background 0.12s;
        }

        tbody tr:hover {
            background: var(--bg-card-hover);
        }

        td {
            padding: 10px 12px;
            white-space: nowrap;
        }

        td.symbol {
            font-weight: 700;
            color: var(--accent);
        }

        td.name {
            color: var(--text-dim);
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        td.price {
            font-weight: 600;
        }

        td.pos {
            color: var(--green);
        }

        td.neg {
            color: var(--red);
        }

        .exchange-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .badge-tsx {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
        }

        .badge-tsxv {
            background: rgba(234, 179, 8, 0.15);
            color: #facc15;
        }

        .badge-cse {
            background: rgba(249, 115, 22, 0.15);
            color: #fb923c;
        }

        .badge-nyse {
            background: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
        }

        .badge-nasdaq {
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
        }

        .badge-amex {
            background: rgba(168, 85, 247, 0.15);
            color: #c084fc;
        }

        .badge-other {
            background: rgba(136, 136, 170, 0.1);
            color: var(--text-dim);
        }

        .rrsp-yes {
            color: var(--green);
            font-size: 11px;
        }

        .rrsp-no {
            color: var(--red);
            font-size: 11px;
        }

        /* ── Pagination ── */
        .pagination {
            display: flex;
            gap: 8px;
            justify-content: center;
            align-items: center;
            margin-top: 1.5rem;
        }

        .pagination button {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
        }

        .pagination button:hover {
            border-color: var(--accent);
        }

        .pagination button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .pagination .page-info {
            color: var(--text-dim);
            font-size: 13px;
        }

        /* ── Loading / Error ── */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-dim);
        }

        .loading .spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid var(--border);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .error-box {
            background: var(--red-dim);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 1rem;
            color: #fca5a5;
            text-align: center;
        }

        .vol-bar {
            display: inline-block;
            height: 6px;
            border-radius: 3px;
            background: var(--accent);
            vertical-align: middle;
            margin-left: 6px;
            min-width: 2px;
            max-width: 60px;
        }

        /* ── Score Bar ── */
        .score-bar {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .score-bar-bg {
            width: 60px;
            height: 8px;
            background: var(--bg-dark);
            border-radius: 4px;
            overflow: hidden;
        }

        .score-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s;
        }

        .score-val {
            font-weight: 700;
            font-size: 13px;
            min-width: 28px;
            text-align: right;
        }

        /* ── Rating Badges ── */
        .rating-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .rating-STRONG_BUY {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
        }

        .rating-BUY {
            background: rgba(34, 197, 94, 0.12);
            color: #86efac;
        }

        .rating-HOLD {
            background: rgba(234, 179, 8, 0.12);
            color: #facc15;
        }

        .rating-SELL {
            background: rgba(239, 68, 68, 0.12);
            color: #fca5a5;
        }

        .rating-STRONG_SELL {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }

        /* ── Picks Cards ── */
        .picks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .pick-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem 1.2rem;
            transition: border-color 0.15s;
        }

        .pick-card:hover {
            border-color: var(--accent);
        }

        .pick-card-head {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.7rem;
        }

        .pick-card-head .sym {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent);
        }

        .pick-card-head .name {
            font-size: 12px;
            color: var(--text-dim);
            max-width: 180px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .pick-card-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px 16px;
            font-size: 12px;
        }

        .pick-card-body .lbl {
            color: var(--text-dim);
        }

        .pick-card-body .val {
            text-align: right;
            font-weight: 500;
        }

        .factor-bars {
            margin-top: 0.7rem;
        }

        .factor-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 3px;
            font-size: 11px;
        }

        .factor-row .f-label {
            width: 70px;
            color: var(--text-dim);
            text-align: right;
        }

        .factor-row .f-bar-bg {
            flex: 1;
            height: 6px;
            background: var(--bg-dark);
            border-radius: 3px;
            overflow: hidden;
        }

        .factor-row .f-bar {
            height: 100%;
            border-radius: 3px;
        }

        .factor-row .f-val {
            width: 24px;
            font-weight: 600;
            font-size: 10px;
        }

        /* ── Stats Cards ── */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem;
            text-align: center;
        }

        .stat-card .stat-label {
            font-size: 11px;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-top: 4px;
        }

        .stat-card .stat-sub {
            font-size: 11px;
            color: var(--text-dim);
            margin-top: 2px;
        }

        /* ── Info Banner ── */
        .info-banner {
            background: rgba(99, 102, 241, 0.08);
            border: 1px solid rgba(99, 102, 241, 0.25);
            border-radius: var(--radius);
            padding: 1rem 1.2rem;
            margin-bottom: 1.5rem;
            font-size: 13px;
            line-height: 1.7;
            color: var(--text);
        }

        .info-banner.warn {
            background: rgba(234, 179, 8, 0.08);
            border-color: rgba(234, 179, 8, 0.25);
        }

        .info-banner h4 {
            font-size: 14px;
            margin-bottom: 6px;
            color: var(--accent);
        }

        .info-banner.warn h4 {
            color: var(--yellow);
        }

        .info-banner ul {
            margin: 6px 0 0 18px;
            padding: 0;
        }

        .info-banner li {
            margin-bottom: 2px;
        }

        .info-banner .dim {
            color: var(--text-dim);
        }

        .info-banner .highlight {
            color: var(--accent);
            font-weight: 600;
        }

        .info-banner .green {
            color: var(--green);
        }

        .info-banner .eta-note {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(234, 179, 8, 0.15);
            font-size: 12px;
            color: var(--text-dim);
        }

        /* ── Methodology Toggle ── */
        .methodology-toggle {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .methodology-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 1.2rem;
            cursor: pointer;
            user-select: none;
            transition: background 0.15s;
        }

        .methodology-header:hover {
            background: var(--bg-card-hover);
        }

        .methodology-header h4 {
            font-size: 13px;
            color: var(--accent);
            font-weight: 600;
        }

        .methodology-header .toggle-icon {
            color: var(--text-dim);
            font-size: 12px;
            transition: transform 0.2s;
        }

        .methodology-header.open .toggle-icon {
            transform: rotate(180deg);
        }

        .methodology-body {
            display: none;
            padding: 0 1.2rem 1rem;
            font-size: 12px;
            line-height: 1.7;
            color: var(--text);
        }

        .methodology-body.open {
            display: block;
        }

        .method-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 0.8rem;
            margin-top: 0.8rem;
        }

        .method-item {
            background: var(--bg-dark);
            border-radius: 8px;
            padding: 0.7rem 0.9rem;
        }

        .method-item .m-label {
            font-weight: 700;
            font-size: 12px;
            margin-bottom: 3px;
            display: flex;
            justify-content: space-between;
        }

        .method-item .m-weight {
            color: var(--accent);
            font-size: 11px;
        }

        .method-item .m-desc {
            color: var(--text-dim);
            font-size: 11px;
            line-height: 1.5;
        }

        .method-ratings {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
            margin-top: 0.6rem;
            padding-top: 0.6rem;
            border-top: 1px solid var(--border);
        }

        .method-ratings .mr-item {
            font-size: 11px;
        }

        .method-ratings .mr-item b {
            margin-right: 4px;
        }

        .method-filters {
            margin-top: 0.6rem;
            padding-top: 0.6rem;
            border-top: 1px solid var(--border);
            color: var(--text-dim);
            font-size: 11px;
        }

        .method-filters b {
            color: var(--text);
        }

        /* ── Empty State ── */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-dim);
        }

        .empty-state .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .empty-state h3 {
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        .footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-dim);
            font-size: 0.8rem;
            border-top: 1px solid var(--border);
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            .filters {
                flex-direction: column;
            }

            .filter-group select,
            .filter-group input {
                width: 100%;
            }

            td.name {
                max-width: 120px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .picks-grid {
                grid-template-columns: 1fr;
            }

            .stats-row {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>Penny Stock Finder &amp; Picks</h1>
        <p>Multi-factor scored penny stocks &mdash; RRSP eligible &mdash; No OTC/Pink Sheets</p>
    </div>

    <div class="container">
        <!-- Best Penny Stocks designation banner -->
        <div
            style="background:linear-gradient(135deg,rgba(234,179,8,0.06),rgba(99,102,241,0.06));border:1px solid rgba(234,179,8,0.3);border-radius:var(--radius);padding:0.7rem 1rem;margin-bottom:0.8rem;display:flex;align-items:center;gap:10px;flex-wrap:wrap;font-size:12px;">
            <span
                style="background:rgba(234,179,8,0.15);color:#eab308;padding:3px 10px;border-radius:6px;font-weight:800;font-size:11px;border:1px solid rgba(234,179,8,0.3);letter-spacing:0.5px;">BEST
                PENNY</span>
            <span style="color:var(--text-dim);">Status: <strong style="color:#eab308;">Tracking</strong> &mdash; 40
                active picks, 0 closed. Forward-facing results pending.</span>
        </div>

        <div class="disclaimer">
            Not financial advice. Penny stocks are highly volatile and risky. Always do your own research before
            investing. Scores are algorithmic, not recommendations.
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('scanner')">Scanner</button>
            <button class="tab-btn" onclick="switchTab('picks')">Daily Picks <span class="tab-badge"
                    id="picks-badge"></span></button>
            <button class="tab-btn" onclick="switchTab('performance')">Performance</button>
            <button class="tab-btn" onclick="switchTab('analysis')" style="color:#f59e0b;">System Analysis</button>
            <button class="tab-btn" onclick="switchTab('research')" style="color:#a855f7;">Research &amp;
                Future</button>
        </div>

        <!-- ============================================ -->
        <!-- TAB 1: SCANNER (existing functionality) -->
        <!-- ============================================ -->
        <div class="tab-panel active" id="tab-scanner">
            <div class="filters">
                <div class="filter-group">
                    <label>Country</label>
                    <div class="country-toggle">
                        <button class="country-btn active" data-region="ca">Canada</button>
                        <button class="country-btn" data-region="us">US</button>
                        <button class="country-btn" data-region="both">Both</button>
                    </div>
                </div>
                <div class="filter-group">
                    <label>Max Price</label>
                    <select id="max-price">
                        <option value="1">Under $1</option>
                        <option value="2">Under $2</option>
                        <option value="5" selected>Under $5</option>
                        <option value="10">Under $10</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Min Volume</label>
                    <select id="min-volume">
                        <option value="50000">50K+</option>
                        <option value="100000" selected>100K+</option>
                        <option value="500000">500K+</option>
                        <option value="1000000">1M+</option>
                        <option value="5000000">5M+</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Sort By</label>
                    <select id="sort-field">
                        <option value="dayvolume" selected>Volume</option>
                        <option value="percentchange">% Change</option>
                        <option value="intradayprice">Price</option>
                        <option value="intradaymarketcap">Market Cap</option>
                    </select>
                </div>
                <button class="btn-search" id="btn-search" onclick="search(0)">Search</button>
            </div>

            <div class="summary" id="summary" style="display:none;"></div>

            <div id="results">
                <div class="loading" style="display:none;" id="loading">
                    <span class="spinner"></span> Scanning exchanges...
                </div>
                <div class="error-box" style="display:none;" id="error"></div>
                <div class="table-wrap" style="display:none;" id="table-wrap">
                    <table>
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Name</th>
                                <th>Price</th>
                                <th>Change</th>
                                <th>Volume</th>
                                <th>Avg Vol (3M)</th>
                                <th>Mkt Cap</th>
                                <th>52W Range</th>
                                <th>Exchange</th>
                                <th>RRSP</th>
                            </tr>
                        </thead>
                        <tbody id="tbody"></tbody>
                    </table>
                </div>
                <div class="pagination" id="pagination" style="display:none;">
                    <button id="btn-prev" onclick="prevPage()">&laquo; Previous</button>
                    <span class="page-info" id="page-info"></span>
                    <button id="btn-next" onclick="nextPage()">Next &raquo;</button>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- TAB 2: DAILY PICKS -->
        <!-- ============================================ -->
        <div class="tab-panel" id="tab-picks">
            <div class="filters">
                <div class="filter-group">
                    <label>Country</label>
                    <select id="picks-country">
                        <option value="ALL">All</option>
                        <option value="US">US</option>
                        <option value="CA">Canada</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Min Score</label>
                    <select id="picks-min-score">
                        <option value="0">All Picks</option>
                        <option value="50">50+</option>
                        <option value="60" selected>60+ (BUY+)</option>
                        <option value="75">75+ (STRONG BUY)</option>
                    </select>
                </div>
                <button class="btn-search" onclick="loadPicks()">Refresh</button>
            </div>

            <div id="picks-date" style="text-align:center;margin-bottom:1rem;color:var(--text-dim);font-size:13px;">
            </div>

            <!-- Scoring Methodology (collapsible) -->
            <div class="methodology-toggle">
                <div class="methodology-header" onclick="toggleMethodology(this)">
                    <h4>How Are Scores Calculated?</h4>
                    <span class="toggle-icon">&#9660;</span>
                </div>
                <div class="methodology-body">
                    <p>Each stock is scored <b>0&ndash;100</b> using a <b>7-factor composite model</b>. The algorithm
                        scans exchange-listed penny stocks ($1&ndash;$5, min 200K volume, min $50M market cap), rejects
                        financially distressed companies, and ranks the rest by weighted factor scores.</p>

                    <div class="method-grid">
                        <div class="method-item">
                            <div class="m-label"><span style="color:#22c55e">Financial Health</span> <span
                                    class="m-weight">30% weight</span></div>
                            <div class="m-desc">Altman Z''-Score (bankruptcy risk), Piotroski F-Score (0&ndash;9
                                fundamental checklist), current ratio, and debt-to-equity. Companies with Z&lt;1.5
                                (distress zone) are automatically rejected.</div>
                        </div>
                        <div class="method-item">
                            <div class="m-label"><span style="color:#3b82f6">Momentum</span> <span class="m-weight">25%
                                    weight</span></div>
                            <div class="m-desc">3-month, 6-month, and 12-month price returns plus Clenow exponential
                                regression. Skips last 21 trading days to avoid short-term reversal noise.</div>
                        </div>
                        <div class="method-item">
                            <div class="m-label"><span style="color:#6366f1">Volume</span> <span class="m-weight">10%
                                    weight</span></div>
                            <div class="m-desc">Relative volume (20-day vs 90-day avg), volume trend direction, and
                                On-Balance Volume (OBV) analysis. Penalizes illiquid stocks with avg volume below 500K.
                            </div>
                        </div>
                        <div class="method-item">
                            <div class="m-label"><span style="color:#f97316">Technical</span> <span class="m-weight">10%
                                    weight</span></div>
                            <div class="m-desc">RSI(14) for overbought/oversold conditions. EMA alignment check: Price
                                vs EMA(9) vs EMA(21) vs SMA(50). Full alignment = bullish structure.</div>
                        </div>
                        <div class="method-item">
                            <div class="m-label"><span style="color:#a855f7">Earnings</span> <span class="m-weight">10%
                                    weight</span></div>
                            <div class="m-desc">Post-Earnings Announcement Drift (PEAD). Measures earnings surprise %
                                with time decay: full impact 0&ndash;60 days, fading to 10% after 180 days.</div>
                        </div>
                        <div class="method-item">
                            <div class="m-label"><span style="color:#eab308">Smart Money</span> <span
                                    class="m-weight">10% weight</span></div>
                            <div class="m-desc">Institutional ownership % (sweet spot: 0&ndash;60%), number of
                                institutional holders, insider ownership (5&ndash;30% ideal), and short interest ratio
                                for squeeze potential.</div>
                        </div>
                        <div class="method-item">
                            <div class="m-label"><span style="color:#06b6d4">Quality</span> <span class="m-weight">5%
                                    weight</span></div>
                            <div class="m-desc">Frog-in-the-Pan metric: rewards stocks with smooth, consistent gains
                                over volatile spikes. Measures % of positive days and annualized volatility.</div>
                        </div>
                    </div>

                    <div class="method-ratings">
                        <div class="mr-item"><b class="rating-badge rating-STRONG_BUY">STRONG BUY</b> Score &ge; 75
                        </div>
                        <div class="mr-item"><b class="rating-badge rating-BUY">BUY</b> Score &ge; 62</div>
                        <div class="mr-item"><b class="rating-badge rating-HOLD">HOLD</b> Score &ge; 48</div>
                        <div class="mr-item"><b class="rating-badge rating-SELL">SELL</b> Score &ge; 35</div>
                        <div class="mr-item"><b class="rating-badge rating-STRONG_SELL">STRONG SELL</b> Score &lt; 35
                        </div>
                    </div>

                    <div class="method-filters">
                        <b>Hard rejection filters:</b> Z-Score &lt; 1.5 (distress) &bull; Negative income AND negative
                        cash flow &bull; OTC / Pink Sheets &bull; Price outside $1&ndash;$5 &bull; Volume &lt; 200K
                        &bull; Market cap &lt; $50M
                    </div>
                    <div class="method-filters" style="border-top:none;margin-top:4px;">
                        <b>Exit rules:</b> Stop-loss at &minus;15% &bull; Take-profit at +30% &bull; Max hold 90 days
                        &bull; Position size: 1.5% (quarter-Kelly)
                    </div>
                    <div class="method-filters" style="border-top:none;margin-top:4px;">
                        <b>Data sources:</b> Yahoo Finance (price, fundamentals, earnings) &bull; SEC EDGAR (13F
                        filings, Form 4 insider trades) &bull; Institutional holder data
                    </div>
                </div>
            </div>

            <div class="loading" style="display:none;" id="picks-loading">
                <span class="spinner"></span> Loading daily picks...
            </div>

            <div id="picks-empty" class="empty-state" style="display:none;">
                <div class="empty-icon">&#128202;</div>
                <h3>No Picks Available Yet</h3>
                <p>Daily picks are generated automatically. Check back soon!</p>
            </div>

            <div id="picks-content" style="display:none;">
                <div class="summary" id="picks-summary"></div>
                <div class="picks-grid" id="picks-grid"></div>

                <!-- Picks Table (detailed view) -->
                <div class="table-wrap" id="picks-table-wrap">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Symbol</th>
                                <th>Name</th>
                                <th>Score</th>
                                <th>Rating</th>
                                <th>Price</th>
                                <th>Health</th>
                                <th>Momentum</th>
                                <th>Technical</th>
                                <th>Smart $</th>
                                <th>Z-Score</th>
                                <th>F-Score</th>
                                <th>RSI</th>
                                <th>Exchange</th>
                                <th>RRSP</th>
                            </tr>
                        </thead>
                        <tbody id="picks-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- TAB 3: PERFORMANCE -->
        <!-- ============================================ -->
        <div class="tab-panel" id="tab-performance">
            <div class="filters">
                <div class="filter-group">
                    <label>Period</label>
                    <select id="perf-days">
                        <option value="7">7 Days</option>
                        <option value="30" selected>30 Days</option>
                        <option value="90">90 Days</option>
                    </select>
                </div>
                <button class="btn-search" onclick="loadPerformance()">Refresh</button>
            </div>

            <div class="loading" style="display:none;" id="perf-loading">
                <span class="spinner"></span> Loading performance data...
            </div>

            <div id="perf-empty" class="empty-state" style="display:none;">
                <div class="empty-icon">&#128200;</div>
                <h3>No Performance Data Yet</h3>
                <p>Performance tracking begins once daily picks are generated and tracked.</p>
            </div>

            <div id="perf-content" style="display:none;">
                <!-- Early-stage explanation banner (shown when all picks are still active) -->
                <div class="info-banner warn" id="perf-early-banner" style="display:none;">
                    <h4>Why is win rate 0% with 0W / 0L?</h4>
                    <p>Win rate is calculated only from <b>closed</b> positions. Currently <b>all picks are still
                            active</b> &mdash; none have hit a take-profit (+30%), stop-loss (&minus;15%), or the 90-day
                        max hold limit yet.</p>
                    <ul>
                        <li><span class="dim">A "win" is a closed position with a positive return. A "loss" is a closed
                                position with a negative return.</span></li>
                        <li><span class="dim">Until at least one position closes, win rate, avg return, best/worst pick
                                all show 0%.</span></li>
                        <li><span class="dim">This is expected &mdash; the system is working correctly. Positions are
                                being tracked daily.</span></li>
                    </ul>
                    <div class="eta-note" id="perf-eta-note"></div>
                </div>

                <div class="stats-row" id="perf-stats"></div>

                <h3 style="margin-bottom:1rem;font-size:15px;">Performance by Rating</h3>
                <div class="table-wrap" style="margin-bottom:1.5rem;">
                    <table>
                        <thead>
                            <tr>
                                <th>Rating</th>
                                <th>Picks</th>
                                <th>Avg Return</th>
                                <th>Win Rate</th>
                            </tr>
                        </thead>
                        <tbody id="perf-by-rating"></tbody>
                    </table>
                </div>

                <h3 style="margin-bottom:1rem;font-size:15px;">Recent Pick History</h3>
                <div class="table-wrap">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Symbol</th>
                                <th>Name</th>
                                <th>Entry</th>
                                <th>Score</th>
                                <th>Rating</th>
                                <th>Status</th>
                                <th>Return</th>
                                <th>Exit Reason</th>
                            </tr>
                        </thead>
                        <tbody id="perf-history"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- TAB 4: SYSTEM ANALYSIS -->
        <!-- ============================================ -->
        <div class="tab-panel" id="tab-analysis">
            <div
                style="font-size:1.2rem;font-weight:700;margin:1.5rem 0 1rem;display:flex;align-items:center;gap:0.75rem;color:#f59e0b;">
                System Analysis <span
                    style="font-size:0.6rem;padding:0.2rem 0.5rem;border-radius:99px;font-weight:700;text-transform:uppercase;letter-spacing:0.05em;background:rgba(245,158,11,0.15);color:#f59e0b;border:1px solid rgba(245,158,11,0.3);">DIAGNOSIS</span>
            </div>

            <div
                style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1rem;margin-bottom:1.5rem;">
                <div
                    style="background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:1.2rem;">
                    <h4 style="font-size:0.85rem;color:var(--yellow);margin-bottom:0.5rem;">What This System Does</h4>
                    <div style="font-size:12px;color:var(--text-dim);line-height:1.7;">
                        &bull; Yahoo Finance screener proxy scanning penny stocks ($0.10&ndash;$5.00)<br>
                        &bull; 7-factor composite scoring: Health, Momentum, Volume, Technical, Earnings, Smart Money,
                        Quality<br>
                        &bull; Blocks OTC/Pink Sheets &mdash; exchange-listed stocks only<br>
                        &bull; Multiple sort options (volume, % change, price, market cap)<br>
                        &bull; Daily picks generated via GitHub Actions automation
                    </div>
                </div>
                <div
                    style="background:var(--bg-card);border:1px solid rgba(239,68,68,0.3);border-radius:var(--radius);padding:1.2rem;">
                    <h4 style="font-size:0.85rem;color:var(--red);margin-bottom:0.5rem;">Critical Flaws</h4>
                    <div style="font-size:12px;color:var(--text-dim);line-height:1.7;">
                        &bull; <strong>No volume confirmation:</strong> Picks lack volume spike validation<br>
                        &bull; <strong>Delayed data:</strong> Yahoo screener can be 15&ndash;20 min behind real-time<br>
                        &bull; <strong>No sector analysis:</strong> No fundamental screening beyond price<br>
                        &bull; <strong>No momentum indicators:</strong> Missing RSI/MACD confirmation for picks<br>
                        &bull; <strong>No backtested history:</strong> Picks are completely unvalidated<br>
                        &bull; <strong>ML in progress:</strong> Random Forest live; penny-specific ML being built by other agents<br>
                        &bull; <strong>No pump-and-dump detection:</strong> Cannot identify manipulation schemes
                    </div>
                </div>
                <div
                    style="background:var(--bg-card);border:1px solid rgba(34,197,94,0.3);border-radius:var(--radius);padding:1.2rem;">
                    <h4 style="font-size:0.85rem;color:var(--green);margin-bottom:0.5rem;">What's Working</h4>
                    <div style="font-size:12px;color:var(--text-dim);line-height:1.7;">
                        &bull; Automated daily scanning across multiple exchanges<br>
                        &bull; OTC filtering removes the most dangerous stocks<br>
                        &bull; Price range and volume filtering for basic safety<br>
                        &bull; Multiple sort options for different strategies<br>
                        &bull; RRSP eligibility tracking (Canadian investors)
                    </div>
                </div>
            </div>

            <h4 style="font-size:0.9rem;margin-bottom:0.75rem;color:#f59e0b;">ML &amp; Learning Status</h4>
            <div id="ml-status-container"
                style="background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:1.2rem;margin-bottom:1rem;">
                <div class="loading" style="display:block;padding:1rem;" id="ml-loading">
                    <span class="spinner"></span> Loading ML model status...
                </div>
                <div id="ml-status-content" style="display:none;">
                    <!-- ML status will be populated here -->
                </div>
            </div>

            <h4 style="font-size:0.9rem;margin-bottom:0.75rem;color:#f59e0b;">Feature Importance</h4>
            <div id="feature-importance-container"
                style="background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:1.2rem;margin-bottom:1rem;display:none;">
                <div id="feature-importance-chart"></div>
            </div>

            <h4 style="font-size:0.9rem;margin-bottom:0.75rem;color:#f59e0b;">Safety Assessment</h4>
            <div
                style="background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.3);border-radius:var(--radius);padding:1.2rem;margin-bottom:1rem;">
                <div style="font-size:12px;color:#fca5a5;line-height:1.7;">
                    <strong style="color:var(--red);">NOT SAFE for real trading.</strong> Penny stocks are inherently
                    extremely high-risk. This is a SCREENER only, not a recommendation engine. It cannot detect
                    pump-and-dump schemes, cannot verify fundamentals beyond basic financial ratios, and cannot assess
                    management quality or business viability. Use with extreme caution. Never invest money you cannot
                    afford to lose entirely.
                </div>
            </div>

            <h4 style="font-size:0.9rem;margin-bottom:0.75rem;color:#f59e0b;">API Endpoints</h4>
            <div
                style="background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:1.2rem;margin-bottom:1rem;">
                <div style="font-size:12px;color:var(--text-dim);line-height:1.8;">
                    &bull; <strong>Scanner:</strong> <a href="api/penny_stocks.php?action=scan&region=us"
                        target="_blank">penny_stocks.php</a> &mdash; Yahoo Finance screener proxy<br>
                    &bull; <strong>Daily picks:</strong> <a href="api/penny_stock_picks.php?action=picks"
                        target="_blank">penny_stock_picks.php</a> &mdash; automated daily picks with 7-factor scores<br>
                    &bull; <strong>Performance:</strong> <a href="api/penny_stock_picks.php?action=performance"
                        target="_blank">penny_stock_picks.php?action=performance</a> &mdash; 40 active, 0 closed<br>
                    &bull; <strong>Smart Money:</strong> <a
                        href="/live-monitor/api/smart_money.php?action=consensus&ticker=AAPL"
                        target="_blank">smart_money.php</a> &mdash; analyst, insider, 13F data
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- TAB 5: RESEARCH & FUTURE -->
        <!-- ============================================ -->
        <div class="tab-panel" id="tab-research">
            <div
                style="font-size:1.2rem;font-weight:700;margin:1.5rem 0 1rem;display:flex;align-items:center;gap:0.75rem;color:#a855f7;">
                Research Findings <span
                    style="font-size:0.6rem;padding:0.2rem 0.5rem;border-radius:99px;font-weight:700;text-transform:uppercase;letter-spacing:0.05em;background:rgba(168,85,247,0.15);color:#a855f7;border:1px solid rgba(168,85,247,0.3);">PENNY
                    STOCK RESEARCH</span></div>
            <p style="font-size:0.8rem;color:var(--text-dim);margin-bottom:1rem;">Our methodology is price-based
                screening with exchange-listing filters. Below is a comparison to academic research, professional tools,
                and world-class standards.</p>

            <div
                style="display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:1rem;margin-bottom:1.5rem;">
                <div
                    style="background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:1.2rem;">
                    <h4 style="font-size:0.85rem;color:#a855f7;margin-bottom:0.5rem;">Academic Research</h4>
                    <div style="font-size:12px;color:var(--text-dim);line-height:1.7;">
                        <strong>Jegadeesh &amp; Titman (1993):</strong> Momentum strategies work for stocks &mdash; but
                        penny stocks have much higher noise-to-signal ratio.<br>
                        <strong>SEC Rule 15g-9:</strong> Penny stock regulations require additional broker disclosures
                        due to extreme risk of fraud.<br>
                        <strong>Microstructure of low-price stocks:</strong> Wider bid-ask spreads, lower liquidity,
                        higher manipulation risk.<br>
                        <strong>Failure rate:</strong> &gt;90% of penny stocks fail to deliver sustained returns.
                        Survivorship bias makes backtests unreliable.<br>
                        <strong>Key insight:</strong> Penny stock backtests are essentially meaningless due to
                        survivorship bias and delisting effects.
                    </div>
                </div>
                <div
                    style="background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:1.2rem;">
                    <h4 style="font-size:0.85rem;color:#a855f7;margin-bottom:0.5rem;">World-Class Tools Comparison</h4>
                    <div style="font-size:12px;color:var(--text-dim);line-height:1.7;">
                        <strong>OTC Markets research tools:</strong> Full company profiles, disclosure status, market
                        activity data.<br>
                        <strong>Finviz screener (free):</strong> Real-time screening, technical charting, pattern
                        recognition.<br>
                        <strong>Trade Ideas scanner ($120/mo):</strong> AI-powered real-time alerts, Level 2 data,
                        volume analysis, SEC filing monitoring, social sentiment tracking.<br>
                        <strong>What professionals need:</strong> Level 2 data, volume analysis, SEC filing monitoring,
                        social sentiment tracking &mdash; none of which we have.
                    </div>
                </div>
            </div>

            <h4 style="font-size:0.9rem;margin-bottom:0.75rem;color:#a855f7;">World-Class Gap Analysis</h4>
            <div
                style="background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:1.2rem;margin-bottom:1rem;">
                <table style="width:100%;font-size:12px;border-collapse:collapse;">
                    <thead>
                        <tr style="border-bottom:1px solid var(--border);">
                            <th
                                style="text-align:left;padding:6px 8px;color:var(--text-dim);font-size:11px;text-transform:uppercase;">
                                Metric</th>
                            <th
                                style="text-align:left;padding:6px 8px;color:var(--text-dim);font-size:11px;text-transform:uppercase;">
                                World-Class</th>
                            <th
                                style="text-align:left;padding:6px 8px;color:var(--text-dim);font-size:11px;text-transform:uppercase;">
                                Ours</th>
                            <th
                                style="text-align:left;padding:6px 8px;color:var(--text-dim);font-size:11px;text-transform:uppercase;">
                                Gap</th>
                        </tr>
                    </thead>
                    <tbody style="color:var(--text);">
                        <tr style="border-bottom:1px solid rgba(42,42,74,0.5);">
                            <td style="padding:6px 8px;">Data Sources</td>
                            <td style="padding:6px 8px;color:var(--green);">5&ndash;10 (price, SEC, social, L2, news)
                            </td>
                            <td style="padding:6px 8px;color:var(--red);">1 (Yahoo Finance only)</td>
                            <td style="padding:6px 8px;color:var(--red);">Massive</td>
                        </tr>
                        <tr style="border-bottom:1px solid rgba(42,42,74,0.5);">
                            <td style="padding:6px 8px;">Screening Speed</td>
                            <td style="padding:6px 8px;color:var(--green);">Real-time (&lt;1s)</td>
                            <td style="padding:6px 8px;color:var(--yellow);">15&ndash;20 min delay</td>
                            <td style="padding:6px 8px;color:var(--yellow);">Moderate</td>
                        </tr>
                        <tr style="border-bottom:1px solid rgba(42,42,74,0.5);">
                            <td style="padding:6px 8px;">Risk Filters</td>
                            <td style="padding:6px 8px;color:var(--green);">Comprehensive (fraud, manipulation,
                                dilution)</td>
                            <td style="padding:6px 8px;color:var(--red);">Basic OTC block only</td>
                            <td style="padding:6px 8px;color:var(--red);">Large</td>
                        </tr>
                        <tr style="border-bottom:1px solid rgba(42,42,74,0.5);">
                            <td style="padding:6px 8px;">ML Integration</td>
                            <td style="padding:6px 8px;color:var(--green);">Full (pattern recognition, outcome
                                prediction)</td>
                            <td style="padding:6px 8px;color:var(--yellow);">Random Forest live; advanced ML in progress</td>
                            <td style="padding:6px 8px;color:var(--yellow);">Narrowing</td>
                        </tr>
                        <tr style="border-bottom:1px solid rgba(42,42,74,0.5);">
                            <td style="padding:6px 8px;">Volume Analysis</td>
                            <td style="padding:6px 8px;color:var(--green);">Real-time, Level 2 depth</td>
                            <td style="padding:6px 8px;color:var(--red);">Basic volume filter only</td>
                            <td style="padding:6px 8px;color:var(--red);">Large</td>
                        </tr>
                        <tr>
                            <td style="padding:6px 8px;">Social Sentiment</td>
                            <td style="padding:6px 8px;color:var(--green);">StockTwits, Reddit, Twitter integration</td>
                            <td style="padding:6px 8px;color:var(--red);">None</td>
                            <td style="padding:6px 8px;color:var(--red);">Massive</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h4 style="font-size:0.9rem;margin-bottom:0.75rem;color:#a855f7;">Future Roadmap</h4>
            <div
                style="background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:1.2rem;margin-bottom:1rem;">
                <div style="font-size:12px;color:var(--text-dim);line-height:1.8;">
                    <strong style="color:var(--accent);font-size:13px;">Q1 2026 (Feb-Mar) — Foundation
                        Hardening</strong><br>
                    <strong style="color:var(--green);">✓ Priority 1 — Volume confirmation filter:</strong> <span
                        style="color:var(--green);">IMPLEMENTED FEB 2026</span> — Require volume spike (2x+ avg) before
                    flagging a pick. Addresses <em>Volume Analysis</em> gap.<br>
                    <strong style="color:var(--green);">✓ Priority 2 — ML System:</strong> <span
                        style="color:var(--green);">LIVE FEB 2026</span> — Random Forest prediction with feature
                    importance. Addresses <em>ML Integration</em> gap. Requires 30+ closed positions to train.<br>
                    <strong style="color:var(--yellow);">⚡ Priority 3 — Momentum indicator overlay:</strong> <span
                        style="color:var(--yellow);">MAR 2026</span> — Add RSI/MACD confirmation to the 7-factor model
                    before picks are generated. Enhances technical analysis.<br><br>

                    <strong style="color:var(--accent);font-size:13px;">Q2 2026 (Apr-Jun) — Data &
                        Intelligence</strong><br>
                    <strong style="color:var(--yellow);">Priority 4 — Multi-source data integration:</strong> <span
                        style="color:var(--yellow);">APR 2026</span> — Add SEC filings, Level 2 data, news sentiment.
                    Addresses <em>Data Sources</em> gap (currently 1 source, need 5-10).<br>
                    <strong style="color:var(--yellow);">Priority 5 — Social sentiment integration:</strong> <span
                        style="color:var(--yellow);">MAY 2026</span> — StockTwits and Reddit mention velocity for penny
                    stocks. Social hype precedes penny stock pumps. Addresses <em>Social Sentiment</em> gap.<br>
                    <strong style="color:var(--yellow);">Priority 6 — Real-time screening:</strong> <span
                        style="color:var(--yellow);">JUN 2026</span> — Upgrade from 15-20 min delay to real-time (<1s).
                        Addresses <em>Screening Speed</em> gap.<br><br>

                        <strong style="color:var(--accent);font-size:13px;">Q3 2026 (Jul-Sep) — Risk
                            Management</strong><br>
                        <strong style="color:var(--text-dim);">Priority 7 — SEC filing monitoring:</strong> <span
                            style="color:var(--text-dim);">JUL 2026</span> — Detect red flags in 10-K/10-Q filings
                        (going concern opinions, dilution events, shell company indicators). Addresses <em>Risk
                            Filters</em> gap.<br>
                        <strong style="color:var(--text-dim);">Priority 8 — Fraud detection system:</strong> <span
                            style="color:var(--text-dim);">AUG 2026</span> — Pump-and-dump pattern recognition,
                        manipulation detection. Comprehensive risk filters.<br>
                        <strong style="color:var(--text-dim);">Priority 9 — Advanced ML models:</strong> <span
                            style="color:var(--text-dim);">SEP 2026</span> — Gradient Boosting, ensemble methods, LSTM
                        for time-series prediction.<br><br>

                        <strong style="color:var(--accent);font-size:13px;">Q4 2026 (Oct-Dec) —
                            Institutional-Grade</strong><br>
                        <strong style="color:var(--text-dim);">Priority 10 — Level 2 market data:</strong> <span
                            style="color:var(--text-dim);">OCT 2026</span> — Order book analysis, bid-ask spread
                        monitoring, smart money flow tracking.<br>
                        <strong style="color:var(--text-dim);">Priority 11 — Backtesting engine:</strong> <span
                            style="color:var(--text-dim);">NOV 2026</span> — Historical validation, strategy
                        optimization, walk-forward analysis.<br>
                        <strong style="color:var(--text-dim);">Priority 12 — API & automation:</strong> <span
                            style="color:var(--text-dim);">DEC 2026</span> — Public API, automated trading integration,
                        webhook alerts.<br><br>

                        <strong style="color:var(--purple);">🎯 Gap Analysis Status:</strong><br>
                        • <strong style="color:var(--green);">ML Integration:</strong> ✓ Closed (Random Forest live)<br>
                        • <strong style="color:var(--green);">Volume Analysis:</strong> ✓ Closed (2x filter
                        implemented)<br>
                        • <strong style="color:var(--yellow);">Data Sources:</strong> In Progress (Q2 2026)<br>
                        • <strong style="color:var(--yellow);">Screening Speed:</strong> Planned (Jun 2026)<br>
                        • <strong style="color:var(--red);">Risk Filters:</strong> Planned (Q3 2026)<br>
                        • <strong style="color:var(--red);">Social Sentiment:</strong> Planned (May 2026)
                </div>
            </div>

            <!-- Data Sources & Transparency -->
            <div
                style="background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:1.25rem;margin-bottom:1.5rem;">
                <h3 style="font-size:1rem;margin-bottom:0.75rem;display:flex;align-items:center;gap:8px;">
                    Data Sources &amp; Transparency
                    <span
                        style="font-size:10px;padding:2px 8px;border-radius:4px;background:rgba(234,179,8,0.15);color:#eab308;border:1px solid rgba(234,179,8,0.3);">TRACKING</span>
                </h3>
                <div style="font-size:12px;color:var(--text-dim);line-height:1.8;">
                    <strong style="color:var(--text);">Where the numbers come from:</strong><br>
                    &bull; <strong>Stock screening:</strong> <a href="api/penny_stocks.php?action=scan&region=us"
                        target="_blank">penny_stocks.php?action=scan</a> &mdash; Yahoo Finance screener proxy<br>
                    &bull; <strong>Pick performance:</strong> <a href="api/penny_stock_picks.php?action=performance"
                        target="_blank">penny_stock_picks.php?action=performance</a> &mdash; 40 active picks, 0
                    closed<br>
                    &bull; <strong>7-factor scoring:</strong> Health (30%) + Momentum (25%) + Volume (10%) + Technical
                    (10%) + Earnings (10%) + Smart Money (10%) + Quality (5%)<br>
                    &bull; <strong>Smart Money data:</strong> <a
                        href="/live-monitor/api/smart_money.php?action=consensus&ticker=AAPL"
                        target="_blank">smart_money.php</a> &mdash; analyst ratings, insider trades, 13F filings<br>
                    &bull; <strong>Exchange filter:</strong> TSX, TSX-V, CSE, NYSE, NASDAQ, NYSE American only. OTC/Pink
                    Sheets excluded.<br>
                    &bull; <strong>GitHub Actions:</strong> <code>refresh-stocks-portfolio.yml</code> &mdash; daily
                    automated scans
                </div>
            </div>

            <!-- Future Roadmap -->
            <div
                style="background:var(--bg-card);border:1px solid rgba(234,179,8,0.3);border-radius:var(--radius);padding:1.25rem;margin-bottom:1.5rem;">
                <h3 style="font-size:1rem;margin-bottom:0.75rem;display:flex;align-items:center;gap:8px;">
                    Future Roadmap
                    <span
                        style="font-size:10px;padding:2px 8px;border-radius:4px;background:rgba(34,197,94,0.15);color:#22c55e;border:1px solid rgba(34,197,94,0.3);">PLANNED</span>
                </h3>
                <div style="font-size:12px;color:var(--text-dim);line-height:1.8;">
                    <strong style="color:var(--green);">Near-term:</strong><br>
                    &bull; First batch of pick closures will produce real W/L data (exit rules: SL -15% / TP +30% /
                    90-day max hold)<br>
                    &bull; Win rate and cumulative P&amp;L tracking goes live after first closures<br>
                    &bull; Add historical price charts for each tracked pick<br><br>
                    <strong style="color:var(--yellow);">Q2 2026:</strong><br>
                    &bull; Sector breakdown analysis (which penny stock sectors perform best)<br>
                    &bull; Volume-to-market-cap ratio alerts for unusual activity<br>
                    &bull; Compare penny stock 7-factor scoring accuracy vs random selection<br><br>
                    <strong style="color:var(--text-dim);">Long-term:</strong><br>
                    &bull; Machine learning model trained on closed trade outcomes<br>
                    &bull; Insider buying correlation with penny stock breakouts<br>
                    &bull; Risk-adjusted portfolio builder with position sizing recommendations
                </div>
            </div>

            <p style="font-size:0.75rem;color:var(--text-dim);line-height:1.6;margin-bottom:1rem;">
                <strong>Sources:</strong> Jegadeesh &amp; Titman (1993) momentum research, SEC Rule 15g-9 penny stock
                regulations, OTC Markets Group research, Finviz, Trade Ideas scanner documentation, microstructure
                research on low-price stocks, SEC EDGAR filing analysis.
            </p>
        </div>

    </div>

    <div class="footer">
        <p>Data from Yahoo Finance, SEC EDGAR, and institutional filings &mdash; Scores updated daily via automated
            7-factor algorithm &mdash; findtorontoevents.ca</p>
        <p style="margin-top:0.3rem;">Composite Score = Health (30%) + Momentum (25%) + Volume (10%) + Technical (10%) +
            Earnings (10%) + Smart Money (10%) + Quality (5%)</p>
        <p style="margin-top:0.3rem;">Exchange-listed stocks only (TSX, TSX-V, CSE, NYSE, NASDAQ, NYSE American).
            OTC/Pink Sheets excluded. Min $50M market cap.</p>
        <p style="margin-top:0.3rem;">Daily picks generated via GitHub Actions. Scanner data cached 30 minutes. Exit
            rules: SL &minus;15% / TP +30% / Max hold 90 days.</p>
    </div>

    <script>
        // ── Global State ──
        var currentRegion = 'ca';
        var currentOffset = 0;
        var currentTotal = 0;
        var PAGE_SIZE = 50;

        // ── Tab Switching ──
        function switchTab(tab) {
            var tabNames = ['scanner', 'picks', 'performance', 'analysis', 'research'];
            document.querySelectorAll('.tabs .tab-btn').forEach(function (b, i) {
                b.classList.toggle('active', tabNames[i] === tab);
            });
            document.querySelectorAll('.tab-panel').forEach(function (p) { p.classList.remove('active'); });
            document.getElementById('tab-' + tab).classList.add('active');

            if (tab === 'picks') loadPicks();
            if (tab === 'performance') loadPerformance();
            if (tab === 'analysis') loadMLStatus();
        }

        // ── Country toggle ──
        document.querySelectorAll('.country-btn').forEach(function (btn) {
            btn.addEventListener('click', function () {
                document.querySelectorAll('.country-btn').forEach(function (b) { b.classList.remove('active'); });
                btn.classList.add('active');
                currentRegion = btn.getAttribute('data-region');
            });
        });

        // ============================================================================
        // SCANNER TAB
        // ============================================================================
        function search(offset) {
            currentOffset = offset || 0;
            var maxPrice = document.getElementById('max-price').value;
            var minVol = document.getElementById('min-volume').value;
            var sortField = document.getElementById('sort-field').value;

            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            document.getElementById('table-wrap').style.display = 'none';
            document.getElementById('pagination').style.display = 'none';
            document.getElementById('summary').style.display = 'none';
            document.getElementById('btn-search').disabled = true;

            var url = '/findstocks/portfolio2/api/penny_stocks.php?'
                + 'region=' + currentRegion
                + '&max_price=' + maxPrice
                + '&min_volume=' + minVol
                + '&sort=' + sortField
                + '&sort_dir=DESC'
                + '&offset=' + currentOffset
                + '&size=' + PAGE_SIZE;

            fetch(url)
                .then(function (r) { return r.json(); })
                .then(function (data) {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('btn-search').disabled = false;
                    if (!data.ok) {
                        document.getElementById('error').style.display = 'block';
                        document.getElementById('error').textContent = 'Error: ' + (data.error || 'Unknown error');
                        return;
                    }
                    currentTotal = data.total || 0;
                    renderResults(data);
                })
                .catch(function (err) {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('btn-search').disabled = false;
                    document.getElementById('error').style.display = 'block';
                    document.getElementById('error').textContent = 'Network error: ' + err.message;
                });
        }

        function renderResults(data) {
            var stocks = data.stocks || [];
            var summaryEl = document.getElementById('summary');
            var regionLabel = data.region === 'ca' ? 'Canada' : data.region === 'us' ? 'US' : 'CA + US';
            summaryEl.innerHTML = '<span class="summary-pill"><b>' + data.count + '</b> stocks found</span>'
                + '<span class="summary-pill">Region: <b>' + regionLabel + '</b></span>'
                + '<span class="summary-pill">Price: <b>$' + data.min_price + ' - $' + data.max_price + '</b></span>'
                + '<span class="summary-pill">Min Vol: <b>' + fmtNum(data.min_volume) + '</b></span>'
                + (data.total > 0 ? '<span class="summary-pill">Total: <b class="g">' + fmtNum(data.total) + '</b></span>' : '')
                + (data.cached ? '<span class="summary-pill">Cached</span>' : '');
            summaryEl.style.display = 'flex';

            if (stocks.length === 0) {
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'No stocks found. Try adjusting filters.';
                document.getElementById('error').style.background = 'var(--yellow-dim)';
                document.getElementById('error').style.borderColor = 'rgba(234, 179, 8, 0.3)';
                document.getElementById('error').style.color = '#facc15';
                return;
            }

            var maxVolume = 0;
            stocks.forEach(function (s) { if (s.volume > maxVolume) maxVolume = s.volume; });

            var tbody = document.getElementById('tbody');
            tbody.innerHTML = '';
            stocks.forEach(function (s) {
                var tr = document.createElement('tr');
                var changeClass = s.change_pct > 0 ? 'pos' : (s.change_pct < 0 ? 'neg' : '');
                var changeSign = s.change_pct > 0 ? '+' : '';
                var volWidth = maxVolume > 0 ? Math.max(2, Math.round((s.volume / maxVolume) * 60)) : 2;
                var profileLink = '/findstocks/portfolio2/stock-profile.html?ticker=' + encodeURIComponent(s.symbol);

                tr.innerHTML = '<td class="symbol"><a href="' + profileLink + '">' + esc(s.symbol) + '</a></td>'
                    + '<td class="name" title="' + esc(s.name) + '">' + esc(s.name) + '</td>'
                    + '<td class="price">$' + fmtPrice(s.price) + ' <small style="color:var(--text-dim)">' + s.currency + '</small></td>'
                    + '<td class="' + changeClass + '">' + changeSign + s.change_pct.toFixed(2) + '%</td>'
                    + '<td>' + fmtNum(s.volume) + '<span class="vol-bar" style="width:' + volWidth + 'px"></span></td>'
                    + '<td style="color:var(--text-dim)">' + fmtNum(s.avg_volume_3m) + '</td>'
                    + '<td>' + fmtMcap(s.market_cap) + '</td>'
                    + '<td style="color:var(--text-dim);font-size:12px">$' + fmtPrice(s.fifty_two_low) + ' - $' + fmtPrice(s.fifty_two_high) + '</td>'
                    + '<td>' + getExchangeBadge(s.exchange) + '</td>'
                    + '<td>' + (s.rrsp_eligible ? '<span class="rrsp-yes">&#10003;</span>' : '<span class="rrsp-no">&#10007;</span>') + '</td>';
                tbody.appendChild(tr);
            });

            document.getElementById('table-wrap').style.display = 'block';

            var totalPages = Math.ceil(currentTotal / PAGE_SIZE);
            var currentPage = Math.floor(currentOffset / PAGE_SIZE) + 1;
            if (totalPages > 1) {
                document.getElementById('pagination').style.display = 'flex';
                document.getElementById('page-info').textContent = 'Page ' + currentPage + ' of ' + totalPages;
                document.getElementById('btn-prev').disabled = currentPage <= 1;
                document.getElementById('btn-next').disabled = currentPage >= totalPages;
            } else {
                document.getElementById('pagination').style.display = 'none';
            }
        }

        function prevPage() { if (currentOffset >= PAGE_SIZE) search(currentOffset - PAGE_SIZE); }
        function nextPage() { search(currentOffset + PAGE_SIZE); }

        // ============================================================================
        // DAILY PICKS TAB
        // ============================================================================
        var picksLoaded = false;

        function loadPicks() {
            var country = document.getElementById('picks-country').value;
            var minScore = document.getElementById('picks-min-score').value;

            document.getElementById('picks-loading').style.display = 'block';
            document.getElementById('picks-empty').style.display = 'none';
            document.getElementById('picks-content').style.display = 'none';

            var url = '/findstocks/portfolio2/api/penny_stock_picks.php?action=picks'
                + '&country=' + country
                + '&min_score=' + minScore
                + '&limit=20';

            fetch(url)
                .then(function (r) { return r.json(); })
                .then(function (data) {
                    document.getElementById('picks-loading').style.display = 'none';

                    if (!data.ok || !data.picks || data.picks.length === 0) {
                        document.getElementById('picks-empty').style.display = 'block';
                        document.getElementById('picks-badge').textContent = '';
                        return;
                    }

                    picksLoaded = true;
                    document.getElementById('picks-badge').textContent = data.picks.length;
                    document.getElementById('picks-date').textContent = 'Picks for: ' + data.date;
                    renderPicks(data.picks);
                })
                .catch(function (err) {
                    document.getElementById('picks-loading').style.display = 'none';
                    document.getElementById('picks-empty').style.display = 'block';
                    document.getElementById('picks-empty').querySelector('p').textContent = 'Error loading picks: ' + err.message;
                });
        }

        function renderPicks(picks) {
            document.getElementById('picks-content').style.display = 'block';

            // Summary
            var buyCount = 0, strongBuyCount = 0, avgScore = 0;
            picks.forEach(function (p) {
                avgScore += p.composite_score;
                if (p.rating === 'BUY') buyCount++;
                if (p.rating === 'STRONG_BUY') strongBuyCount++;
            });
            avgScore = picks.length > 0 ? (avgScore / picks.length).toFixed(1) : 0;

            document.getElementById('picks-summary').innerHTML =
                '<span class="summary-pill"><b>' + picks.length + '</b> picks</span>'
                + '<span class="summary-pill">Avg Score: <b>' + avgScore + '</b></span>'
                + (strongBuyCount > 0 ? '<span class="summary-pill" style="border-color:var(--green)">STRONG BUY: <b class="g">' + strongBuyCount + '</b></span>' : '')
                + (buyCount > 0 ? '<span class="summary-pill">BUY: <b>' + buyCount + '</b></span>' : '');

            // Cards (top 6)
            var grid = document.getElementById('picks-grid');
            grid.innerHTML = '';
            picks.slice(0, 6).forEach(function (p, i) {
                var card = document.createElement('div');
                card.className = 'pick-card';
                var fs = p.factor_scores || {};
                var m = p.metrics || {};
                var profileLink = '/findstocks/portfolio2/stock-profile.html?ticker=' + encodeURIComponent(p.symbol);

                card.innerHTML = '<div class="pick-card-head">'
                    + '<div><a href="' + profileLink + '" class="sym">#' + (i + 1) + ' ' + esc(p.symbol) + '</a>'
                    + '<div class="name">' + esc(p.name) + '</div></div>'
                    + '<div style="text-align:right">'
                    + '<span class="rating-badge rating-' + p.rating + '">' + p.rating.replace('_', ' ') + '</span>'
                    + '<div style="font-size:20px;font-weight:700;margin-top:4px">' + scoreColor(p.composite_score) + '</div></div></div>'
                    + '<div class="pick-card-body">'
                    + '<span class="lbl">Price</span><span class="val">$' + fmtPrice(p.price) + '</span>'
                    + '<span class="lbl">Mkt Cap</span><span class="val">' + fmtMcap(p.market_cap) + '</span>'
                    + '<span class="lbl">Exchange</span><span class="val">' + getExchangeBadge(p.exchange) + '</span>'
                    + '<span class="lbl">RRSP</span><span class="val">' + (p.rrsp_eligible ? '<span class="rrsp-yes">&#10003; Yes</span>' : '<span class="rrsp-no">&#10007; No</span>') + '</span>'
                    + '<span class="lbl">Z-Score</span><span class="val">' + (m.z_score || '-') + '</span>'
                    + '<span class="lbl">F-Score</span><span class="val">' + (m.f_score || '-') + '/9</span>'
                    + '<span class="lbl">RSI</span><span class="val">' + (m.rsi ? m.rsi.toFixed(0) : '-') + '</span>'
                    + '<span class="lbl">RVOL</span><span class="val">' + (m.rvol ? m.rvol.toFixed(1) + 'x' : '-') + '</span>'
                    + '</div>'
                    + '<div class="factor-bars">'
                    + factorBar('Health', fs.health, '#22c55e')
                    + factorBar('Momentum', fs.momentum, '#3b82f6')
                    + factorBar('Volume', fs.volume, '#6366f1')
                    + factorBar('Technical', fs.technical, '#f97316')
                    + factorBar('Earnings', fs.earnings, '#a855f7')
                    + factorBar('Smart $', fs.smart_money, '#eab308')
                    + factorBar('Quality', fs.quality, '#06b6d4')
                    + '</div>';
                grid.appendChild(card);
            });

            // Table (all picks)
            var tbody = document.getElementById('picks-tbody');
            tbody.innerHTML = '';
            picks.forEach(function (p, i) {
                var tr = document.createElement('tr');
                var fs = p.factor_scores || {};
                var m = p.metrics || {};
                var profileLink = '/findstocks/portfolio2/stock-profile.html?ticker=' + encodeURIComponent(p.symbol);

                tr.innerHTML = '<td>' + (i + 1) + '</td>'
                    + '<td class="symbol"><a href="' + profileLink + '">' + esc(p.symbol) + '</a></td>'
                    + '<td class="name" title="' + esc(p.name) + '">' + esc(p.name) + '</td>'
                    + '<td>' + scoreBar(p.composite_score) + '</td>'
                    + '<td><span class="rating-badge rating-' + p.rating + '">' + p.rating.replace('_', ' ') + '</span></td>'
                    + '<td class="price">$' + fmtPrice(p.price) + '</td>'
                    + '<td>' + miniBar(fs.health, '#22c55e') + '</td>'
                    + '<td>' + miniBar(fs.momentum, '#3b82f6') + '</td>'
                    + '<td>' + miniBar(fs.technical, '#f97316') + '</td>'
                    + '<td>' + miniBar(fs.smart_money, '#eab308') + '</td>'
                    + '<td>' + (m.z_score ? m.z_score.toFixed(1) : '-') + '</td>'
                    + '<td>' + (m.f_score || '-') + '/9</td>'
                    + '<td>' + (m.rsi ? m.rsi.toFixed(0) : '-') + '</td>'
                    + '<td>' + getExchangeBadge(p.exchange) + '</td>'
                    + '<td>' + (p.rrsp_eligible ? '<span class="rrsp-yes">&#10003;</span>' : '<span class="rrsp-no">&#10007;</span>') + '</td>';
                tbody.appendChild(tr);
            });
        }

        // ============================================================================
        // PERFORMANCE TAB
        // ============================================================================
        var perfLoaded = false;

        function loadPerformance() {
            var days = document.getElementById('perf-days').value;

            document.getElementById('perf-loading').style.display = 'block';
            document.getElementById('perf-empty').style.display = 'none';
            document.getElementById('perf-content').style.display = 'none';

            var perfUrl = '/findstocks/portfolio2/api/penny_stock_picks.php?action=performance&days=' + days;
            var histUrl = '/findstocks/portfolio2/api/penny_stock_picks.php?action=history&days=' + days;

            Promise.all([
                fetch(perfUrl).then(function (r) { return r.json(); }),
                fetch(histUrl).then(function (r) { return r.json(); })
            ]).then(function (results) {
                document.getElementById('perf-loading').style.display = 'none';
                var perf = results[0];
                var hist = results[1];

                if (!perf.ok || !perf.stats || perf.stats.total_picks === 0) {
                    document.getElementById('perf-empty').style.display = 'block';
                    return;
                }

                perfLoaded = true;
                renderPerformance(perf, hist);
            }).catch(function (err) {
                document.getElementById('perf-loading').style.display = 'none';
                document.getElementById('perf-empty').style.display = 'block';
            });
        }

        function renderPerformance(perf, hist) {
            document.getElementById('perf-content').style.display = 'block';
            var s = perf.stats;

            // Show early-stage banner when no positions have closed yet
            var banner = document.getElementById('perf-early-banner');
            var closed = (s.total_picks || 0) - (s.active || 0);
            if (closed === 0 && s.active > 0) {
                banner.style.display = 'block';
                // Calculate ETA for first exits
                var etaEl = document.getElementById('perf-eta-note');
                var etaLines = [];
                etaLines.push('Earliest exits will happen when a position hits +30% (take-profit) or -15% (stop-loss).');
                etaLines.push('If no target is hit, the 90-day max hold rule forces an exit. ');
                // Estimate based on picks starting ~Feb 11 2026
                var pickStart = new Date('2026-02-11');
                var now = new Date();
                var daysActive = Math.max(1, Math.round((now - pickStart) / 86400000));
                var maxHoldDate = new Date(pickStart.getTime() + 90 * 86400000);
                var maxHoldStr = maxHoldDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                etaLines.push('Picks have been active for ~' + daysActive + ' day' + (daysActive > 1 ? 's' : '') + '. Max-hold exits by: ' + maxHoldStr + '.');
                etaEl.innerHTML = etaLines.join('<br>');
            } else {
                banner.style.display = 'none';
            }

            // ── ML TRANSPARENCY: Show training progress ──
            renderMLProgress(s.closed);

            // Stats cards
            document.getElementById('perf-stats').innerHTML =
                statCard('Total Picks', s.total_picks, '')
                + statCard('Active', s.active, '', 'var(--blue)')
                + statCard('Win Rate', s.win_rate + '%', s.wins + 'W / ' + s.losses + 'L', s.win_rate >= 50 ? 'var(--green)' : 'var(--red)')
                + statCard('Avg Return', (s.avg_return >= 0 ? '+' : '') + s.avg_return + '%', '', s.avg_return >= 0 ? 'var(--green)' : 'var(--red)')
                + statCard('Best Pick', '+' + s.best_return + '%', '', 'var(--green)')
                + statCard('Worst Pick', s.worst_return + '%', '', 'var(--red)')
                + statCard('Avg Score', s.avg_score, '/100', 'var(--accent)');

            // By rating table
            var ratingBody = document.getElementById('perf-by-rating');
            ratingBody.innerHTML = '';
            (perf.by_rating || []).forEach(function (r) {
                var tr = document.createElement('tr');
                tr.innerHTML = '<td><span class="rating-badge rating-' + r.rating + '">' + r.rating.replace('_', ' ') + '</span></td>'
                    + '<td>' + r.count + '</td>'
                    + '<td class="' + (r.avg_return >= 0 ? 'pos' : 'neg') + '">' + (r.avg_return >= 0 ? '+' : '') + r.avg_return + '%</td>'
                    + '<td>' + r.win_rate + '%</td>';
                ratingBody.appendChild(tr);
            });

            // History table
            var histBody = document.getElementById('perf-history');
            histBody.innerHTML = '';
            (hist.history || []).forEach(function (h) {
                var tr = document.createElement('tr');
                var retClass = h.return_pct > 0 ? 'pos' : (h.return_pct < 0 ? 'neg' : '');
                var statusBadge = h.status === 'active'
                    ? '<span style="color:var(--blue)">Active</span>'
                    : '<span style="color:var(--text-dim)">Closed</span>';

                tr.innerHTML = '<td style="color:var(--text-dim)">' + h.pick_date + '</td>'
                    + '<td class="symbol">' + esc(h.symbol) + '</td>'
                    + '<td class="name" title="' + esc(h.name) + '">' + esc(h.name) + '</td>'
                    + '<td>$' + fmtPrice(h.entry_price) + '</td>'
                    + '<td>' + scoreBar(h.score) + '</td>'
                    + '<td><span class="rating-badge rating-' + h.rating + '">' + h.rating.replace('_', ' ') + '</span></td>'
                    + '<td>' + statusBadge + '</td>'
                    + '<td class="' + retClass + '">' + (h.return_pct > 0 ? '+' : '') + h.return_pct.toFixed(2) + '%</td>'
                    + '<td style="color:var(--text-dim)">' + (h.exit_reason || '-') + '</td>';
                histBody.appendChild(tr);
            });
        }

        // ============================================================================
        // ML STATUS TAB
        // ============================================================================
        var mlLoaded = false;

        function loadMLStatus() {
            if (mlLoaded) return;

            document.getElementById('ml-loading').style.display = 'block';
            document.getElementById('ml-status-content').style.display = 'none';

            fetch('/findstocks/portfolio2/api/ml_engine.php?action=stats')
                .then(function (r) { return r.json(); })
                .then(function (data) {
                    document.getElementById('ml-loading').style.display = 'none';
                    document.getElementById('ml-status-content').style.display = 'block';

                    if (!data.ok) {
                        renderMLNotTrained(data);
                    } else {
                        mlLoaded = true;
                        renderMLTrained(data);
                    }
                })
                .catch(function (err) {
                    document.getElementById('ml-loading').style.display = 'none';
                    document.getElementById('ml-status-content').style.display = 'block';
                    document.getElementById('ml-status-content').innerHTML =
                        '<div style="color:var(--red);font-size:12px;">Error loading ML status: ' + err.message + '</div>';
                });
        }

        function renderMLNotTrained(data) {
            var html = '<div style="font-size:12px;color:var(--text-dim);line-height:1.7;">';
            html += '<strong style="color:var(--yellow);">⚠ ML Model Not Yet Trained</strong><br><br>';
            html += 'The machine learning system requires at least <strong style="color:var(--text);">30 closed positions</strong> to train. ';
            html += 'Currently: <strong style="color:var(--red);">' + (data.current_count || 0) + ' closed positions</strong>.<br><br>';
            html += '<strong style="color:var(--text);">What happens next:</strong><br>';
            html += '• Positions close when they hit +30% (take-profit), -15% (stop-loss), or 90-day max hold<br>';
            html += '• Once 30+ positions close, the Random Forest model auto-trains<br>';
            html += '• Model learns which factor combinations predict winners vs losers<br>';
            html += '• Future picks get ML-enhanced predictions with confidence scores<br><br>';
            html += '<strong style="color:var(--text-dim);">Until then:</strong> System uses rule-based 7-factor scoring only.';
            html += '</div>';

            document.getElementById('ml-status-content').innerHTML = html;
        }

        function renderMLTrained(data) {
            var m = data.metrics;
            var html = '<div style="font-size:12px;color:var(--text-dim);line-height:1.7;">';
            html += '<strong style="color:var(--green);">✓ ML Model Active</strong><br><br>';

            // Model info
            html += '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:0.8rem;margin-bottom:1rem;">';
            html += '<div style="background:var(--bg-dark);padding:0.6rem;border-radius:8px;">';
            html += '<div style="font-size:10px;color:var(--text-dim);text-transform:uppercase;">Model Type</div>';
            html += '<div style="font-size:14px;font-weight:700;color:var(--accent);margin-top:2px;">' + data.model_type.toUpperCase().replace('_', ' ') + '</div></div>';

            html += '<div style="background:var(--bg-dark);padding:0.6rem;border-radius:8px;">';
            html += '<div style="font-size:10px;color:var(--text-dim);text-transform:uppercase;">Training Samples</div>';
            html += '<div style="font-size:14px;font-weight:700;color:var(--green);margin-top:2px;">' + data.training_samples + '</div></div>';

            html += '<div style="background:var(--bg-dark);padding:0.6rem;border-radius:8px;">';
            html += '<div style="font-size:10px;color:var(--text-dim);text-transform:uppercase;">Win Rate</div>';
            html += '<div style="font-size:14px;font-weight:700;color:' + (m.win_rate >= 50 ? 'var(--green)' : 'var(--red)') + ';margin-top:2px;">' + m.win_rate + '%</div></div>';

            html += '<div style="background:var(--bg-dark);padding:0.6rem;border-radius:8px;">';
            html += '<div style="font-size:10px;color:var(--text-dim);text-transform:uppercase;">Avg Return</div>';
            html += '<div style="font-size:14px;font-weight:700;color:' + (m.avg_return >= 0 ? 'var(--green)' : 'var(--red)') + ';margin-top:2px;">' + (m.avg_return >= 0 ? '+' : '') + m.avg_return + '%</div></div>';

            html += '<div style="background:var(--bg-dark);padding:0.6rem;border-radius:8px;">';
            html += '<div style="font-size:10px;color:var(--text-dim);text-transform:uppercase;">Trained</div>';
            html += '<div style="font-size:11px;font-weight:600;color:var(--text);margin-top:2px;">' + formatMLDate(data.trained_at) + '</div></div>';
            html += '</div>';

            // Score analysis
            html += '<div style="background:var(--bg-dark);padding:0.8rem;border-radius:8px;margin-bottom:1rem;">';
            html += '<div style="font-weight:700;margin-bottom:6px;color:var(--text);">Score Analysis</div>';
            html += '<div style="display:flex;gap:1.5rem;flex-wrap:wrap;">';
            html += '<div><span style="color:var(--text-dim);">Winners avg score:</span> <strong style="color:var(--green);">' + m.avg_winner_score + '</strong></div>';
            html += '<div><span style="color:var(--text-dim);">Losers avg score:</span> <strong style="color:var(--red);">' + m.avg_loser_score + '</strong></div>';
            html += '<div><span style="color:var(--text-dim);">Score separation:</span> <strong style="color:var(--accent);">' + (m.avg_winner_score - m.avg_loser_score).toFixed(1) + ' pts</strong></div>';
            html += '</div></div>';

            html += '<div style="color:var(--text);margin-top:0.5rem;"><strong>Status:</strong> Model is actively predicting outcomes for new picks. Higher composite scores correlate with better returns.</div>';
            html += '</div>';

            document.getElementById('ml-status-content').innerHTML = html;

            // Render feature importance chart
            if (data.feature_importance) {
                renderFeatureImportance(data.feature_importance);
            }
        }

        function renderFeatureImportance(importance) {
            var container = document.getElementById('feature-importance-container');
            container.style.display = 'block';

            var features = Object.keys(importance).slice(0, 10); // Top 10
            var maxImportance = Math.max(...Object.values(importance));

            var html = '<div style="font-size:11px;color:var(--text-dim);margin-bottom:0.8rem;">';
            html += 'Top features ranked by correlation with returns (higher = more predictive of success)';
            html += '</div>';

            features.forEach(function (feature, i) {
                var value = importance[feature];
                var percent = (value / maxImportance) * 100;
                var color = getFeatureColor(feature);

                html += '<div style="margin-bottom:0.6rem;">';
                html += '<div style="display:flex;justify-content:space-between;margin-bottom:3px;font-size:11px;">';
                html += '<span style="color:var(--text);font-weight:600;">' + (i + 1) + '. ' + formatFeatureName(feature) + '</span>';
                html += '<span style="color:' + color + ';font-weight:700;">' + (value * 100).toFixed(1) + '%</span>';
                html += '</div>';
                html += '<div style="width:100%;height:8px;background:var(--bg-dark);border-radius:4px;overflow:hidden;">';
                html += '<div style="width:' + percent + '%;height:100%;background:' + color + ';border-radius:4px;"></div>';
                html += '</div></div>';
            });

            document.getElementById('feature-importance-chart').innerHTML = html;
        }

        function getFeatureColor(feature) {
            var colors = {
                'health': '#22c55e',
                'momentum': '#3b82f6',
                'volume': '#6366f1',
                'technical': '#f97316',
                'earnings': '#a855f7',
                'smart_money': '#eab308',
                'quality': '#06b6d4',
                'composite_score': '#f59e0b'
            };
            return colors[feature] || 'var(--accent)';
        }

        function formatFeatureName(feature) {
            return feature.replace(/_/g, ' ').replace(/\b\w/g, function (l) { return l.toUpperCase(); });
        }

        function formatMLDate(dateStr) {
            var d = new Date(dateStr);
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        // ============================================================================
        // ML TRANSPARENCY: Show users when ML benefits will activate
        // ============================================================================
        function renderMLProgress(closedCount) {
            // Check if ML transparency banner exists in Performance tab
            var banner = document.getElementById('ml-transparency-banner');
            if (!banner) {
                // Create banner if it doesn't exist
                var perfContent = document.getElementById('perf-content');
                if (!perfContent) return;

                banner = document.createElement('div');
                banner.id = 'ml-transparency-banner';
                banner.className = 'info-banner';
                banner.style.cssText = 'background:linear-gradient(135deg,rgba(168,85,247,0.1),rgba(99,102,241,0.1));border-color:rgba(168,85,247,0.3);margin-bottom:1.5rem;';

                // Insert after early-stage banner
                var earlyBanner = document.getElementById('perf-early-banner');
                if (earlyBanner && earlyBanner.nextSibling) {
                    perfContent.insertBefore(banner, earlyBanner.nextSibling);
                } else {
                    perfContent.insertBefore(banner, perfContent.firstChild);
                }
            }

            var closed = closedCount || 0;
            var needed = 30;
            var remaining = Math.max(0, needed - closed);
            var progress = Math.min(100, (closed / needed) * 100);

            var html = '<h4 style="color:var(--purple);display:flex;align-items:center;gap:8px;margin-bottom:0.75rem;">';
            html += '🤖 Machine Learning Training Progress';
            html += '</h4>';

            if (closed >= needed) {
                // ML is active
                html += '<div style="font-size:12px;color:var(--text-dim);line-height:1.7;">';
                html += '<strong style="color:var(--green);">✓ ML System Active</strong><br>';
                html += 'The Random Forest model has been trained with <strong style="color:var(--green);">' + closed + ' closed positions</strong>. ';
                html += 'Machine learning benefits are now <strong style="color:var(--green);">LIVE</strong>:<br><br>';
                html += '<ul style="margin:0.5rem 0;padding-left:1.5rem;">';
                html += '<li><strong>Feature Importance:</strong> View in <a href="#" onclick="switchTab(\'analysis\');return false;" style="color:var(--accent);">System Analysis</a> tab to see which factors predict success</li>';
                html += '<li><strong>Win Probability:</strong> Each new pick gets ML-enhanced prediction scores</li>';
                html += '<li><strong>Confidence Ratings:</strong> Model provides confidence levels for all recommendations</li>';
                html += '<li><strong>Continuous Learning:</strong> Model improves as more positions close</li>';
                html += '</ul>';
                html += '</div>';
            } else {
                // ML not yet active - show progress
                html += '<div style="font-size:12px;color:var(--text-dim);line-height:1.7;">';
                html += '<strong style="color:var(--yellow);">⏳ Training in Progress</strong><br>';
                html += 'The ML system requires <strong style="color:var(--text);">30 closed positions</strong> to train the Random Forest model. ';
                html += 'Currently: <strong style="color:' + (closed > 0 ? 'var(--green)' : 'var(--red)') + ';">' + closed + ' / 30 closed</strong> ';
                html += '(<strong style="color:var(--yellow);">' + remaining + ' more needed</strong>).<br><br>';

                // Progress bar
                html += '<div style="margin:0.75rem 0;">';
                html += '<div style="display:flex;justify-content:space-between;margin-bottom:4px;font-size:11px;">';
                html += '<span style="color:var(--text);">Training Progress</span>';
                html += '<span style="color:var(--accent);font-weight:700;">' + progress.toFixed(0) + '%</span>';
                html += '</div>';
                html += '<div style="width:100%;height:12px;background:var(--bg-dark);border-radius:6px;overflow:hidden;">';
                html += '<div style="width:' + progress + '%;height:100%;background:linear-gradient(90deg,var(--purple),var(--accent));border-radius:6px;transition:width 0.3s;"></div>';
                html += '</div></div>';

                html += '<strong style="color:var(--text);">What happens next:</strong><br>';
                html += '<ul style="margin:0.5rem 0;padding-left:1.5rem;">';
                html += '<li>Positions close when they hit <strong>+30%</strong> (take-profit), <strong>-15%</strong> (stop-loss), or <strong>90-day</strong> max hold</li>';
                html += '<li>Once 30+ positions close, the Random Forest model <strong>auto-trains</strong></li>';
                html += '<li>Model learns which factor combinations predict winners vs losers</li>';
                html += '<li>Future picks get <strong>ML-enhanced predictions</strong> with confidence scores</li>';
                html += '<li>View feature importance in <a href="#" onclick="switchTab(\'analysis\');return false;" style="color:var(--accent);">System Analysis</a> tab after training</li>';
                html += '</ul>';

                html += '<div style="margin-top:0.75rem;padding:0.75rem;background:rgba(168,85,247,0.1);border-radius:6px;border:1px solid rgba(168,85,247,0.2);">';
                html += '<strong style="color:var(--purple);">📊 Where to see ML benefits:</strong><br>';
                html += '<span style="font-size:11px;color:var(--text-dim);">';
                html += '• <strong>System Analysis tab:</strong> Feature importance rankings & model metrics<br>';
                html += '• <strong>Daily Picks tab:</strong> ML win probability & confidence scores (after training)<br>';
                html += '• <strong>Performance tab:</strong> This progress tracker updates automatically';
                html += '</span></div>';
                html += '</div>';
            }

            banner.innerHTML = html;
            banner.style.display = 'block';
        }

        // ============================================================================
        // UTILITY FUNCTIONS
        // ============================================================================
        function getExchangeBadge(ex) {
            var cls = 'badge-other';
            if (ex === 'TSX') cls = 'badge-tsx';
            else if (ex === 'TSX-V') cls = 'badge-tsxv';
            else if (ex === 'CSE') cls = 'badge-cse';
            else if (ex === 'NYSE' || ex === 'NYSE American' || ex === 'NYSE Arca') cls = 'badge-nyse';
            else if (ex === 'NASDAQ') cls = 'badge-nasdaq';
            return '<span class="exchange-badge ' + cls + '">' + esc(ex) + '</span>';
        }

        function scoreBar(score) {
            var c = score >= 75 ? 'var(--green)' : score >= 60 ? '#86efac' : score >= 48 ? 'var(--yellow)' : 'var(--red)';
            return '<div class="score-bar"><span class="score-val" style="color:' + c + '">' + score.toFixed(0) + '</span>'
                + '<div class="score-bar-bg"><div class="score-bar-fill" style="width:' + score + '%;background:' + c + '"></div></div></div>';
        }

        function scoreColor(score) {
            var c = score >= 75 ? 'var(--green)' : score >= 60 ? '#86efac' : score >= 48 ? 'var(--yellow)' : 'var(--red)';
            return '<span style="color:' + c + '">' + score.toFixed(1) + '</span>';
        }

        function miniBar(val, color) {
            if (val === undefined || val === null) return '-';
            var v = Math.round(val);
            return '<div style="display:inline-flex;align-items:center;gap:4px">'
                + '<div style="width:40px;height:5px;background:var(--bg-dark);border-radius:3px;overflow:hidden">'
                + '<div style="width:' + v + '%;height:100%;background:' + color + ';border-radius:3px"></div></div>'
                + '<span style="font-size:10px;color:var(--text-dim)">' + v + '</span></div>';
        }

        function factorBar(label, val, color) {
            if (val === undefined || val === null) val = 0;
            var v = Math.round(val);
            return '<div class="factor-row">'
                + '<span class="f-label">' + label + '</span>'
                + '<div class="f-bar-bg"><div class="f-bar" style="width:' + v + '%;background:' + color + '"></div></div>'
                + '<span class="f-val" style="color:' + color + '">' + v + '</span></div>';
        }

        function statCard(label, value, sub, color) {
            return '<div class="stat-card">'
                + '<div class="stat-label">' + label + '</div>'
                + '<div class="stat-value" style="color:' + (color || 'var(--text)') + '">' + value + '</div>'
                + (sub ? '<div class="stat-sub">' + sub + '</div>' : '')
                + '</div>';
        }

        function fmtNum(n) {
            if (n >= 1e9) return (n / 1e9).toFixed(1) + 'B';
            if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M';
            if (n >= 1e3) return (n / 1e3).toFixed(0) + 'K';
            return String(n);
        }

        function fmtMcap(n) {
            if (!n || n <= 0) return '<span style="color:var(--text-dim)">-</span>';
            if (n >= 1e9) return '$' + (n / 1e9).toFixed(2) + 'B';
            if (n >= 1e6) return '$' + (n / 1e6).toFixed(1) + 'M';
            if (n >= 1e3) return '$' + (n / 1e3).toFixed(0) + 'K';
            return '$' + n;
        }

        function fmtPrice(p) {
            if (!p || p <= 0) return '-';
            if (p < 0.01) return p.toFixed(4);
            if (p < 1) return p.toFixed(3);
            return p.toFixed(2);
        }

        function esc(s) {
            if (!s) return '';
            var d = document.createElement('div');
            d.textContent = s;
            return d.innerHTML;
        }

        // ── Methodology toggle ──
        function toggleMethodology(header) {
            header.classList.toggle('open');
            var body = header.nextElementSibling;
            body.classList.toggle('open');
        }

        // Auto-search scanner on load
        search(0);

        // Try loading picks badge count
        fetch('/findstocks/portfolio2/api/penny_stock_picks.php?action=picks&limit=1')
            .then(function (r) { return r.json(); })
            .then(function (d) {
                if (d.ok && d.count > 0) {
                    document.getElementById('picks-badge').textContent = d.count > 1 ? d.count : 'NEW';
                }
            }).catch(function () { });
    </script>
    <script src="/findstocks/portfolio2/stock-nav.js"></script>
</body>

</html>