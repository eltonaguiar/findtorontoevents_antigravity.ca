# Rapid Strategy Validation Engine - GitHub Actions Automation
# This workflow automates signal generation and resolution
# Runs every 5 minutes during market hours

name: RSVE Automation

on:
  schedule:
    # Run every 5 minutes
    - cron: '*/5 * * * *'
  workflow_dispatch:  # Allow manual trigger

jobs:
  generate-signals:
    runs-on: ubuntu-latest
    name: Generate Signals
    
    steps:
      - name: Generate New Signals
        run: |
          curl -s "${{ secrets.RSVE_BASE_URL }}/api/rapid_signal_engine.php?action=generate" \
            -H "User-Agent: RSVE-Automation" \
            --max-time 30
        continue-on-error: true

  scan-markets:
    runs-on: ubuntu-latest
    name: Scan & Resolve
    needs: generate-signals
    
    steps:
      - name: Resolve Completed Signals
        run: |
          curl -s "${{ secrets.RSVE_BASE_URL }}/api/rapid_signal_engine.php?action=scan" \
            -H "User-Agent: RSVE-Automation" \
            --max-time 30
        continue-on-error: true

  hourly-evaluation:
    runs-on: ubuntu-latest
    name: Strategy Evaluation
    
    steps:
      - name: Run Elimination Check
        run: |
          curl -s "${{ secrets.RSVE_BASE_URL }}/api/auto_eliminator.php?action=evaluate" \
            -H "User-Agent: RSVE-Automation" \
            --max-time 60
        continue-on-error: true

  notify-results:
    runs-on: ubuntu-latest
    name: Send Daily Summary
    if: github.event.schedule == '0 0 * * *'  # Only at midnight UTC
    
    steps:
      - name: Fetch Championship Round
        id: championship
        run: |
          RESULT=$(curl -s "${{ secrets.RSVE_BASE_URL }}/api/auto_eliminator.php?action=championship")
          echo "result=$RESULT" >> $GITHUB_OUTPUT
      
      - name: Send Discord Notification
        if: secrets.DISCORD_WEBHOOK != ''
        uses: Ilshidur/action-discord@master
        with:
          args: |
            ðŸš€ RSVE Daily Summary
            
            Championship Round Update:
            ${{ steps.championship.outputs.result }}
            
            View full dashboard: ${{ secrets.RSVE_BASE_URL }}/frontend/rapid_dashboard.html
