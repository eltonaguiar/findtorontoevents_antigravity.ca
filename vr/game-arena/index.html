<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game Arena - 1v1 VR Games | Toronto Events</title>
  <meta name="description" content="Play 1v1 games in VR! Tic-Tac-Toe, Soccer Shootout and more.">

  <!-- HTTPS redirect -->
  <script src="/vr/https-redirect.js"></script>

  <!-- A-Frame WebXR Framework -->
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

  <!-- Environment Component -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>

  <!-- Custom components -->
  <script>
    // Billboard: face camera
    AFRAME.registerComponent('look-at-camera', {
      tick: function () {
        var cam = this.el.sceneEl.camera;
        if (cam) this.el.object3D.lookAt(cam.getWorldPosition(new THREE.Vector3()));
      }
    });

    // Zone link: navigate on click WITH CONFIRMATION DIALOG
    AFRAME.registerComponent('zone-link', {
      schema: {
        url: { type: 'string', default: '' },
        label: { type: 'string', default: '' }
      },
      init: function () {
        var self = this;
        this.el.addEventListener('click', function () {
          if (!self.data.url) return;
          // Show confirmation dialog instead of auto-navigating
          showNavigationConfirm(self.data.label || self.data.url, self.data.url);
        });
        this.el.addEventListener('mouseenter', function () {
          self.el.setAttribute('animation__grow', 'property: scale; to: 1.1 1.1 1.1; dur: 200; easing: easeOutQuad');
        });
        this.el.addEventListener('mouseleave', function () {
          self.el.setAttribute('animation__grow', 'property: scale; to: 1 1 1; dur: 200; easing: easeOutQuad');
        });
      }
    });

    // Hover glow effect
    AFRAME.registerComponent('hover-glow', {
      schema: { color: { type: 'string', default: '#fff' } },
      init: function () {
        var self = this;
        var origColor = this.el.getAttribute('color') || this.el.getAttribute('material')?.color || '#fff';
        this.el.addEventListener('mouseenter', function () {
          self.el.setAttribute('material', 'emissive', self.data.color);
          self.el.setAttribute('material', 'emissiveIntensity', 0.3);
        });
        this.el.addEventListener('mouseleave', function () {
          self.el.setAttribute('material', 'emissiveIntensity', 0);
        });
      }
    });
  </script>

  <style>
    body { margin: 0; overflow: hidden; font-family: 'Inter', -apple-system, sans-serif; }

    /* Loading overlay */
    #loading {
      position: fixed; inset: 0;
      background: linear-gradient(135deg, #0a0a1f 0%, #1a0a2e 100%);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: 9999; color: white; transition: opacity 0.5s;
    }
    #loading h1 {
      font-size: 2.5rem; margin-bottom: 0.5rem;
      background: linear-gradient(90deg, #a855f7, #ec4899);
      background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    #loading p { color: #888; font-size: 1.1rem; }
    .spinner {
      width: 60px; height: 60px; border: 4px solid rgba(168,85,247,0.3);
      border-top-color: #a855f7; border-radius: 50%;
      animation: spin 1s linear infinite; margin-bottom: 1.5rem;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .hidden { display: none !important; }

    /* Instructions */
    #instructions {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.8); color: white; padding: 12px 24px;
      border-radius: 2rem; z-index: 100; text-align: center;
      backdrop-filter: blur(10px); border: 1px solid rgba(168,85,247,0.3);
      font-size: 14px; pointer-events: none;
      animation: fadeInUp 0.5s ease;
    }
    @keyframes fadeInUp { from { opacity: 0; transform: translateX(-50%) translateY(20px); } }

    /* HUD overlay */
    #hud {
      position: fixed; top: 16px; left: 16px; z-index: 200;
      display: flex; flex-direction: column; gap: 8px;
    }
    .hud-card {
      background: rgba(10,10,30,0.85); backdrop-filter: blur(10px);
      border: 1px solid rgba(168,85,247,0.3); border-radius: 12px;
      padding: 10px 16px; color: white; font-size: 13px;
    }
    .hud-card h3 { margin: 0 0 4px; font-size: 14px; color: #a855f7; }
    .hud-stats { display: flex; gap: 12px; }
    .hud-stat { text-align: center; }
    .hud-stat .val { font-size: 18px; font-weight: 700; }
    .hud-stat .lbl { font-size: 10px; text-transform: uppercase; letter-spacing: 0.05em; color: #888; }
    #hud-name { cursor: pointer; }
    #hud-name:hover { text-decoration: underline; }

    /* Toast notifications */
    #toast-container {
      position: fixed; top: 16px; right: 16px; z-index: 9000;
      display: flex; flex-direction: column; gap: 8px; max-width: 320px;
    }
    .toast {
      background: rgba(10,10,30,0.9); border: 1px solid rgba(168,85,247,0.5);
      border-radius: 12px; padding: 12px 16px; color: white;
      animation: toastIn 0.3s ease-out; font-size: 13px;
    }
    @keyframes toastIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    .toast-title { font-weight: 700; margin-bottom: 2px; }
    .toast-msg { color: #aaa; font-size: 12px; }
    .toast-actions { display: flex; gap: 6px; margin-top: 8px; }
    .toast-btn {
      padding: 4px 12px; border-radius: 6px; font-size: 12px; font-weight: 600;
      cursor: pointer; border: none; transition: all 0.2s;
    }
    .toast-btn.accept { background: #22c55e; color: white; }
    .toast-btn.decline { background: rgba(255,255,255,0.1); color: #aaa; }

    /* Back button */
    #back-btn {
      position: fixed; top: 16px; right: 16px; z-index: 200;
      background: rgba(10,10,30,0.85); backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.15); border-radius: 10px;
      padding: 8px 16px; color: white; font-size: 13px; cursor: pointer;
      text-decoration: none; transition: all 0.2s;
    }
    #back-btn:hover { border-color: rgba(168,85,247,0.5); background: rgba(10,10,30,0.95); }

    /* Navigation confirmation dialog */
    #nav-confirm {
      position: fixed; inset: 0; z-index: 10000;
      background: rgba(0,0,0,0.7); backdrop-filter: blur(8px);
      display: none; align-items: center; justify-content: center;
    }
    #nav-confirm.active { display: flex; }
    .nav-confirm-card {
      background: rgba(15,15,35,0.95);
      border: 1.5px solid rgba(168,85,247,0.4);
      border-radius: 20px; padding: 32px; max-width: 400px; width: 90%;
      text-align: center; box-shadow: 0 20px 60px rgba(168,85,247,0.15);
      animation: confirmPop 0.25s ease;
    }
    @keyframes confirmPop { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    .nav-confirm-card h2 { font-size: 1.3rem; margin-bottom: 8px; color: #fff; }
    .nav-confirm-card p { color: #94a3b8; font-size: 0.9rem; margin-bottom: 20px; }
    .nav-confirm-btns { display: flex; gap: 10px; justify-content: center; }
    .nav-confirm-btn {
      padding: 12px 28px; border-radius: 10px; font-size: 14px; font-weight: 700;
      cursor: pointer; border: none; transition: all 0.2s;
    }
    .nav-confirm-btn.yes {
      background: linear-gradient(135deg, #a855f7, #6366f1); color: #fff;
    }
    .nav-confirm-btn.yes:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(168,85,247,0.3); }
    .nav-confirm-btn.no {
      background: rgba(255,255,255,0.08); color: #94a3b8; border: 1px solid rgba(255,255,255,0.1);
    }
    .nav-confirm-btn.no:hover { background: rgba(255,255,255,0.12); color: #fff; }

    /* Visible menu button (always shown, top-left area below HUD) */
    #menu-btn {
      position: fixed; bottom: 16px; left: 16px; z-index: 200;
      background: linear-gradient(135deg, #a855f7, #6366f1);
      border: none; border-radius: 12px; padding: 10px 18px;
      color: white; font-size: 13px; font-weight: 600; cursor: pointer;
      display: flex; align-items: center; gap: 6px;
      box-shadow: 0 4px 16px rgba(168,85,247,0.3);
      transition: all 0.2s;
    }
    #menu-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(168,85,247,0.4); }
    #menu-btn .key-hint { font-size: 10px; opacity: 0.7; background: rgba(0,0,0,0.2); padding: 2px 6px; border-radius: 4px; }
  </style>
</head>
<body>

  <!-- Loading -->
  <div id="loading">
    <div class="spinner"></div>
    <h1>Game Arena</h1>
    <p>Entering the arena...</p>
  </div>

  <!-- Instructions -->
  <div id="instructions" class="hidden">
    Click a game portal to play | WASD to move | Mouse to look
  </div>

  <!-- HUD -->
  <div id="hud">
    <div class="hud-card">
      <h3 id="hud-name" onclick="editName()" title="Click to change name">Guest</h3>
      <div class="hud-stats">
        <div class="hud-stat"><div class="val" id="hud-wins">0</div><div class="lbl">Wins</div></div>
        <div class="hud-stat"><div class="val" id="hud-losses">0</div><div class="lbl">Losses</div></div>
        <div class="hud-stat"><div class="val" id="hud-draws">0</div><div class="lbl">Draws</div></div>
      </div>
    </div>
  </div>

  <!-- Back -->
  <a id="back-btn" href="/vr/">&#8592; VR Hub</a>

  <!-- Visible menu button -->
  <button id="menu-btn" onclick="if(window.toggleNavMenu)toggleNavMenu();" title="Open Menu (press M)">
    &#9776; Menu <span class="key-hint">M</span>
  </button>

  <!-- Navigation confirmation dialog -->
  <div id="nav-confirm">
    <div class="nav-confirm-card">
      <h2 id="nav-confirm-title">Play this game?</h2>
      <p id="nav-confirm-desc">You are about to navigate to a different game.</p>
      <div class="nav-confirm-btns">
        <button class="nav-confirm-btn yes" id="nav-confirm-yes">Yes, Play!</button>
        <button class="nav-confirm-btn no" id="nav-confirm-no">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Toast container -->
  <div id="toast-container"></div>

  <!-- ========== A-FRAME SCENE ========== -->
  <a-scene
    renderer="antialias: true; colorManagement: true; sortTransparentObjects: true"
    vr-mode-ui="enabled: true"
    loading-screen="enabled: false"
    cursor="rayOrigin: mouse; fuse: false"
    raycaster="objects: .clickable"
  >
    <a-assets></a-assets>

    <!-- Dark arena environment -->
    <a-entity environment="
      preset: starry;
      groundColor: #0a0a1f;
      groundTexture: none;
      dressing: none;
      skyType: atmosphere;
      skyColor: #050510;
      horizonColor: #1a0a2e;
      fog: 0.3"></a-entity>

    <!-- Arena Floor Platform -->
    <a-cylinder position="0 0 0" radius="18" height="0.1" color="#0a0a1f" opacity="0.9"></a-cylinder>
    <!-- Glowing rings -->
    <a-ring position="0 0.12 0" rotation="-90 0 0" radius-inner="5" radius-outer="5.15" color="#a855f7" opacity="0.6"
            animation="property: rotation; to: -90 360 0; dur: 40000; loop: true; easing: linear"></a-ring>
    <a-ring position="0 0.12 0" rotation="-90 0 0" radius-inner="10" radius-outer="10.1" color="#ec4899" opacity="0.3"
            animation="property: rotation; to: -90 -360 0; dur: 60000; loop: true; easing: linear"></a-ring>
    <a-ring position="0 0.12 0" rotation="-90 0 0" radius-inner="15" radius-outer="15.05" color="#3b82f6" opacity="0.2"
            animation="property: rotation; to: -90 360 0; dur: 80000; loop: true; easing: linear"></a-ring>

    <!-- ===== CENTRAL TITLE ===== -->
    <a-entity position="0 5 0" look-at-camera>
      <a-text value="GAME ARENA" align="center" width="12" color="#a855f7" font="mozillavr"
              animation="property: position; from: 0 0 0; to: 0 0.15 0; dur: 3000; dir: alternate; loop: true; easing: easeInOutSine"></a-text>
      <a-text value="1v1 Games" align="center" width="6" color="#ec4899" position="0 -0.7 0" font="mozillavr"></a-text>
      <a-text value="Click a portal to play" align="center" width="4" color="#888" position="0 -1.2 0"></a-text>
    </a-entity>

    <!-- ===== GAME PORTAL: TIC-TAC-TOE ===== -->
    <a-entity position="-8 0 -5">
      <!-- Floating game cube -->
      <a-box class="clickable" position="0 2 0" width="2.5" height="2.5" depth="2.5"
             color="#6366f1" opacity="0.85"
             zone-link="url: /vr/game-arena/tic-tac-toe.html; label: Tic-Tac-Toe"
             hover-glow="color: #6366f1"
             animation="property: rotation; to: 0 360 0; dur: 25000; loop: true; easing: linear">
        <!-- X and O on faces -->
        <a-text value="X O" align="center" position="0 0.3 1.26" width="5" color="#fff" font="mozillavr"></a-text>
        <a-text value="Tic-Tac\nToe" align="center" position="0 -0.4 1.26" width="3" color="#c7d2fe"></a-text>
        <a-text value="X O" align="center" position="0 0.3 -1.26" rotation="0 180 0" width="5" color="#fff" font="mozillavr"></a-text>
        <a-text value="Tic-Tac\nToe" align="center" position="0 -0.4 -1.26" rotation="0 180 0" width="3" color="#c7d2fe"></a-text>
        <a-text value="X O" align="center" position="1.26 0.3 0" rotation="0 90 0" width="5" color="#fff" font="mozillavr"></a-text>
        <a-text value="X O" align="center" position="-1.26 0.3 0" rotation="0 -90 0" width="5" color="#fff" font="mozillavr"></a-text>
      </a-box>
      <!-- ENTER button -->
      <a-entity position="0 -0.2 1.5" look-at-camera>
        <a-plane class="clickable" width="2.2" height="0.55" color="#6366f1" opacity="0.9"
                 zone-link="url: /vr/game-arena/tic-tac-toe.html; label: Tic-Tac-Toe"
                 animation="property: position; from: 0 0 0; to: 0 0.08 0; dur: 1500; dir: alternate; loop: true; easing: easeInOutSine">
          <a-text value="PLAY TIC-TAC-TOE" align="center" width="4" color="#fff" position="0 0 0.01" font="mozillavr"></a-text>
        </a-plane>
      </a-entity>
      <!-- Ground ring -->
      <a-ring position="0 0.02 0" rotation="-90 0 0" radius-inner="1.8" radius-outer="2" color="#6366f1" opacity="0.5"
              animation="property: rotation; to: -90 360 0; dur: 10000; loop: true; easing: linear"></a-ring>
      <a-cylinder position="0 0.01 0" radius="1.8" height="0.02" color="#6366f1" opacity="0.12"
                  class="clickable" zone-link="url: /vr/game-arena/tic-tac-toe.html; label: Tic-Tac-Toe"></a-cylinder>
      <!-- Floating label -->
      <a-entity position="0 4 0" look-at-camera>
        <a-text value="Tic-Tac-Toe" align="center" width="5" color="#6366f1"></a-text>
        <a-text value="Classic 3x3 Strategy" align="center" width="3" color="#888" position="0 -0.35 0"></a-text>
      </a-entity>
    </a-entity>

    <!-- ===== GAME PORTAL: SOCCER SHOOTOUT ===== -->
    <a-entity position="8 0 -5">
      <!-- Floating soccer ball (sphere) -->
      <a-sphere class="clickable" position="0 2 0" radius="1.3"
                color="#22c55e" opacity="0.85"
                zone-link="url: /vr/game-arena/soccer-shootout.html; label: Soccer Shootout"
                hover-glow="color: #22c55e"
                animation="property: rotation; to: 360 360 0; dur: 20000; loop: true; easing: linear">
        <a-text value="GOAL!" align="center" position="0 0.2 1.31" width="4" color="#fff" font="mozillavr"></a-text>
        <a-text value="Soccer\nShootout" align="center" position="0 -0.3 1.31" width="2.5" color="#bbf7d0"></a-text>
        <a-text value="GOAL!" align="center" position="0 0.2 -1.31" rotation="0 180 0" width="4" color="#fff" font="mozillavr"></a-text>
      </a-sphere>
      <!-- ENTER button -->
      <a-entity position="0 -0.2 1.5" look-at-camera>
        <a-plane class="clickable" width="2.4" height="0.55" color="#22c55e" opacity="0.9"
                 zone-link="url: /vr/game-arena/soccer-shootout.html; label: Soccer Shootout"
                 animation="property: position; from: 0 0 0; to: 0 0.08 0; dur: 1500; dir: alternate; loop: true; easing: easeInOutSine">
          <a-text value="PLAY SOCCER SHOOTOUT" align="center" width="4.5" color="#000" position="0 0 0.01" font="mozillavr"></a-text>
        </a-plane>
      </a-entity>
      <!-- Ground ring -->
      <a-ring position="0 0.02 0" rotation="-90 0 0" radius-inner="1.8" radius-outer="2" color="#22c55e" opacity="0.5"
              animation="property: rotation; to: -90 360 0; dur: 10000; loop: true; easing: linear"></a-ring>
      <a-cylinder position="0 0.01 0" radius="1.8" height="0.02" color="#22c55e" opacity="0.12"
                  class="clickable" zone-link="url: /vr/game-arena/soccer-shootout.html; label: Soccer Shootout"></a-cylinder>
      <!-- Floating label -->
      <a-entity position="0 4 0" look-at-camera>
        <a-text value="Soccer Shootout" align="center" width="5" color="#22c55e"></a-text>
        <a-text value="Best of 3 Penalties" align="center" width="3" color="#888" position="0 -0.35 0"></a-text>
      </a-entity>
    </a-entity>

    <!-- ===== GAME PORTAL: FPS ARENA (18+ PvP Multiplayer) ===== -->
    <a-entity position="-5 0 -12">
      <!-- Pulsing glow aura -->
      <a-sphere position="0 2 0" radius="2.2" color="#ef4444" opacity="0.06"
                animation="property: scale; from: 1 1 1; to: 1.2 1.2 1.2; dur: 2000; dir: alternate; loop: true; easing: easeInOutSine"></a-sphere>
      <!-- Floating weapon-shaped cube (slightly larger than others) -->
      <a-box class="clickable" position="0 2 0" width="3" height="3" depth="3"
             color="#ef4444" opacity="0.85"
             zone-link="url: /vr/game-arena/fps-arena.html; label: FPS Arena (18+)"
             hover-glow="color: #ef4444"
             animation="property: rotation; to: 0 360 0; dur: 18000; loop: true; easing: linear">
        <a-text value="FPS" align="center" position="0 0.4 1.51" width="7" color="#fff" font="mozillavr"></a-text>
        <a-text value="Arena\n18+" align="center" position="0 -0.4 1.51" width="3" color="#fecaca"></a-text>
        <a-text value="FPS" align="center" position="0 0.4 -1.51" rotation="0 180 0" width="7" color="#fff" font="mozillavr"></a-text>
        <a-text value="Arena\n18+" align="center" position="0 -0.4 -1.51" rotation="0 180 0" width="3" color="#fecaca"></a-text>
        <a-text value="PvP" align="center" position="1.51 0.4 0" rotation="0 90 0" width="7" color="#fff" font="mozillavr"></a-text>
        <a-text value="PvP" align="center" position="-1.51 0.4 0" rotation="0 -90 0" width="7" color="#fff" font="mozillavr"></a-text>
      </a-box>
      <!-- ENTER button -->
      <a-entity position="0 -0.2 2" look-at-camera>
        <a-plane class="clickable" width="3" height="0.6" color="#ef4444" opacity="0.9"
                 zone-link="url: /vr/game-arena/fps-arena.html; label: FPS Arena (18+)"
                 animation="property: position; from: 0 0 0; to: 0 0.08 0; dur: 1500; dir: alternate; loop: true; easing: easeInOutSine">
          <a-text value="PLAY FPS ARENA (18+)" align="center" width="5" color="#fff" position="0 0 0.01" font="mozillavr"></a-text>
        </a-plane>
      </a-entity>
      <!-- Ground ring (larger) -->
      <a-ring position="0 0.02 0" rotation="-90 0 0" radius-inner="2" radius-outer="2.3" color="#ef4444" opacity="0.5"
              animation="property: rotation; to: -90 360 0; dur: 6000; loop: true; easing: linear"></a-ring>
      <a-cylinder position="0 0.01 0" radius="2" height="0.02" color="#ef4444" opacity="0.15"
                  class="clickable" zone-link="url: /vr/game-arena/fps-arena.html; label: FPS Arena (18+)"></a-cylinder>
      <!-- Floating label -->
      <a-entity position="0 4.5 0" look-at-camera>
        <a-text value="FPS Arena" align="center" width="6" color="#ef4444" font="mozillavr"></a-text>
        <a-text value="18+ | PvP Multiplayer | AI Bots | Ranked" align="center" width="4.5" color="#888" position="0 -0.4 0"></a-text>
      </a-entity>
    </a-entity>

    <!-- ===== GAME PORTAL: ANT RUSH AR ===== -->
    <a-entity position="5 0 -12">
      <!-- Floating ant-themed sphere -->
      <a-sphere class="clickable" position="0 2 0" radius="1.4"
                color="#ff6b35" opacity="0.85"
                zone-link="url: /vr/ant-rush/; label: Ant Rush AR"
                hover-glow="color: #ff6b35"
                animation="property: rotation; to: 0 360 0; dur: 20000; loop: true; easing: linear">
        <a-text value="ANT" align="center" position="0 0.3 1.41" width="5" color="#fff" font="mozillavr"></a-text>
        <a-text value="RUSH" align="center" position="0 -0.3 1.41" width="4" color="#fde68a"></a-text>
        <a-text value="ANT" align="center" position="0 0.3 -1.41" rotation="0 180 0" width="5" color="#fff" font="mozillavr"></a-text>
        <a-text value="RUSH" align="center" position="0 -0.3 -1.41" rotation="0 180 0" width="4" color="#fde68a"></a-text>
      </a-sphere>
      <!-- ENTER button -->
      <a-entity position="0 -0.2 1.5" look-at-camera>
        <a-plane class="clickable" width="2.4" height="0.55" color="#ff6b35" opacity="0.9"
                 zone-link="url: /vr/ant-rush/; label: Ant Rush AR"
                 animation="property: position; from: 0 0 0; to: 0 0.08 0; dur: 1500; dir: alternate; loop: true; easing: easeInOutSine">
          <a-text value="PLAY ANT RUSH" align="center" width="4.5" color="#fff" position="0 0 0.01" font="mozillavr"></a-text>
        </a-plane>
      </a-entity>
      <!-- Ground ring -->
      <a-ring position="0 0.02 0" rotation="-90 0 0" radius-inner="1.8" radius-outer="2" color="#ff6b35" opacity="0.5"
              animation="property: rotation; to: -90 360 0; dur: 10000; loop: true; easing: linear"></a-ring>
      <a-cylinder position="0 0.01 0" radius="1.8" height="0.02" color="#ff6b35" opacity="0.12"
                  class="clickable" zone-link="url: /vr/ant-rush/; label: Ant Rush AR"></a-cylinder>
      <!-- Floating label -->
      <a-entity position="0 4 0" look-at-camera>
        <a-text value="Ant Rush AR" align="center" width="5" color="#ff6b35"></a-text>
        <a-text value="Augmented Reality Challenge" align="center" width="3" color="#888" position="0 -0.35 0"></a-text>
      </a-entity>
      <!-- Light -->
    </a-entity>

    <!-- Ant Rush light -->
    <a-light type="point" position="5 3 -12" color="#ff6b35" intensity="0.6" distance="12"></a-light>

    <!-- ===== LEADERBOARD PANEL ===== -->
    <a-entity position="8 1.5 2" rotation="0 -45 0" id="leaderboard-panel">
      <a-plane width="4" height="5" color="#0a0a1f" opacity="0.9" material="shader: flat">
        <a-plane width="3.8" height="4.8" color="#111128" opacity="0.95" position="0 0 0.01" material="shader: flat"></a-plane>
      </a-plane>
      <a-text value="LEADERBOARD" align="center" width="5" color="#a855f7" position="0 2 0.05" font="mozillavr"></a-text>
      <a-entity id="leaderboard-entries" position="0 0.8 0.05"></a-entity>
    </a-entity>

    <!-- ===== ONLINE PLAYERS AREA ===== -->
    <a-entity position="-8 1.5 2" rotation="0 45 0" id="players-panel">
      <a-plane width="4" height="5" color="#0a0a1f" opacity="0.9" material="shader: flat">
        <a-plane width="3.8" height="4.8" color="#111128" opacity="0.95" position="0 0 0.01" material="shader: flat"></a-plane>
      </a-plane>
      <a-text value="PLAYERS ONLINE" align="center" width="5" color="#22c55e" position="0 2 0.05" font="mozillavr"></a-text>
      <a-entity id="online-players" position="0 0.8 0.05"></a-entity>
    </a-entity>

    <!-- ===== RECENT MATCHES PANEL ===== -->
    <a-entity position="0 1.5 6" rotation="0 180 0" id="matches-panel">
      <a-plane width="5" height="3.5" color="#0a0a1f" opacity="0.9" material="shader: flat">
        <a-plane width="4.8" height="3.3" color="#111128" opacity="0.95" position="0 0 0.01" material="shader: flat"></a-plane>
      </a-plane>
      <a-text value="RECENT MATCHES" align="center" width="5" color="#ec4899" position="0 1.3 0.05" font="mozillavr"></a-text>
      <a-entity id="recent-matches" position="0 0.5 0.05"></a-entity>
    </a-entity>

    <!-- Floating particle decorations -->
    <a-sphere position="-8 4 -8" radius="0.1" color="#6366f1" opacity="0.5"
              animation="property: position; to: -8 6 -8; dur: 4000; loop: true; dir: alternate; easing: easeInOutSine"></a-sphere>
    <a-sphere position="8 3 -8" radius="0.12" color="#22c55e" opacity="0.5"
              animation="property: position; to: 8 5 -8; dur: 3500; loop: true; dir: alternate; easing: easeInOutSine"></a-sphere>
    <a-sphere position="0 5 -12" radius="0.08" color="#ec4899" opacity="0.4"
              animation="property: position; to: 0 7 -12; dur: 5000; loop: true; dir: alternate; easing: easeInOutSine"></a-sphere>
    <a-sphere position="-12 3 4" radius="0.15" color="#a855f7" opacity="0.3"
              animation="property: position; to: -12 5 4; dur: 4500; loop: true; dir: alternate; easing: easeInOutSine"></a-sphere>
    <a-sphere position="12 4 4" radius="0.1" color="#3b82f6" opacity="0.4"
              animation="property: position; to: 12 6 4; dur: 3800; loop: true; dir: alternate; easing: easeInOutSine"></a-sphere>

    <!-- Lighting -->
    <a-light type="ambient" color="#303060" intensity="0.4"></a-light>
    <a-light type="point" position="0 8 0" color="#a855f7" intensity="1" distance="30"></a-light>
    <a-light type="point" position="-7 3 -6" color="#6366f1" intensity="0.6" distance="12"></a-light>
    <a-light type="point" position="7 3 -6" color="#22c55e" intensity="0.6" distance="12"></a-light>
    <a-light type="point" position="0 3 -8" color="#ef4444" intensity="0.7" distance="14"></a-light>
    <a-light type="point" position="-8 3 2" color="#3b82f6" intensity="0.4" distance="10"></a-light>
    <a-light type="point" position="8 3 2" color="#ec4899" intensity="0.4" distance="10"></a-light>

    <!-- Camera Rig -->
    <a-entity id="rig" position="0 1.6 4">
      <a-camera look-controls wasd-controls="acceleration: 40" fov="80">
        <a-ring cursor="fuse: false"
                raycaster="objects: .clickable; far: 30"
                radius-inner="0.005" radius-outer="0.012"
                color="#a855f7" shader="flat"
                position="0 0 -1"
                animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 200"
                animation__fusing="property: scale; startEvents: fusing; from: 1 1 1; to: 0.5 0.5 0.5; dur: 1500; easing: linear"
                animation__mouseleave="property: scale; startEvents: mouseleave; to: 1 1 1; dur: 200">
        </a-ring>
      </a-camera>
      <a-entity id="left-hand" laser-controls="hand: left"
                raycaster="objects: .clickable; far: 25; lineColor: #a855f7; lineOpacity: 0.5"
                cursor="rayOrigin: entity; fuse: false"></a-entity>
      <a-entity id="right-hand" laser-controls="hand: right"
                raycaster="objects: .clickable; far: 25; lineColor: #ec4899; lineOpacity: 0.5"
                cursor="rayOrigin: entity; fuse: false"></a-entity>
    </a-entity>
  </a-scene>

  <script>
  (function() {
    'use strict';

    // ===== LOADING =====
    window.addEventListener('load', function () {
      setTimeout(function () {
        var el = document.getElementById('loading');
        el.style.opacity = '0';
        setTimeout(function () {
          el.classList.add('hidden');
          document.getElementById('instructions').classList.remove('hidden');
          setTimeout(function () {
            document.getElementById('instructions').style.opacity = '0';
            document.getElementById('instructions').style.transition = 'opacity 1s';
          }, 6000);
        }, 500);
      }, 1200);
    });

    // ===== STATE =====
    var STORAGE_KEY = 'gameArena';
    var state = loadState();

    function loadState() {
      try {
        var s = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
        return {
          playerName: s.playerName || 'Guest_' + Math.floor(Math.random() * 9000 + 1000),
          wins: s.wins || 0, losses: s.losses || 0, draws: s.draws || 0,
          matches: s.matches || [],
          playerId: s.playerId || 'p_' + Date.now()
        };
      } catch(e) {
        return { playerName: 'Guest_' + Math.floor(Math.random() * 9000 + 1000), wins: 0, losses: 0, draws: 0, matches: [], playerId: 'p_' + Date.now() };
      }
    }
    function saveState() { try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch(e) {} }

    // ===== HUD =====
    function updateHUD() {
      document.getElementById('hud-name').textContent = state.playerName;
      document.getElementById('hud-wins').textContent = state.wins;
      document.getElementById('hud-losses').textContent = state.losses;
      document.getElementById('hud-draws').textContent = state.draws;
    }

    window.editName = function() {
      var n = prompt('Enter your player name:', state.playerName);
      if (n && n.trim()) { state.playerName = n.trim().substring(0, 20); saveState(); updateHUD(); }
    };

    // ===== BOT PLAYERS =====
    var BOT_NAMES = ['TorontoGamer','MapleLeaf99','PuckMaster','CityExplorer','EventHunter',
      'NightOwlTO','LakeShoreRun','QueenWestAce','KensingtonKid','DistilleryDan','YongeStar','BloorBeast'];
    var COLORS = ['#6366f1','#ec4899','#22c55e','#f59e0b','#3b82f6','#14b8a6','#f97316','#a855f7'];

    // ===== 3D LEADERBOARD =====
    function renderLeaderboard() {
      var container = document.getElementById('leaderboard-entries');
      if (!container) return;
      container.innerHTML = '';
      var entries = [{ name: state.playerName, wins: state.wins, isMe: true }];
      BOT_NAMES.slice(0, 7).forEach(function(n, i) {
        entries.push({ name: n, wins: Math.floor(Math.random() * 15) + 2, isMe: false });
      });
      entries.sort(function(a, b) { return b.wins - a.wins; });
      entries.forEach(function(e, i) {
        var y = -i * 0.45;
        var color = i === 0 ? '#fbbf24' : i === 1 ? '#94a3b8' : i === 2 ? '#d97706' : '#888';
        var nameColor = e.isMe ? '#a855f7' : '#fff';
        var rank = document.createElement('a-text');
        rank.setAttribute('value', '#' + (i + 1));
        rank.setAttribute('align', 'left');
        rank.setAttribute('width', '3');
        rank.setAttribute('color', color);
        rank.setAttribute('position', '-1.6 ' + y + ' 0');
        container.appendChild(rank);

        var name = document.createElement('a-text');
        name.setAttribute('value', e.name + (e.isMe ? ' (You)' : ''));
        name.setAttribute('align', 'left');
        name.setAttribute('width', '2.5');
        name.setAttribute('color', nameColor);
        name.setAttribute('position', '-1 ' + y + ' 0');
        container.appendChild(name);

        var wins = document.createElement('a-text');
        wins.setAttribute('value', e.wins + 'W');
        wins.setAttribute('align', 'right');
        wins.setAttribute('width', '2.5');
        wins.setAttribute('color', color);
        wins.setAttribute('position', '1.6 ' + y + ' 0');
        container.appendChild(wins);
      });
    }

    // ===== 3D ONLINE PLAYERS =====
    function renderPlayers() {
      var container = document.getElementById('online-players');
      if (!container) return;
      container.innerHTML = '';
      var count = 3 + Math.floor(Math.random() * 4);
      var shuffled = BOT_NAMES.slice().sort(function() { return Math.random() - 0.5; });
      for (var i = 0; i < count && i < shuffled.length; i++) {
        var y = -i * 0.5;
        var isInGame = Math.random() > 0.6;
        var statusColor = isInGame ? '#f59e0b' : '#22c55e';
        var statusText = isInGame ? 'In Game' : 'In Lobby';

        var name = document.createElement('a-text');
        name.setAttribute('value', shuffled[i]);
        name.setAttribute('align', 'left');
        name.setAttribute('width', '2.8');
        name.setAttribute('color', '#fff');
        name.setAttribute('position', '-1.6 ' + y + ' 0');
        container.appendChild(name);

        var status = document.createElement('a-text');
        status.setAttribute('value', statusText);
        status.setAttribute('align', 'right');
        status.setAttribute('width', '2');
        status.setAttribute('color', statusColor);
        status.setAttribute('position', '1.6 ' + y + ' 0');
        container.appendChild(status);
      }
    }

    // ===== 3D RECENT MATCHES =====
    function renderMatches() {
      var container = document.getElementById('recent-matches');
      if (!container) return;
      container.innerHTML = '';
      if (!state.matches || state.matches.length === 0) {
        var t = document.createElement('a-text');
        t.setAttribute('value', 'No matches yet. Play a game!');
        t.setAttribute('align', 'center');
        t.setAttribute('width', '3');
        t.setAttribute('color', '#666');
        t.setAttribute('position', '0 0 0');
        container.appendChild(t);
        return;
      }
      var recent = state.matches.slice(-5).reverse();
      recent.forEach(function(m, i) {
        var y = -i * 0.4;
        var color = m.result === 'win' ? '#22c55e' : m.result === 'loss' ? '#ef4444' : '#f59e0b';
        var resultText = m.result.charAt(0).toUpperCase() + m.result.slice(1);

        var info = document.createElement('a-text');
        info.setAttribute('value', (m.game || 'Game') + ' vs ' + (m.opponent || 'AI'));
        info.setAttribute('align', 'left');
        info.setAttribute('width', '2.8');
        info.setAttribute('color', '#ccc');
        info.setAttribute('position', '-2 ' + y + ' 0');
        container.appendChild(info);

        var result = document.createElement('a-text');
        result.setAttribute('value', resultText);
        result.setAttribute('align', 'right');
        result.setAttribute('width', '2.5');
        result.setAttribute('color', color);
        result.setAttribute('position', '2 ' + y + ' 0');
        container.appendChild(result);
      });
    }

    // ===== TOAST =====
    function showToast(title, msg, actions) {
      var c = document.getElementById('toast-container');
      var t = document.createElement('div');
      t.className = 'toast';
      t.innerHTML = '<div class="toast-title">' + title + '</div><div class="toast-msg">' + msg + '</div>' + (actions || '');
      c.appendChild(t);
      setTimeout(function() { t.style.opacity = '0'; t.style.transition = 'opacity 0.3s'; setTimeout(function() { t.remove(); }, 300); }, 5000);
    }

    // ===== INCOMING CHALLENGE SIMULATION =====
    function simulateChallenge() {
      var delay = 20000 + Math.random() * 40000;
      setTimeout(function() {
        var challenger = BOT_NAMES[Math.floor(Math.random() * BOT_NAMES.length)];
        var games = [{ name: 'Tic-Tac-Toe', url: '/vr/game-arena/tic-tac-toe.html' }, { name: 'Soccer Shootout', url: '/vr/game-arena/soccer-shootout.html' }, { name: 'FPS Arena', url: '/vr/game-arena/fps-arena.html' }];
        var game = games[Math.floor(Math.random() * games.length)];
        var c = document.getElementById('toast-container');
        var t = document.createElement('div');
        t.className = 'toast';
        t.innerHTML = '<div class="toast-title">' + challenger + ' challenges you!</div>'
          + '<div class="toast-msg">' + game.name + '</div>'
          + '<div class="toast-actions">'
          + '<button class="toast-btn accept" onclick="showNavigationConfirm(\'' + game.name + '\', \'' + game.url + '?opponent=' + encodeURIComponent(challenger) + '\')">Accept</button>'
          + '<button class="toast-btn decline" onclick="this.closest(\'.toast\').remove()">Decline</button>'
          + '</div>';
        c.appendChild(t);
        setTimeout(function() { if (t.parentNode) { t.style.opacity = '0'; t.style.transition = 'opacity 0.3s'; setTimeout(function(){ t.remove(); }, 300); } }, 12000);
        simulateChallenge();
      }, delay);
    }

    // ===== INIT =====
    function init() {
      var scene = document.querySelector('a-scene');
      function onReady() {
        saveState();
        updateHUD();
        renderLeaderboard();
        renderPlayers();
        renderMatches();
        simulateChallenge();
        setInterval(renderPlayers, 30000);
      }
      if (scene && scene.hasLoaded) onReady();
      else if (scene) scene.addEventListener('loaded', onReady);
      else document.addEventListener('DOMContentLoaded', function() {
        var s = document.querySelector('a-scene');
        if (s) s.addEventListener('loaded', onReady);
      });
    }
    init();
  })();
  </script>

  <!-- Navigation confirmation dialog logic -->
  <script>
  (function() {
    'use strict';
    var confirmEl = document.getElementById('nav-confirm');
    var confirmTitle = document.getElementById('nav-confirm-title');
    var confirmDesc = document.getElementById('nav-confirm-desc');
    var confirmYes = document.getElementById('nav-confirm-yes');
    var confirmNo = document.getElementById('nav-confirm-no');
    var pendingUrl = null;

    window.showNavigationConfirm = function(label, url) {
      pendingUrl = url;
      confirmTitle.textContent = 'Play ' + label + '?';
      confirmDesc.textContent = 'You will be taken to ' + label + '. Continue?';
      confirmEl.classList.add('active');
    };

    confirmYes.addEventListener('click', function() {
      confirmEl.classList.remove('active');
      if (pendingUrl) {
        window.location.href = pendingUrl;
      }
    });

    confirmNo.addEventListener('click', function() {
      confirmEl.classList.remove('active');
      pendingUrl = null;
    });

    // Close on Escape
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && confirmEl.classList.contains('active')) {
        confirmEl.classList.remove('active');
        pendingUrl = null;
      }
    });

    // Close on clicking outside the card
    confirmEl.addEventListener('click', function(e) {
      if (e.target === confirmEl) {
        confirmEl.classList.remove('active');
        pendingUrl = null;
      }
    });
  })();
  </script>

  <!-- VR Navigation Menu (provides M/Tab menu, floating button, Quest gamepad support) -->
  <script src="/vr/nav-menu.js"></script>
</body>
</html>
