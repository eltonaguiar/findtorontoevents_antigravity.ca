<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meme Coin Scanner | Quick Profit Plays</title>
  <style>
    :root {
      --bg: #0a0a1a;
      --card: #12122a;
      --border: #2a2a4a;
      --text: #e0e0f0;
      --dim: #8888aa;
      --green: #22c55e;
      --red: #ef4444;
      --gold: #f59e0b;
      --accent: #e879f9;
      --cyan: #06b6d4;
      --radius: 12px
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh
    }

    a {
      color: #c4b5fd;
      text-decoration: none
    }

    a:hover {
      text-decoration: underline
    }

    .header {
      text-align: center;
      padding: 40px 20px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06)
    }

    .header h1 {
      font-size: 28px;
      font-weight: 200;
      letter-spacing: 4px;
      text-transform: uppercase;
      color: #fff
    }

    .header .sub {
      color: var(--dim);
      font-size: 13px;
      margin-top: 6px
    }

    .nav {
      display: flex;
      gap: 8px;
      justify-content: center;
      padding: 16px;
      flex-wrap: wrap
    }

    .nav a {
      font-size: 12px;
      padding: 4px 14px;
      border-radius: 20px;
      border: 1px solid var(--border);
      color: var(--dim);
      transition: all 0.15s
    }

    .nav a:hover,
    .nav a.active {
      border-color: var(--accent);
      color: var(--accent);
      text-decoration: none;
      background: rgba(232, 121, 249, 0.08)
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px
    }

    .warning-bar {
      background: rgba(239, 68, 68, 0.12);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: var(--radius);
      padding: 12px 16px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
      color: #fca5a5
    }

    .warning-bar strong {
      color: var(--red)
    }

    .stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      margin-bottom: 24px
    }

    .stat-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      text-align: center
    }

    .stat-card .label {
      font-size: 11px;
      color: var(--dim);
      text-transform: uppercase;
      letter-spacing: 1px
    }

    .stat-card .value {
      font-size: 24px;
      font-weight: 700;
      margin-top: 4px
    }

    .stat-card .sub {
      font-size: 11px;
      color: var(--dim);
      margin-top: 2px
    }

    .green {
      color: var(--green)
    }

    .red {
      color: var(--red)
    }

    .gold {
      color: var(--gold)
    }

    .cyan {
      color: var(--cyan)
    }

    .accent {
      color: var(--accent)
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      margin: 24px 0 12px;
      display: flex;
      align-items: center;
      gap: 8px
    }

    .badge {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 4px;
      text-transform: uppercase;
      font-weight: 700;
      letter-spacing: 1px
    }

    .badge-strong {
      background: rgba(232, 121, 249, 0.2);
      color: var(--accent);
      border: 1px solid rgba(232, 121, 249, 0.4)
    }

    .badge-buy {
      background: rgba(168, 85, 247, 0.15);
      color: #c084fc;
      border: 1px solid rgba(168, 85, 247, 0.3)
    }

    .badge-lean {
      background: rgba(234, 179, 8, 0.15);
      color: var(--gold);
      border: 1px solid rgba(234, 179, 8, 0.3)
    }

    .badge-tier1 {
      background: rgba(96, 165, 250, 0.12);
      color: #93c5fd;
      border: 1px solid rgba(96, 165, 250, 0.25);
      font-size: 9px;
      padding: 1px 6px
    }

    .badge-tier2 {
      background: rgba(52, 211, 153, 0.12);
      color: #6ee7b7;
      border: 1px solid rgba(52, 211, 153, 0.25);
      font-size: 9px;
      padding: 1px 6px
    }

    .winner-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 12px;
      transition: all 0.2s;
      position: relative
    }

    .winner-card:hover {
      border-color: var(--accent);
      box-shadow: 0 4px 20px rgba(232, 121, 249, 0.1);
      transform: translateY(-2px)
    }

    .winner-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent), var(--cyan));
      opacity: 0;
      transition: opacity 0.2s;
      border-radius: var(--radius) var(--radius) 0 0
    }

    .winner-card:hover::before {
      opacity: 1
    }

    .winner-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px
    }

    .winner-pair {
      font-size: 18px;
      font-weight: 700;
      color: #fff
    }

    .winner-score {
      font-size: 28px;
      font-weight: 800
    }

    .winner-meta {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-top: 8px;
      font-size: 12px;
      color: var(--dim)
    }

    .winner-meta span {
      display: flex;
      align-items: center;
      gap: 4px
    }

    .factors {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 8px;
      margin-top: 12px
    }

    .factor {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.04);
      border-radius: 8px;
      padding: 8px 10px;
      font-size: 11px
    }

    .factor-name {
      color: var(--dim);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 10px
    }

    .factor-bar {
      height: 4px;
      background: rgba(255, 255, 255, 0.06);
      border-radius: 2px;
      margin-top: 4px;
      overflow: hidden
    }

    .factor-fill {
      height: 100%;
      border-radius: 2px;
      transition: width 0.5s
    }

    .history-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-top: 12px
    }

    .history-table th {
      text-align: left;
      padding: 8px;
      color: var(--dim);
      border-bottom: 1px solid var(--border);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px
    }

    .history-table td {
      padding: 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.03)
    }

    .outcome-win {
      color: var(--green);
      font-weight: 700
    }

    .outcome-loss {
      color: var(--red);
      font-weight: 700
    }

    .outcome-pending {
      color: var(--dim)
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: var(--dim)
    }

    .disclaimer {
      font-size: 11px;
      color: #555;
      margin-top: 32px;
      padding: 12px;
      border: 1px solid rgba(255, 255, 255, 0.04);
      border-radius: 8px;
      line-height: 1.6
    }

    .info-tip {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: rgba(232, 121, 249, 0.2);
      color: var(--accent);
      font-size: 10px;
      font-weight: 700;
      cursor: help;
      position: relative;
      vertical-align: middle;
      margin-left: 4px;
      flex-shrink: 0;
      font-style: normal
    }

    .info-tip:hover {
      background: rgba(232, 121, 249, 0.4)
    }

    .info-tip .tip-text {
      display: none;
      position: absolute;
      bottom: calc(100% + 8px);
      left: 50%;
      transform: translateX(-50%);
      background: #1e1e3a;
      border: 1px solid var(--accent);
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 12px;
      font-weight: 400;
      color: var(--text);
      width: 260px;
      line-height: 1.5;
      z-index: 100;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      pointer-events: none
    }

    .info-tip:hover .tip-text {
      display: block
    }

    .info-tip .tip-text::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-top-color: var(--accent)
    }

    .edu-section {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-top: 24px;
      overflow: hidden
    }

    .edu-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      cursor: pointer;
      user-select: none
    }

    .edu-header:hover {
      background: rgba(255, 255, 255, 0.02)
    }

    .edu-header h3 {
      font-size: 16px;
      font-weight: 600;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px
    }

    .edu-arrow {
      font-size: 12px;
      color: var(--dim);
      transition: transform 0.2s
    }

    .edu-arrow.open {
      transform: rotate(180deg)
    }

    .edu-body {
      padding: 0 20px 20px;
      display: none
    }

    .edu-body.open {
      display: block
    }

    .glossary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 12px;
      margin-top: 8px
    }

    .glossary-card {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 8px;
      padding: 14px
    }

    .glossary-card .g-term {
      font-weight: 700;
      color: #fff;
      font-size: 13px;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px
    }

    .glossary-card .g-term .g-pts {
      font-size: 11px;
      color: var(--accent);
      font-weight: 400
    }

    .glossary-card .g-desc {
      font-size: 12px;
      color: #bbb;
      line-height: 1.6
    }

    .glossary-card .g-why {
      font-size: 11px;
      color: var(--dim);
      margin-top: 6px;
      font-style: italic
    }

    .tier-explain {
      display: flex;
      gap: 12px;
      margin: 12px 0;
      flex-wrap: wrap
    }

    .tier-card {
      flex: 1;
      min-width: 180px;
      padding: 14px;
      border-radius: 8px;
      text-align: center
    }

    .tier-card.strong {
      background: rgba(232, 121, 249, 0.08);
      border: 1px solid rgba(232, 121, 249, 0.2)
    }

    .tier-card.buy {
      background: rgba(168, 85, 247, 0.08);
      border: 1px solid rgba(168, 85, 247, 0.2)
    }

    .tier-card.lean {
      background: rgba(245, 158, 11, 0.08);
      border: 1px solid rgba(245, 158, 11, 0.2)
    }

    .tier-card .t-label {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 4px
    }

    .tier-card .t-range {
      font-size: 12px;
      color: var(--dim);
      margin-bottom: 8px
    }

    .tier-card .t-desc {
      font-size: 12px;
      line-height: 1.5
    }

    .tier-card.strong .t-label {
      color: var(--accent)
    }

    .tier-card.buy .t-label {
      color: #c084fc
    }

    .tier-card.lean .t-label {
      color: var(--gold)
    }

    .method-step {
      display: flex;
      gap: 12px;
      margin: 12px 0;
      align-items: flex-start
    }

    .method-num {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--accent);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 700;
      flex-shrink: 0
    }

    .method-text {
      font-size: 13px;
      line-height: 1.6;
      color: #ccc
    }

    .method-text strong {
      color: #fff
    }

    .flaw-item {
      display: flex;
      gap: 8px;
      margin: 8px 0;
      font-size: 12px;
      line-height: 1.5;
      color: #ccc
    }

    .flaw-icon {
      font-size: 14px;
      flex-shrink: 0;
      margin-top: 1px
    }

    .scan-log-controls {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 12px
    }

    .scan-select {
      background: var(--card);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer
    }

    .scan-select:focus {
      outline: none;
      border-color: var(--accent)
    }

    .scan-meta {
      font-size: 11px;
      color: var(--dim)
    }

    .scan-log-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
      margin-top: 8px
    }

    .scan-log-table th {
      text-align: center;
      padding: 6px 4px;
      color: var(--dim);
      border-bottom: 1px solid var(--border);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      white-space: nowrap
    }

    .scan-log-table th:first-child,
    .scan-log-table th:nth-child(2) {
      text-align: left
    }

    .scan-log-table td {
      padding: 6px 4px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.03);
      text-align: center;
      white-space: nowrap
    }

    .scan-log-table td:first-child,
    .scan-log-table td:nth-child(2) {
      text-align: left
    }

    .scan-log-table tr:hover {
      background: rgba(255, 255, 255, 0.02)
    }

    .scan-log-table tr.is-winner {
      background: rgba(232, 121, 249, 0.04)
    }

    .factor-cell {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 36px;
      padding: 2px 5px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600
    }

    .factor-cell.f-high {
      background: rgba(34, 197, 94, 0.15);
      color: var(--green)
    }

    .factor-cell.f-mid {
      background: rgba(245, 158, 11, 0.15);
      color: var(--gold)
    }

    .factor-cell.f-low {
      background: rgba(239, 68, 68, 0.12);
      color: var(--red)
    }

    .verdict-skip {
      color: var(--dim);
      font-size: 10px
    }

    /* Main page tabs */
    .main-tabs {
      display: flex;
      gap: 0;
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 20px
    }

    .main-tab-btn {
      flex: 1;
      background: var(--card);
      color: var(--dim);
      border: none;
      padding: 12px 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
      text-align: center
    }

    .main-tab-btn:not(:last-child) {
      border-right: 1px solid var(--border)
    }

    .main-tab-btn.active {
      background: var(--accent);
      color: #fff
    }

    .main-tab-btn:hover:not(.active) {
      background: rgba(255, 255, 255, 0.04);
      color: var(--text)
    }

    .main-panel {
      display: none
    }

    .main-panel.active {
      display: block
    }

    /* Perf period tabs */
    .tab-row {
      display: flex;
      gap: 4px;
      margin-bottom: 16px;
      flex-wrap: wrap
    }

    .tab-btn {
      font-size: 12px;
      padding: 6px 16px;
      border-radius: 20px;
      border: 1px solid var(--border);
      color: var(--dim);
      background: transparent;
      cursor: pointer;
      transition: all 0.15s
    }

    .tab-btn:hover,
    .tab-btn.active {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(232, 121, 249, 0.08)
    }

    /* Performance grid */
    .perf-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      margin-bottom: 16px
    }

    .perf-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      text-align: center
    }

    .perf-card .p-label {
      font-size: 10px;
      color: var(--dim);
      text-transform: uppercase;
      letter-spacing: 1px
    }

    .perf-card .p-val {
      font-size: 20px;
      font-weight: 700;
      margin-top: 2px
    }

    .perf-card .p-sub {
      font-size: 10px;
      color: var(--dim);
      margin-top: 2px
    }

    /* Daily table */
    .daily-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-top: 8px
    }

    .daily-table th {
      text-align: left;
      padding: 6px 8px;
      color: var(--dim);
      border-bottom: 1px solid var(--border);
      font-size: 10px;
      text-transform: uppercase
    }

    .daily-table td {
      padding: 6px 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.03)
    }

    .daily-table tr:hover {
      background: rgba(255, 255, 255, 0.02)
    }

    /* Picks date controls */
    .picks-controls {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 12px
    }

    .picks-date-label {
      font-size: 13px;
      color: var(--dim)
    }

    .picks-summary {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      font-size: 12px;
      color: var(--dim);
      margin-bottom: 8px
    }

    .picks-summary span {
      display: flex;
      align-items: center;
      gap: 4px
    }

    /* Freshness badges */
    .freshness-bar {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 16px;
      margin-bottom: 12px;
      border-radius: var(--radius);
      font-size: 12px;
      border: 1px solid var(--border);
      background: var(--card)
    }

    .freshness-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
      animation: pulse 2s infinite
    }

    .freshness-fresh .freshness-dot {
      background: #22c55e;
      box-shadow: 0 0 6px rgba(34, 197, 94, 0.5)
    }

    .freshness-aging .freshness-dot {
      background: #f59e0b;
      box-shadow: 0 0 6px rgba(245, 158, 11, 0.5)
    }

    .freshness-stale .freshness-dot {
      background: #ef4444;
      box-shadow: 0 0 6px rgba(239, 68, 68, 0.5)
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1
      }

      50% {
        opacity: 0.5
      }
    }

    .signal-age-badge {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 4px;
      font-weight: 600;
      letter-spacing: 0.5px
    }

    .age-fresh {
      background: rgba(34, 197, 94, 0.15);
      color: #22c55e;
      border: 1px solid rgba(34, 197, 94, 0.3)
    }

    .age-aging {
      background: rgba(245, 158, 11, 0.15);
      color: #f59e0b;
      border: 1px solid rgba(245, 158, 11, 0.3)
    }

    .age-stale {
      background: rgba(239, 68, 68, 0.15);
      color: #ef4444;
      border: 1px solid rgba(239, 68, 68, 0.3)
    }

    .winner-card.stale-card {
      opacity: 0.55;
      border-color: rgba(239, 68, 68, 0.3)
    }

    .winner-card.stale-card:hover {
      opacity: 0.8
    }

    .stale-overlay {
      background: rgba(239, 68, 68, 0.08);
      border: 1px solid rgba(239, 68, 68, 0.2);
      border-radius: 6px;
      padding: 6px 10px;
      margin: 8px 0;
      font-size: 11px;
      color: #fca5a5;
      text-align: center
    }

    .winner-card.card-invalidated {
      opacity: 0.35;
      border-color: rgba(239, 68, 68, 0.4);
      pointer-events: auto;
      position: relative;
      transition: all 0.3s
    }

    .hide-invalidated .winner-card.card-invalidated {
      display: none
    }

    .winner-card.card-not-kraken {
      position: relative
    }

    .kraken-only-mode .winner-card.card-not-kraken {
      display: none
    }

    .winner-card.card-invalidated:hover {
      opacity: 0.55
    }

    .winner-card.card-invalidated .winner-pair {
      text-decoration: line-through;
      color: #888
    }

    .winner-card.card-invalidated .winner-score {
      text-decoration: line-through;
      opacity: 0.5
    }

    .winner-card.card-invalidated .buy-now-badge {
      display: none
    }

    .winner-card.card-caution {
      border-color: rgba(245, 158, 11, 0.5);
      box-shadow: inset 0 0 20px rgba(245, 158, 11, 0.05)
    }

    .winner-card.card-valid {
      border-color: rgba(34, 197, 94, 0.4);
      box-shadow: inset 0 0 20px rgba(34, 197, 94, 0.05)
    }

    .live-verdict-banner {
      padding: 8px 12px;
      border-radius: 6px;
      margin: 0 0 8px 0;
      font-size: 12px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap
    }

    .live-verdict-banner.v-invalidated {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #fca5a5
    }

    .live-verdict-banner.v-caution {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.3);
      color: #fcd34d
    }

    .live-verdict-banner.v-valid {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      color: #86efac
    }

    .live-verdict-banner .v-price {
      font-weight: 400;
      font-size: 11px;
      color: var(--dim)
    }

    #auto-verify-summary {
      margin-bottom: 12px;
      transition: all 0.3s
    }

    .no-viable-banner {
      background: rgba(239, 68, 68, 0.08);
      border: 1px solid rgba(239, 68, 68, 0.25);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      margin-bottom: 16px
    }

    .no-viable-banner h3 {
      color: #fca5a5;
      margin: 0 0 8px 0;
      font-size: 16px
    }

    .no-viable-banner p {
      color: var(--dim);
      margin: 0;
      font-size: 13px;
      line-height: 1.6
    }

    .some-viable-banner {
      background: rgba(34, 197, 94, 0.08);
      border: 1px solid rgba(34, 197, 94, 0.25);
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 13px
    }

    .some-viable-banner .viable-count {
      background: rgba(34, 197, 94, 0.2);
      color: #86efac;
      padding: 3px 10px;
      border-radius: 6px;
      font-weight: 800;
      font-size: 12px;
      border: 1px solid rgba(34, 197, 94, 0.3)
    }

    /* BUY NOW badge & ranking */
    .buy-now-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: linear-gradient(135deg, rgba(232, 121, 249, 0.25), rgba(6, 182, 212, 0.25));
      color: #fff;
      font-size: 11px;
      font-weight: 700;
      padding: 4px 12px;
      border-radius: 6px;
      border: 1px solid rgba(232, 121, 249, 0.4);
      cursor: pointer;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.5px
    }

    .buy-now-badge:hover {
      background: linear-gradient(135deg, rgba(232, 121, 249, 0.4), rgba(6, 182, 212, 0.4));
      transform: scale(1.05);
      box-shadow: 0 2px 12px rgba(232, 121, 249, 0.3)
    }

    .buy-now-rank {
      font-size: 10px;
      color: var(--dim);
      margin-left: 6px
    }

    .buy-now-rank .rank-val {
      font-weight: 700;
      font-size: 13px
    }

    /* Verify modal */
    .verify-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 20px
    }

    .verify-overlay.active {
      display: flex
    }

    .verify-modal {
      background: #12122a;
      border: 1px solid var(--accent);
      border-radius: 16px;
      max-width: 520px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 8px 40px rgba(232, 121, 249, 0.2)
    }

    .verify-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border)
    }

    .verify-modal-header h3 {
      font-size: 16px;
      color: #fff;
      margin: 0
    }

    .verify-close {
      background: none;
      border: none;
      color: var(--dim);
      font-size: 20px;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px
    }

    .verify-close:hover {
      color: #fff;
      background: rgba(255, 255, 255, 0.1)
    }

    .verify-body {
      padding: 20px
    }

    .verify-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
      font-size: 13px
    }

    .verify-row .vr-label {
      color: var(--dim)
    }

    .verify-row .vr-value {
      font-weight: 600;
      color: #fff
    }

    .verify-verdict {
      text-align: center;
      padding: 16px;
      border-radius: 10px;
      margin: 16px 0;
      font-size: 15px;
      font-weight: 700
    }

    .verdict-green {
      background: rgba(34, 197, 94, 0.12);
      color: #22c55e;
      border: 1px solid rgba(34, 197, 94, 0.3)
    }

    .verdict-yellow {
      background: rgba(245, 158, 11, 0.12);
      color: #f59e0b;
      border: 1px solid rgba(245, 158, 11, 0.3)
    }

    .verdict-red {
      background: rgba(239, 68, 68, 0.12);
      color: #ef4444;
      border: 1px solid rgba(239, 68, 68, 0.3)
    }

    .verify-manual {
      margin-top: 16px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border);
      border-radius: 8px
    }

    .verify-manual label {
      font-size: 12px;
      color: var(--dim);
      display: block;
      margin-bottom: 6px
    }

    .verify-manual input {
      width: 100%;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px 12px;
      color: #fff;
      font-size: 14px
    }

    .verify-manual input:focus {
      outline: none;
      border-color: var(--accent)
    }

    .verify-manual .vm-btn {
      display: inline-block;
      margin-top: 8px;
      padding: 6px 16px;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      font-weight: 600
    }

    .verify-manual .vm-btn:hover {
      opacity: 0.85
    }

    /* Live mode toggle */
    .live-mode-bar {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px
    }

    .live-toggle {
      position: relative;
      width: 44px;
      height: 24px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      border: 1px solid var(--border)
    }

    .live-toggle.active {
      background: rgba(34, 197, 94, 0.3);
      border-color: rgba(34, 197, 94, 0.5)
    }

    .live-toggle .lt-dot {
      position: absolute;
      top: 3px;
      left: 3px;
      width: 16px;
      height: 16px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.3s
    }

    .live-toggle.active .lt-dot {
      transform: translateX(20px)
    }

    .live-label {
      font-size: 12px;
      color: var(--dim)
    }

    .live-label.active {
      color: var(--green)
    }

    .live-pulse {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--green);
      margin-right: 4px;
      animation: pulse 1s infinite
    }

    @media(max-width:600px) {
      .header h1 {
        font-size: 20px
      }

      .stats-row {
        grid-template-columns: repeat(2, 1fr)
      }

      .factors {
        grid-template-columns: 1fr
      }

      .glossary-grid {
        grid-template-columns: 1fr
      }

      .tier-explain {
        flex-direction: column
      }

      .info-tip .tip-text {
        width: 200px;
        left: 0;
        transform: none
      }

      .verify-modal {
        margin: 10px
      }
    }
  </style>
</head>

<body>
  <!-- Disclaimer Banner -->
  <div style="background:rgba(239,68,68,0.1);border-bottom:1px solid rgba(239,68,68,0.3);padding:12px 20px;text-align:center;font-size:12px;color:#fca5a5;">
    <strong>&#9888; NOT FINANCIAL ADVICE</strong> ‚Äî For educational purposes only. 
    Crypto trading carries extreme risk. Never invest more than you can afford to lose. 
    Past performance does not guarantee future results.
  </div>

  <div class="header">
    <h1>Meme Coin Scanner</h1>
    <div class="sub">Short-term momentum plays on meme coins &mdash; DOGE, SHIB, PEPE, FLOKI &amp; emerging pumps</div>
  </div>
  <div class="nav">
    <a href="/findcryptopairs/winners.html">Crypto Scanner</a>
    <a href="/findcryptopairs/portfolio/">Crypto Portfolio</a>
    <a href="/live-monitor/live-monitor.html">Live Monitor</a>
    <a href="/investments/">Investment Hub</a>
    <a href="/updates/">Changelog</a>
    <a href="/">&larr; Home</a>
  </div>
  <div class="container">
    <!-- Honest performance status banner -->
    <div
      style="background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.3);border-radius:var(--radius);padding:12px 16px;margin-bottom:12px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;font-size:12px;">
      <span
        style="background:rgba(239,68,68,0.15);color:#ef4444;padding:3px 10px;border-radius:6px;font-weight:800;font-size:11px;border:1px solid rgba(239,68,68,0.3);letter-spacing:0.5px;">BEST
        MEME</span>
      <span style="color:#fca5a5;">Forward-facing results: <strong style="color:#ef4444;">5% WR</strong> (1 win / 19
        losses, 20 resolved). This scanner is currently underperforming. Data is honest and unfiltered.</span>
    </div>

    <!-- Statistical Validity Warning (ChatGPT + Kimi Audit) -->
    <div
      style="background:rgba(245,158,11,0.08);border:1px solid rgba(245,158,11,0.3);border-radius:var(--radius);padding:12px 16px;margin-bottom:12px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;font-size:12px;">
      <span
        style="background:rgba(245,158,11,0.15);color:#f59e0b;padding:3px 10px;border-radius:6px;font-weight:800;font-size:11px;border:1px solid rgba(245,158,11,0.3);letter-spacing:0.5px;">SAMPLE SIZE</span>
      <span style="color:#fcd34d;"><strong>20-29 resolved signals is statistically underpowered.</strong> Wilson 95% CI: ~0.9% to 23.6%. Need 350+ signals for reliable 40% estimate. 
        <a href="/findcryptopairs/meme-research-chatgpt.html" style="color:#f59e0b;text-decoration:underline;">ChatGPT audit</a> | 
        <a href="/findcryptopairs/meme-research-kimi.html" style="color:#f59e0b;text-decoration:underline;">Kimi audit</a></span>
    </div>

    <!-- Kimi AI Audit Banner -->
    <div
      style="background:rgba(255,107,53,0.08);border:1px solid rgba(255,107,53,0.3);border-radius:var(--radius);padding:12px 16px;margin-bottom:12px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;font-size:12px;">
      <span
        style="background:rgba(255,107,53,0.15);color:#ff6b35;padding:3px 10px;border-radius:6px;font-weight:800;font-size:11px;border:1px solid rgba(255,107,53,0.3);letter-spacing:0.5px;">NEW AUDIT</span>
      <span style="color:#ffaa85;"><strong>Kimi AI Analysis:</strong> Inverted confidence tiers (Strong Buy 0% vs Lean Buy 5%), 2015-era architecture, feature conflicts. 
        <a href="/findcryptopairs/meme-research-kimi.html" style="color:#ff6b35;text-decoration:underline;">Read full report &#8594;</a></span>
    </div>

    <!-- Grok Enhancement Guide Banner -->
    <div
      style="background:rgba(0,212,170,0.08);border:1px solid rgba(0,212,170,0.3);border-radius:var(--radius);padding:12px 16px;margin-bottom:12px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;font-size:12px;">
      <span
        style="background:rgba(0,212,170,0.15);color:#00d4aa;padding:3px 10px;border-radius:6px;font-weight:800;font-size:11px;border:1px solid rgba(0,212,170,0.3);letter-spacing:0.5px;">GUIDE</span>
      <span style="color:#6ee7b7;"><strong>Grok Quick Wins:</strong> Free data sources, web scraping with failovers, zero-cost ML. Practical implementation roadmap. 
        <a href="/findcryptopairs/meme-research-grok.html" style="color:#00d4aa;text-decoration:underline;">Read guide &#8594;</a></span>
    </div>

    <!-- Deep Research Link -->
    <div
      style="background:rgba(16,163,127,0.08);border:1px solid rgba(16,163,127,0.3);border-radius:var(--radius);padding:12px 16px;margin-bottom:12px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;font-size:12px;">
      <span
        style="background:rgba(16,163,127,0.15);color:#10a37f;padding:3px 10px;border-radius:6px;font-weight:800;font-size:11px;border:1px solid rgba(16,163,127,0.3);letter-spacing:0.5px;">NEW</span>
      <span style="color:#6ee7b7;"><strong>ChatGPT Deep Research Audit:</strong> Comprehensive analysis of framework flaws, conflicts, and improvement roadmap. 
        <a href="/findcryptopairs/meme-research-chatgpt.html" style="color:#10a37f;text-decoration:underline;">Read the full report &#8594;</a></span>
    </div>

    <!-- v2 Improvement Banner -->
    <div
      style="background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.3);border-radius:var(--radius);padding:12px 16px;margin-bottom:12px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;font-size:12px;">
      <span
        style="background:rgba(34,197,94,0.15);color:#22c55e;padding:3px 10px;border-radius:6px;font-weight:800;font-size:11px;border:1px solid rgba(34,197,94,0.3);letter-spacing:0.5px;">v2
        IMPROVED</span>
      <span style="color:#86efac;"><strong>Algorithm updated Feb 12, 2026:</strong> Added quality gates (EMA trend +
        momentum + volume), stricter thresholds (72/78/85), bear market penalty (-10pts). Goal: 5% &rarr; 40%+ win rate.
        <a href="#" onclick="switchMainTab('analysis');return false;"
          style="color:#22c55e;text-decoration:underline;">See details &rarr;</a></span>
    </div>

    <div class="warning-bar">
      <strong>&#9888; HIGH VOLATILITY:</strong>
      <span>Meme coins can drop 30-80% in hours. This scanner finds short-term momentum patterns &mdash; NOT safe
        long-term investments. Wider targets &amp; stops reflect extreme volatility. Never risk money you can't
        lose.</span>
    </div>

    <!-- QUICK FIX PLAN BANNER -->
    <div
      style="background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.3);border-radius:var(--radius);padding:12px 16px;margin-bottom:16px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;font-size:12px;">
      <span
        style="background:rgba(34,197,94,0.15);color:#22c55e;padding:3px 10px;border-radius:6px;font-weight:800;font-size:11px;border:1px solid rgba(34,197,94,0.3);letter-spacing:0.5px;">NEW</span>
      <span style="color:#86efac;"><strong>Take Profit & Stop Loss prices now shown!</strong> Exact exit prices are
        calculated from entry. Quick-fix improvements in progress. <a href="#quick-fixes"
          style="color:#22c55e;text-decoration:underline;">See the plan &rarr;</a></span>
    </div>

    <!-- Main page tabs -->
    <div class="main-tabs">
      <button class="main-tab-btn active" onclick="switchMainTab('scanner')">Scanner</button>
      <button class="main-tab-btn" onclick="switchMainTab('hot')" style="color:#ef4444;">üî• Hot Trending</button>
      <button class="main-tab-btn" onclick="switchMainTab('analysis')" style="color:#f59e0b;">System Analysis</button>
      <button class="main-tab-btn" onclick="switchMainTab('research')" style="color:#a855f7;">Research &amp;
        Future</button>
    </div>

    <!-- TAB 1: SCANNER (all existing content) -->
    <div class="main-panel active" id="main-scanner">

      <div class="stats-row" id="stats-row">
        <div class="stat-card">
          <div class="label">Win Rate</div>
          <div class="value" id="s-wr">--</div>
          <div class="sub">Resolved signals</div>
        </div>
        <div class="stat-card">
          <div class="label">Avg P&amp;L</div>
          <div class="value" id="s-pnl">--</div>
          <div class="sub">Per signal</div>
        </div>
        <div class="stat-card">
          <div class="label">Total Signals</div>
          <div class="value" id="s-total">--</div>
          <div class="sub" id="s-resolved">--</div>
        </div>
        <div class="stat-card">
          <div class="label">Best Trade</div>
          <div class="value green" id="s-best">--</div>
          <div class="sub" id="s-worst">--</div>
        </div>
        <div class="stat-card">
          <div class="label">Active Memes</div>
          <div class="value accent" id="s-pairs">--</div>
          <div class="sub" id="s-scans">--</div>
        </div>
        <div class="stat-card">
          <div class="label">Last Scan</div>
          <div class="value" id="s-last" style="font-size:14px">--</div>
          <div class="sub" id="s-first">--</div>
        </div>
      </div>

      <!-- Data Freshness Bar -->
      <div class="freshness-bar freshness-stale" id="freshness-bar">
        <span class="freshness-dot"></span>
        <span id="freshness-text">Checking data freshness...</span>
        <span id="freshness-time" style="margin-left:auto;font-size:11px;color:var(--dim)"></span>
      </div>

      <!-- BTC Market Regime Indicator -->
      <div id="btc-regime-bar"
        style="display:none;padding:8px 16px;margin-bottom:12px;border-radius:var(--radius);font-size:12px;border:1px solid var(--border);background:var(--card);display:flex;align-items:center;gap:10px;flex-wrap:wrap">
      </div>

      <!-- Live Mode + BUY NOW Controls -->
      <div class="live-mode-bar" style="flex-wrap:wrap">
        <div class="live-toggle active" id="kraken-only-toggle" onclick="toggleKrakenOnly()">
          <div class="lt-dot"></div>
        </div>
        <span class="live-label active" id="kraken-only-label" style="color:#9b7cdb">&#127464;&#127462; Kraken
          Only</span>
        <span style="margin:0 8px;color:rgba(255,255,255,0.1)">|</span>
        <div class="live-toggle active" id="hide-invalid-toggle" onclick="toggleHideInvalidated()">
          <div class="lt-dot"></div>
        </div>
        <span class="live-label active" id="hide-invalid-label">Hide Invalidated</span>
        <span style="margin:0 8px;color:rgba(255,255,255,0.1)">|</span>
        <div class="live-toggle" id="live-toggle" onclick="toggleLiveMode()">
          <div class="lt-dot"></div>
        </div>
        <span class="live-label" id="live-label">Live Prices</span>
        <span style="margin-left:auto;font-size:11px;color:var(--dim)" id="live-status"></span>
      </div>

      <!-- KRAKEN RANKINGS ‚Äî All meme coins rated 1-10, always visible -->
      <div id="kraken-rankings-section" style="margin-bottom:24px">
        <div class="section-title" style="color:#e879f9;margin-bottom:4px">
          &#127464;&#127462; Kraken Meme Rankings
          <span class="badge"
            style="background:rgba(232,121,249,0.15);color:#e879f9;border:1px solid rgba(232,121,249,0.3)">1-10
            SCALE</span>
          <span class="badge"
            style="background:rgba(6,182,212,0.15);color:#06b6d4;border:1px solid rgba(6,182,212,0.3)">REAL-TIME</span>
        </div>
        <div style="font-size:12px;color:var(--dim);margin-bottom:12px">
          Every meme coin on Kraken, ranked by buy strength right now. <strong style="color:#fff">8+ = buy</strong>, 5-7
          = watch, 1-4 = wait.
          <a href="#" onclick="toggleRankingModel();return false;"
            style="color:#c4b5fd;text-decoration:underline;margin-left:4px">How is this scored?</a>
        </div>

        <!-- Model Explanation (hidden by default) -->
        <div id="ranking-model-explain"
          style="display:none;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:12px">
          <div style="font-size:14px;font-weight:700;color:#fff;margin-bottom:10px">Meme Buy Rating Model v2.1 (1-10)</div>
          <div style="font-size:12px;color:#bbb;line-height:1.7;margin-bottom:12px">
            Each coin is scored 0-100 across 5 real-time factors, then mapped to a 1-10 rating. All data comes from
            <strong style="color:#fff">Kraken's live API</strong> and <strong style="color:#fff">CoinGecko</strong>. No
            fake data, no placeholders.
            <br><br>
            <strong style="color:#f59e0b">v2.1 Updates:</strong> Added "chasing penalty" (-8 pts) when momentum is high but entry position is poor.
            Added correlation warnings when 70%+ coins are green. Added CoinGecko dependency indicators.
          </div>
          <div style="background:rgba(245,158,11,0.08);border:1px solid rgba(245,158,11,0.2);border-radius:6px;padding:10px;margin-bottom:12px;font-size:11px;color:#fcd34d;">
            <strong>&#9888; ChatGPT Audit Findings:</strong><br>
            &#8226; <strong>Feature Conflict:</strong> Momentum ("+3-15% ideal") conflicts with Entry Position ("near 24h low is better"). In breakouts, best entries are often near highs, not lows.<br>
            &#8226; <strong>Missing Depth:</strong> Spread alone is misleading. An order book can look tight while being thin. Depth proxy needed for realistic slippage estimation.<br>
            &#8226; <strong>Social Too Coarse:</strong> Binary "CoinGecko trending" insufficient. Need mention velocity (X/Reddit 30-120 min lead time).
          </div>
          <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:8px;margin-bottom:12px"
            id="ranking-model-factors">
            <div
              style="background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.05)">
              <div style="font-size:11px;color:var(--accent);font-weight:700">MOMENTUM (35%)</div>
              <div style="font-size:11px;color:#aaa;margin-top:4px">24h price change. +3-15% is ideal. Over +25% = FOMO
                danger.</div>
            </div>
            <div
              style="background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.05)">
              <div style="font-size:11px;color:var(--cyan);font-weight:700">VOLUME (25%)</div>
              <div style="font-size:11px;color:#aaa;margin-top:4px">24h USD volume on Kraken. Higher = better liquidity.
                $500K+ ideal.</div>
            </div>
            <div
              style="background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.05)">
              <div style="font-size:11px;color:var(--gold);font-weight:700">SOCIAL BUZZ (15%)</div>
              <div style="font-size:11px;color:#aaa;margin-top:4px">Bonus if trending on CoinGecko. Social buzz drives
                meme pumps.</div>
            </div>
            <div
              style="background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.05)">
              <div style="font-size:11px;color:var(--green);font-weight:700">ENTRY POSITION (15%)</div>
              <div style="font-size:11px;color:#aaa;margin-top:4px">Where price sits in 24h range. Near the low = better
                entry point.</div>
            </div>
            <div
              style="background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.05)">
              <div style="font-size:11px;color:#c084fc;font-weight:700">SPREAD (10%)</div>
              <div style="font-size:11px;color:#aaa;margin-top:4px">Bid/ask spread tightness. Tighter = less slippage
                when trading.</div>
            </div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;font-size:12px">
            <span
              style="padding:4px 12px;border-radius:6px;background:rgba(34,197,94,0.12);color:#22c55e;border:1px solid rgba(34,197,94,0.2);font-weight:600">8-10:
              Strong Buy</span>
            <span
              style="padding:4px 12px;border-radius:6px;background:rgba(245,158,11,0.12);color:#f59e0b;border:1px solid rgba(245,158,11,0.2);font-weight:600">5-7:
              Warming Up</span>
            <span
              style="padding:4px 12px;border-radius:6px;background:rgba(107,114,128,0.12);color:#9ca3af;border:1px solid rgba(107,114,128,0.2);font-weight:600">1-4:
              Quiet / Wait</span>
          </div>
        </div>

        <!-- Market Mood Bar -->
        <div id="pulse-mood-bar"
          style="display:flex;align-items:center;gap:10px;padding:10px 16px;margin-bottom:12px;border-radius:var(--radius);font-size:12px;border:1px solid var(--border);background:var(--card)">
          <span style="color:var(--dim)">Loading market mood...</span>
        </div>

        <!-- Correlation Warning Banner (hidden by default, shown when >70% coins are green) -->
        <div id="correlation-warning" style="display:none;background:rgba(245,158,11,0.08);border:1px solid rgba(245,158,11,0.3);border-radius:var(--radius);padding:12px 16px;margin-bottom:12px;align-items:center;gap:10px;flex-wrap:wrap;font-size:12px;">
          <span style="background:rgba(245,158,11,0.15);color:#f59e0b;padding:3px 10px;border-radius:6px;font-weight:800;font-size:11px;border:1px solid rgba(245,158,11,0.3);letter-spacing:0.5px;">‚ö†Ô∏è CORRELATION RISK</span>
          <span style="color:#fcd34d;"><strong>70%+ of meme coins are green right now.</strong> This indicates a correlated market pump. When everything rises together, it often falls together. Consider waiting for a pullback rather than chasing.</span>
        </div>

        <!-- Entry Quality Warning Banner (for top coins with poor entry position) -->
        <div id="entry-quality-warning" style="display:none;background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.3);border-radius:var(--radius);padding:12px 16px;margin-bottom:12px;align-items:center;gap:10px;flex-wrap:wrap;font-size:12px;">
          <span style="background:rgba(239,68,68,0.15);color:#ef4444;padding:3px 10px;border-radius:6px;font-weight:800;font-size:11px;border:1px solid rgba(239,68,68,0.3);letter-spacing:0.5px;">‚ö†Ô∏è NEAR DAILY HIGHS</span>
          <span style="color:#fca5a5;"><strong>Top-rated coins are trading near their 24h highs.</strong> The Entry Position score is only 3/15 for most top picks. You'd be buying at the top of the daily range ‚Äî consider waiting for a dip.</span>
        </div>

        <!-- Controls -->
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;align-items:center">
          <button onclick="loadKrakenRankings(true)"
            style="background:rgba(232,121,249,0.15);color:#e879f9;border:1px solid rgba(232,121,249,0.3);padding:8px 16px;border-radius:6px;font-size:12px;cursor:pointer;font-weight:600;transition:all 0.15s"
            onmouseover="this.style.background='rgba(232,121,249,0.25)'"
            onmouseout="this.style.background='rgba(232,121,249,0.15)'">
            Refresh Rankings
          </button>
          <button onclick="toggleRankingLiveMode()" id="ranking-live-toggle"
            style="background:rgba(255,255,255,0.05);color:var(--dim);border:1px solid var(--border);padding:8px 16px;border-radius:6px;font-size:12px;cursor:pointer;transition:all 0.15s">
            Auto-Refresh (45s)
          </button>
          <span style="font-size:11px;color:var(--dim)" id="ranking-last-updated"></span>
          <span style="margin-left:auto;font-size:11px;color:var(--dim)" id="ranking-coin-count"></span>
        </div>
        
        <!-- Scan Stats -->
        <div id="scan-stats-bar" style="display:none;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);border-radius:6px;padding:8px 12px;margin-bottom:12px;font-size:11px;color:var(--dim);">
          <span><strong style="color:#fff">Scan Coverage:</strong> <span id="scan-success-count">--</span>/<span id="scan-total-count">--</span> coins</span>
          <span style="color:var(--green)" id="scan-coverage-pct">--%</span>
          <span style="margin-left:auto;font-size:10px;opacity:0.7">Data from Kraken + CoinGecko</span>
        </div>

        <!-- Full Rankings Table -->
        <div id="kraken-rankings-list">
          <div class="loading">Scanning all Kraken meme coins...</div>
        </div>

        <!-- #1 TOP PICK CARD (below the table) -->
        <div id="pulse-top-pick"
          style="background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin:12px 0">
          <div class="loading">Determining top pick...</div>
        </div>

        <!-- CoinGecko Trending -->
        <div style="margin-bottom:12px">
          <div
            style="font-size:13px;font-weight:700;color:var(--text);margin-bottom:8px;display:flex;align-items:center;gap:8px">
            Trending on CoinGecko
            <i class="info-tip">i<span class="tip-text">Coins trending on CoinGecko right now. Trending = social buzz.
                Coins marked with a flag are available on Kraken for Canadian traders.</span></i>
          </div>
          <div id="pulse-trending" style="display:flex;gap:8px;flex-wrap:wrap">
            <span style="color:var(--dim);font-size:12px">Loading...</span>
          </div>
        </div>

        <div
          style="padding:10px 12px;background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.2);border-radius:8px;font-size:11px;color:#fca5a5">
          <strong>WARNING:</strong> Meme coins can lose 50%+ in minutes. Never risk more than 1-2% of your portfolio.
          Prices are from Kraken's public API. Always verify before buying.
        </div>
      </div>

      <div class="section-title">Current Meme Winners <span class="badge badge-strong"
          id="winner-count">loading...</span>
        <span style="font-size:11px;color:var(--dim);font-weight:400;margin-left:8px" id="sort-label">(sorted by BUY NOW
          rank)</span>
      </div>
      <div id="auto-verify-summary"></div>
      <div id="winners-list">
        <div class="loading">Loading winners...</div>
      </div>

      <!-- Price Verification Modal -->
      <div class="verify-overlay" id="verify-overlay" onclick="if(event.target===this)closeVerifyModal()">
        <div class="verify-modal">
          <div class="verify-modal-header">
            <h3 id="verify-title">Verify Signal</h3>
            <button class="verify-close" onclick="closeVerifyModal()">&times;</button>
          </div>
          <div class="verify-body" id="verify-body">
            <div class="loading">Fetching live price...</div>
          </div>
        </div>
      </div>

      <!-- Audit Trail Modal -->
      <div class="verify-overlay" id="audit-overlay" onclick="if(event.target===this)closeAuditModal()">
        <div class="verify-modal" style="max-width:700px;max-height:85vh;">
          <div class="verify-modal-header">
            <h3 id="audit-title">üîç Audit Trail</h3>
            <button class="verify-close" onclick="closeAuditModal()">&times;</button>
          </div>
          <div class="verify-body" id="audit-body" style="max-height:70vh;overflow-y:auto;">
            <div class="loading">Loading audit data...</div>
          </div>
          <div style="padding:16px 20px;border-top:1px solid var(--border);display:flex;gap:10px;flex-wrap:wrap;">
            <button onclick="copyAuditToClipboard()" style="flex:1;min-width:140px;background:rgba(34,197,94,0.15);color:#22c55e;border:1px solid rgba(34,197,94,0.3);padding:10px 16px;border-radius:6px;font-size:13px;cursor:pointer;font-weight:600;">
              üìã Copy for AI Analysis
            </button>
            <button onclick="copyAuditRaw()" style="flex:1;min-width:140px;background:rgba(99,102,241,0.15);color:#818cf8;border:1px solid rgba(99,102,241,0.3);padding:10px 16px;border-radius:6px;font-size:13px;cursor:pointer;font-weight:600;">
              üìÑ Copy Raw Data
            </button>
            <button onclick="window.open('https://chat.openai.com','_blank')" style="flex:1;min-width:140px;background:rgba(16,163,127,0.15);color:#10a37f;border:1px solid rgba(16,163,127,0.3);padding:10px 16px;border-radius:6px;font-size:13px;cursor:pointer;font-weight:600;">
              ü§ñ Open ChatGPT
            </button>
          </div>
        </div>
      </div>

      <div class="section-title" style="margin-top:32px">Win Rate by Confidence Tier</div>
      <div id="tier-table"></div>

      <div class="section-title" style="margin-top:32px">Tier 1 vs Tier 2 Comparison <i class="info-tip">i<span
            class="tip-text">Tier 1 = established memes (DOGE, SHIB, etc). Tier 2 = newly discovered pumping coins with
            meme keywords or extreme volume.</span></i></div>
      <div id="tier-comparison"></div>

      <div class="section-title" style="margin-top:32px">Recent Signal History</div>
      <div id="history-list">
        <div class="loading">Loading history...</div>
      </div>

      <div class="section-title" style="margin-top:32px">Full Scan Log &mdash; All Analyzed Meme Coins <i
          class="info-tip">i<span class="tip-text">Every meme coin that was deeply analyzed in a scan, including those
            that didn't make the 70-point threshold. Shows all 7 meme-specific indicator scores.</span></i></div>
      <div class="scan-log-controls">
        <select class="scan-select" id="scan-picker" onchange="loadScanLog(this.value)">
          <option value="">Loading scans...</option>
        </select>
        <span class="scan-meta" id="scan-meta"></span>
      </div>
      <div id="scan-log-list">
        <div class="loading">Loading scan log...</div>
      </div>

      <!-- DAILY PICKS -->
      <div class="section-title" style="margin-top:32px">Daily Picks <i class="info-tip">i<span class="tip-text">All
            algorithmic picks for a specific date, with timestamps and outcomes. Use the date picker to browse
            historical picks.</span></i></div>
      <div class="picks-controls">
        <select class="scan-select" id="picks-date" onchange="loadDailyPicks(this.value)">
          <option value="">Loading dates...</option>
        </select>
        <span class="picks-date-label" id="picks-date-label"></span>
      </div>
      <div class="picks-summary" id="picks-summary"></div>
      <div id="daily-picks-list">
        <div class="loading">Loading daily picks...</div>
      </div>

      <!-- PERFORMANCE TRACKER -->
      <div class="section-title" style="margin-top:32px">Performance Tracker <i class="info-tip">i<span
            class="tip-text">Track the scanner's performance over time. Shows daily P&amp;L, win rates, equity curve,
            streaks, and top-performing coins.</span></i></div>
      <div class="tab-row" id="perf-tabs">
        <button class="tab-btn active" onclick="loadPerf('all',this)">All Time</button>
        <button class="tab-btn" onclick="loadPerf('30d',this)">30 Days</button>
        <button class="tab-btn" onclick="loadPerf('7d',this)">7 Days</button>
        <button class="tab-btn" onclick="loadPerf('today',this)">Today</button>
      </div>
      <div class="perf-grid" id="perf-summary"></div>
      <div class="section-title" style="font-size:14px;margin-top:16px">Daily Breakdown</div>
      <div id="perf-daily">
        <div class="loading">Loading performance data...</div>
      </div>
      <div class="section-title" style="font-size:14px;margin-top:16px">Top Performing Coins</div>
      <div id="perf-top-coins">
        <div class="loading">Loading...</div>
      </div>

      <!-- CONFIDENCE TIERS -->
      <div class="edu-section">
        <div class="edu-header" onclick="toggleEdu(this)">
          <h3>Understanding Meme Confidence Tiers <span class="badge"
              style="background:rgba(34,197,94,0.15);color:#22c55e;border:1px solid rgba(34,197,94,0.3);font-size:9px;padding:2px 6px;">IMPROVED
              v2</span></h3>
          <span class="edu-arrow">&#9660;</span>
        </div>
        <div class="edu-body">
          <p style="font-size:13px;color:#bbb;margin-bottom:12px">Each meme coin is scored 0-100 across 7 meme-specific
            indicators. <strong style="color:#22c55e;">New in v2:</strong> Quality gates now require price above EMA,
            positive momentum on both timeframes, AND increasing volume. Stricter thresholds = fewer false signals.</p>

          <!-- Quality Gates Summary -->
          <div
            style="background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:8px;padding:12px;margin-bottom:12px;">
            <div style="font-size:12px;font-weight:600;color:#fff;margin-bottom:8px;">Quality Gates (Must pass 2 of 3)
              <span style="color:var(--gold);font-size:10px;font-weight:400"> &#8212; ChatGPT Audit: Should be 3/3 for 40% target</span>
            </div>
            <div
              style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:8px;font-size:11px;color:var(--dim);">
              <div>&#10004; <strong style="color:var(--green);">Trend Confirm:</strong> Price above 1h EMA</div>
              <div>&#10004; <strong style="color:var(--green);">Momentum Gate:</strong> Both 15m & 5m positive</div>
              <div>&#10004; <strong style="color:var(--green);">Volume Gate:</strong> Volume increasing 20%+</div>
            </div>
            <div style="font-size:10px;color:var(--gold);margin-top:8px;padding-top:8px;border-top:1px solid rgba(255,255,255,0.05);">
              <strong>Audit Finding:</strong> 2/3 gates insufficient for 40% win rate target. Need all 3 + social + on-chain gating.
            </div>
          </div>

          <div class="tier-explain">
            <div class="tier-card strong">
              <div class="t-label">Strong Buy</div>
              <div class="t-range">Score 85-100 + Quality 2/3</div>
              <div class="t-desc">6-7 indicators firing + quality gates passed. <strong
                  style="color:var(--accent)">Target: +4-12%</strong> (reduced). Risk: -2-4% (tighter). Maximum
                conviction with trend confirmation.</div>
            </div>
            <div class="tier-card buy">
              <div class="t-label">Buy</div>
              <div class="t-range">Score 78-84 + Quality 2/3</div>
              <div class="t-desc">5-6 indicators bullish + quality gates passed. <strong style="color:#c084fc">Target:
                  +3-8%</strong> (reduced). Risk: -2-3.5% (tighter). Raised threshold from 75 for better accuracy.</div>
            </div>
            <div class="tier-card lean">
              <div class="t-label">Lean Buy</div>
              <div class="t-range">Score 72-77 + Quality 2/3</div>
              <div class="t-desc">4-5 indicators bullish + quality gates passed. <strong
                  style="color:var(--gold)">Target: +2-5%</strong> (reduced). Risk: -1.5-2.5% (tighter). Raised
                threshold from 70.</div>
            </div>
          </div>
          <p style="font-size:12px;color:var(--dim);margin-top:8px"><strong>Tier 2 Emerging:</strong> Now requires 80+
            score minimum (extra scrutiny). Bear market: -10pt penalty to all scores. <strong>Goal:</strong> Improve 5%
            win rate to 40%+ by filtering weak signals.</p>
        </div>
      </div>

      <!-- GLOSSARY OF MEME INDICATORS -->
      <div class="edu-section">
        <div class="edu-header" onclick="toggleEdu(this)">
          <h3>Meme Coin Indicators Explained <i class="info-tip">i<span class="tip-text">These 7 factors are
                specifically tuned for meme coin behavior &mdash; different from the general crypto scanner.</span></i>
          </h3>
          <span class="edu-arrow">&#9660;</span>
        </div>
        <div class="edu-body">
          <div class="glossary-grid">
            <div class="glossary-card">
              <div class="g-term">Explosive Volume <span class="g-pts">0-25 pts</span></div>
              <div class="g-desc"><strong>What it measures:</strong> How much the current trading volume exceeds the
                average. Volume is king for memes &mdash; pumps live and die by volume surges.<br><strong>How it
                  scores:</strong> 3x average=+12, 5x=+18, 10x+=25 (maximum). Below 1.5x gets 0.</div>
              <div class="g-why">Why it matters: Meme pumps are volume-driven events. When volume explodes 5-10x above
                normal, it signals a wave of retail buying that can push prices sharply higher in minutes.</div>
            </div>
            <div class="glossary-card">
              <div class="g-term">Parabolic Momentum <span class="g-pts">0-20 pts</span></div>
              <div class="g-desc"><strong>What it measures:</strong> Steep price acceleration on both 15-minute and
                5-minute charts. Memes don't go up slowly &mdash; they go parabolic or they die.<br><strong>How it
                  scores:</strong> +8 if both timeframes are positive. +6 more for 3%+ on 15m. +6 more for 2%+ on 5m.
                Capped at 20.</div>
              <div class="g-why">Why it matters: Meme coins accelerate rapidly. If a meme is moving up fast on both
                short and ultra-short timeframes, the pump has real momentum behind it.</div>
            </div>
            <div class="glossary-card">
              <div class="g-term">RSI Hype Zone <span class="g-pts">0-15 pts</span></div>
              <div class="g-desc"><strong>What it measures:</strong> RSI between 55-80 is the meme "hype zone." Unlike
                traditional assets, memes routinely sustain RSI above 70 during pumps. Only RSI 90+ is a clear
                top.<br><strong>How it scores:</strong> 15 pts for 55-80 (hype zone), 8 for 45-55, 5 for 80-90 (very
                hot), 3 for 35-45.</div>
              <div class="g-why">Why it matters: Traditional analysis says "RSI 70+ is overbought, sell." Memes break
                this rule &mdash; they can stay "overbought" for hours during pumps. We adjusted the sweet spot upward.
              </div>
            </div>
            <div class="glossary-card">
              <div class="g-term">Social Momentum Proxy <span class="g-pts">0-15 pts</span></div>
              <div class="g-desc"><strong>What it measures:</strong> A proxy for social media buzz, calculated as
                price_change_1h multiplied by volume_surge_ratio. When both are high, it signals viral
                attention.<br><strong>How it scores:</strong> Velocity 20+=15pts, 10+=12pts, 5+=8pts, 2+=5pts. Below 1
                gets 0.</div>
              <div class="g-why">Why it matters: Meme coins are social-media driven. We can't read Twitter, but we CAN
                detect its effect: rapid price + volume surges = something went viral.</div>
            </div>
            <div class="glossary-card">
              <div class="g-term">Volume Concentration <span class="g-pts">0-10 pts</span></div>
              <div class="g-desc"><strong>What it measures:</strong> What percentage of the last 3 hours of volume
                happened in the last 45 minutes? A "burst" pattern means the pump is just starting.<br><strong>How it
                  scores:</strong> 60%+ in last 3 candles=10pts, 45%+=7pts, 35%+=4pts, 28%+=2pts.</div>
              <div class="g-why">Why it matters: Even distribution of volume = steady market. Concentrated burst in
                recent candles = pump is accelerating NOW, not winding down.</div>
            </div>
            <div class="glossary-card">
              <div class="g-term">Breakout vs 4h High <span class="g-pts">0-10 pts</span></div>
              <div class="g-desc"><strong>What it measures:</strong> Is the current price breaking above its 4-hour
                high? Breakouts above recent resistance often trigger additional buying momentum.<br><strong>How it
                  scores:</strong> 2%+ above 4h high=10pts, 0.5%+=7pts, at the high=4pts, within 1%=2pts.</div>
              <div class="g-why">Why it matters: Breaking above a recent high is a classic technical trigger. For memes,
                it often causes FOMO buying that accelerates the move further.</div>
            </div>
            <div class="glossary-card">
              <div class="g-term">Low Market Cap Bonus <span class="g-pts">0-5 pts</span></div>
              <div class="g-desc"><strong>What it measures:</strong> Smaller coins (by 24h volume) have more explosive
                potential. A $500K volume coin can 3x easier than a $500M one.<br><strong>How it scores:</strong> Under
                $1M vol=5pts, under $5M=3pts, under $20M=1pt. Larger coins get 0.</div>
              <div class="g-why">Why it matters: Small caps move bigger on less capital. This is also the riskiest
                factor &mdash; small caps are more likely to rug pull or dump catastrophically.</div>
            </div>
          </div>
        </div>
      </div>

      <!-- TIER 1 VS TIER 2 EXPLAINED -->
      <div class="edu-section">
        <div class="edu-header" onclick="toggleEdu(this)">
          <h3>Tier 1 vs Tier 2 Memes <i class="info-tip">i<span class="tip-text">Why we separate established memes from
                newly discovered ones.</span></i></h3>
          <span class="edu-arrow">&#9660;</span>
        </div>
        <div class="edu-body">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px">
            <div
              style="background:rgba(96,165,250,0.06);border:1px solid rgba(96,165,250,0.15);border-radius:8px;padding:14px">
              <div style="font-size:13px;font-weight:700;color:#93c5fd;margin-bottom:8px">Tier 1 &mdash; Established
                Memes</div>
              <ul style="font-size:12px;color:#ccc;line-height:1.8;padding-left:16px">
                <li><strong>DOGE, SHIB, PEPE, FLOKI, BONK, WIF, MEME</strong></li>
                <li>Always scanned regardless of 24h change</li>
                <li>Higher liquidity = easier entry/exit</li>
                <li>Less likely to rug pull (but still volatile!)</li>
                <li>Lower threshold for inclusion ($50K+ daily volume)</li>
              </ul>
            </div>
            <div
              style="background:rgba(52,211,153,0.06);border:1px solid rgba(52,211,153,0.15);border-radius:8px;padding:14px">
              <div style="font-size:13px;font-weight:700;color:#6ee7b7;margin-bottom:8px">Tier 2 &mdash; Emerging /
                Discovered</div>
              <ul style="font-size:12px;color:#ccc;line-height:1.8;padding-left:16px">
                <li>Dynamically discovered from 600+ USDT pairs</li>
                <li>Must have meme keyword OR extreme pump (+15%)</li>
                <li>Requires $100K+ daily volume for analysis</li>
                <li>Higher risk: unknown coins, possible rug pulls</li>
                <li>Higher reward potential: early entry on new pumps</li>
              </ul>
            </div>
          </div>
          <p style="font-size:12px;color:var(--dim);line-height:1.6"><strong>Key difference:</strong> Tier 1 memes are
            watched 24/7. Tier 2 memes are discovered in real-time when their price action matches meme pump patterns.
            Tier 2 signals are inherently riskier but can offer earlier entry.</p>
        </div>
      </div>

      <!-- KNOWN RISKS -->
      <div class="edu-section">
        <div class="edu-header" onclick="toggleEdu(this)">
          <h3>Known Risks &amp; Limitations <i class="info-tip">i<span class="tip-text">Meme coins carry unique risks
                beyond normal crypto. Read this before acting on any signal.</span></i></h3>
          <span class="edu-arrow">&#9660;</span>
        </div>
        <div class="edu-body">
          <div style="font-size:13px;font-weight:700;color:var(--red);margin:0 0 8px">Meme-Specific Dangers</div>
          <div class="flaw-item"><span class="flaw-icon">&#9888;</span><span><strong>Rug pulls.</strong> Developers can
              drain liquidity pools instantly, making your tokens worthless. More common in Tier 2 (unknown coins).
              There is NO technical indicator that can predict a rug pull.</span></div>
          <div class="flaw-item"><span class="flaw-icon">&#9888;</span><span><strong>Whale dumps.</strong> A single
              holder can own 20-40% of a meme coin. When they sell, the price crashes faster than any stop-loss can
              execute. Slippage on large dumps can be 50%+.</span></div>
          <div class="flaw-item"><span class="flaw-icon">&#9888;</span><span><strong>Pump &amp; dump schemes.</strong>
              Organized groups inflate prices via social media, then dump on retail buyers. This scanner might detect
              the pump but CANNOT distinguish organic hype from manipulation.</span></div>
          <div class="flaw-item"><span class="flaw-icon">&#9888;</span><span><strong>Exchange delistings.</strong> Meme
              coins can be delisted from exchanges without warning, making them untradeable. Any open position becomes
              worthless instantly.</span></div>
          <div class="flaw-item"><span class="flaw-icon">&#9888;</span><span><strong>No fundamentals.</strong> Meme
              coins have no revenue, no product, no earnings. Their value is 100% speculative and sentiment-driven.
              Sentiment can flip from euphoria to panic in minutes.</span></div>
          <div class="flaw-item"><span class="flaw-icon">&#9888;</span><span><strong>2-hour window is still
                slow.</strong> Meme pumps can start AND end in 15 minutes. Our 2-hour resolve window captures multi-hour
              moves but may miss rapid pump-and-dumps.</span></div>

          <div style="font-size:13px;font-weight:700;color:var(--gold);margin:20px 0 8px">Scanner Limitations</div>
          <div class="flaw-item"><span class="flaw-icon" style="color:var(--gold)">&#9675;</span><span><strong>No social
                media data.</strong> We use a proxy (price velocity x volume) but can't read Twitter, Telegram, or
              Discord. The actual viral trigger is invisible to us.</span></div>
          <div class="flaw-item"><span class="flaw-icon" style="color:var(--gold)">&#9675;</span><span><strong>Single
                exchange per model.</strong> Kraken rankings use Kraken data, while the scanner uses Crypto.com data.
              Prices can differ from Binance, Uniswap, or DEXs where meme coins often launch first.</span></div>
          <div class="flaw-item"><span class="flaw-icon" style="color:var(--gold)">&#9675;</span><span><strong>No
                on-chain analysis.</strong> We don't check tokenomics, holder distribution, locked liquidity, or smart
              contract audits. Always DYOR (Do Your Own Research).</span></div>
        </div>
      </div>

      <!-- PLAIN LANGUAGE WARNING -->
      <div
        style="background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);border-radius:10px;padding:16px;margin-top:24px;line-height:1.7">
        <div style="font-size:16px;font-weight:700;color:#ef4444;margin-bottom:8px">This Is NOT Financial Advice</div>
        <div style="font-size:13px;color:#ccc">
          <strong>What this page does:</strong> This page includes two live systems: <strong>Kraken Rankings</strong>
          (Kraken + CoinGecko, 1-10 buy rating) and the <strong>Crypto.com Meme Scanner</strong> (scans 600+ USDT pairs
          every 10 minutes). The scanner scores coins using 7 meme-specific indicators: explosive volume, parabolic
          momentum, RSI hype zone, social momentum proxy, volume concentration, breakout confirmation, and market cap
          bonus.<br><br>
          <strong>What makes this different from our general scanner:</strong> Wider targets (up to 15% vs 6%), shorter
          resolve window (2h vs 4h), RSI sweet spot shifted up (55-80 vs 50-70), and meme-specific factors like social
          velocity proxy. Meme coins behave differently from BTC/ETH &mdash; this scanner accounts for that.<br><br>
          <strong style="color:#ef4444">The hard truth:</strong> Even the best meme coin scanner in the world is
          essentially gambling with better odds. Meme coins have no intrinsic value &mdash; they go up because people
          BELIEVE they'll go up, and they crash when belief evaporates. Use this tool to identify momentum patterns, not
          as investment advice. <strong>Only use money you are 100% willing to lose completely.</strong>
        </div>
      </div>

      <div class="disclaimer" style="margin-top:12px">
        <strong>Data source:</strong> Kraken public API + CoinGecko (rankings) and Crypto.com Exchange public API
        (scanner). Scanner runs every 10 minutes via GitHub Actions. Signals resolved after 2 hours with continuous
        candle walk.<br>
        <strong>Resolve method:</strong> Continuous &mdash; every 5-minute candle during the 2h window is checked. If
        target or stop was hit at ANY point, it's recorded accurately.<br>
        <strong>Not financial advice.</strong> For educational and entertainment purposes only. Past performance does
        not guarantee future results. Meme coins carry extreme risk of total loss.
      </div>

    </div><!-- end main-scanner panel -->

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- TAB 2: HOT TRENDING (NEW) -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="main-panel" id="main-hot">
      <div class="section-title" style="color:#ef4444;">üî• Hot Trending Right Now
        <span class="badge" style="background:rgba(239,68,68,0.15);color:#ef4444;border:1px solid rgba(239,68,68,0.3);">LIVE</span>
        <span class="badge" style="background:rgba(245,158,11,0.15);color:#f59e0b;border:1px solid rgba(245,158,11,0.3);">BETA</span>
      </div>
      
      <div style="background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);border-radius:var(--radius);padding:12px 16px;margin-bottom:16px;font-size:12px;color:#fca5a5;line-height:1.6;">
        <strong>üî• Hot Trending:</strong> Coins trending on CoinMarketCap/CoinGecko in the last 30 minutes to 4 hours. 
        Cross-checked against Kraken for immediate tradability. <strong>Confidence %</strong> = probability of continued upward movement based on technical analysis (momentum, volume, RSI, EMA alignment).
      </div>

      <!-- Timeframe selector -->
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;align-items:center">
        <span style="font-size:12px;color:var(--dim);">Trending window:</span>
        <button onclick="loadHotTrending('30m')" class="hot-tf-btn active" id="tf-30m" style="background:rgba(239,68,68,0.15);color:#ef4444;border:1px solid rgba(239,68,68,0.3);padding:6px 14px;border-radius:20px;font-size:12px;cursor:pointer;font-weight:600;">30 min</button>
        <button onclick="loadHotTrending('1h')" class="hot-tf-btn" id="tf-1h" style="background:rgba(255,255,255,0.05);color:var(--dim);border:1px solid var(--border);padding:6px 14px;border-radius:20px;font-size:12px;cursor:pointer;">1 hour</button>
        <button onclick="loadHotTrending('4h')" class="hot-tf-btn" id="tf-4h" style="background:rgba(255,255,255,0.05);color:var(--dim);border:1px solid var(--border);padding:6px 14px;border-radius:20px;font-size:12px;cursor:pointer;">4 hours</button>
        <button onclick="loadHotTrending('24h')" class="hot-tf-btn" id="tf-24h" style="background:rgba(255,255,255,0.05);color:var(--dim);border:1px solid var(--border);padding:6px 14px;border-radius:20px;font-size:12px;cursor:pointer;">24 hours</button>
        <button onclick="loadHotTrending(true)" style="background:rgba(239,68,68,0.15);color:#ef4444;border:1px solid rgba(239,68,68,0.3);padding:6px 14px;border-radius:6px;font-size:12px;cursor:pointer;font-weight:600;margin-left:auto;">üîÑ Refresh</button>
      </div>

      <!-- Scan status -->
      <div id="hot-scan-status" style="text-align:center;padding:20px;color:var(--dim);">
        <div style="font-size:24px;margin-bottom:8px;">üî•</div>
        <div>Scanning hot trending coins...</div>
      </div>

      <!-- Hot on Kraken Section -->
      <div id="hot-kraken-section" style="display:none;">
        <div class="section-title" style="font-size:16px;color:#22c55e;">
          ‚úÖ Tradable on Kraken ‚Äî High Confidence
          <span style="font-size:11px;color:var(--dim);font-weight:400;">(Confidence ‚â• 60%)</span>
        </div>
        <div id="hot-kraken-list"></div>
      </div>

      <!-- Watch List Section -->
      <div id="hot-watch-section" style="display:none;margin-top:24px;">
        <div class="section-title" style="font-size:16px;color:#f59e0b;">
          üëÄ Watch List
          <span style="font-size:11px;color:var(--dim);font-weight:400;">(Confidence 40-59%)</span>
        </div>
        <div id="hot-watch-list"></div>
      </div>

      <!-- Other Trending Section -->
      <div id="hot-other-section" style="display:none;margin-top:24px;">
        <div class="section-title" style="font-size:16px;color:var(--dim);">
          üìä Other Trending
          <span style="font-size:11px;color:var(--dim);font-weight:400;">(Not on Kraken or lower confidence)</span>
        </div>
        <div id="hot-other-list"></div>
      </div>

      <!-- Empty state -->
      <div id="hot-empty-state" style="display:none;text-align:center;padding:40px 20px;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);">
        <div style="font-size:40px;margin-bottom:12px;">üîç</div>
        <div style="font-size:16px;color:#fff;margin-bottom:8px;">No Hot Coins Right Now</div>
        <div style="font-size:13px;color:var(--dim);">No trending coins meet the high confidence threshold. Check back in 15-30 minutes.</div>
      </div>

      <!-- Methodology -->
      <div style="margin-top:32px;padding:16px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);border-radius:var(--radius);">
        <div style="font-size:13px;font-weight:600;color:#fff;margin-bottom:12px;">üìà How Confidence is Calculated</div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:12px;font-size:11px;color:var(--dim);line-height:1.6;">
          <div><strong style="color:#22c55e;">Trend Alignment (35 pts):</strong> Price above EMA-12 and EMA-26, bullish EMA crossover</div>
          <div><strong style="color:#22c55e;">Momentum (25 pts):</strong> 5m > 15m > 1h price change (acceleration pattern)</div>
          <div><strong style="color:#22c55e;">Volume (15 pts):</strong> Current volume > 2x 20-period average</div>
          <div><strong style="color:#22c55e;">RSI Sweet Spot (15 pts):</strong> RSI between 50-75 (momentum but not overbought)</div>
          <div><strong style="color:#22c55e;">Not Overbought (10 pts):</strong> RSI < 80, no parabolic blow-off</div>
        </div>
        <div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.05);font-size:11px;color:#fca5a5;">
          <strong>‚ö†Ô∏è Disclaimer:</strong> Confidence % estimates probability of continued upward movement based on technical factors. 
          It does NOT guarantee future performance. Meme coins can reverse violently at any time. Never risk more than 1-2% of portfolio.
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- TAB 3: SYSTEM ANALYSIS -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="main-panel" id="main-analysis">
      <div class="section-title" style="color:#f59e0b;">System Analysis <span class="badge"
          style="background:rgba(245,158,11,0.15);color:#f59e0b;border:1px solid rgba(245,158,11,0.3);">DIAGNOSIS</span>
        <a href="/findcryptopairs/meme-research-chatgpt.html" style="margin-left:auto;font-size:12px;color:#10a37f;text-decoration:underline;">View ChatGPT Audit &#8594;</a>
      </div>

      <!-- Statistical Validity Warning -->
      <div style="background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.3);border-radius:var(--radius);padding:16px;margin-bottom:16px;">
        <h4 style="font-size:14px;color:var(--red);margin-bottom:8px;">&#9888;&#65039; Critical: Statistical Invalidity</h4>
        <div style="font-size:12px;color:#fca5a5;line-height:1.7;">
          With only <strong>20 resolved signals</strong>, our 5% win rate measurement has <strong>massive uncertainty</strong>. The Wilson 95% confidence interval is ~0.9% to 23.6%. We cannot distinguish between "broken" and "weak but fixable" with this sample size.<br><br>
          To validate a 40% win rate with &#177;5 percentage point precision, we need <strong>350-400 resolved signals</strong>. Current data is an early pilot, not production evidence.
          <a href="/findcryptopairs/meme-research-chatgpt.html" style="color:#fca5a5;text-decoration:underline;">Read full analysis &#8594;</a>
        </div>
      </div>

      <!-- Feature Conflicts -->
      <div style="background:rgba(245,158,11,0.08);border:1px solid rgba(245,158,11,0.3);border-radius:var(--radius);padding:16px;margin-bottom:16px;">
        <h4 style="font-size:14px;color:var(--gold);margin-bottom:8px;">&#9888; Feature Conflicts Identified</h4>
        <div style="font-size:12px;color:#fcd34d;line-height:1.7;">
          <strong>Momentum vs Entry Position Conflict:</strong> The framework has conflicting heuristics. Momentum says "positive 24h change is good" (target +3-15%), but Entry Position says "near the 24h low is better." In strong breakouts, the best momentum entries occur near the high, not the low. The system risks selecting trades that are neither good momentum entries nor good reversals.
        </div>
      </div>

      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px;margin-bottom:20px;">
        <div style="background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;">
          <h4 style="font-size:14px;color:var(--gold);margin-bottom:8px;">What This System Does <span
              style="font-size:9px;padding:2px 6px;background:rgba(34,197,94,0.15);color:#22c55e;border:1px solid rgba(34,197,94,0.3);border-radius:4px;">v2</span>
          </h4>
          <div style="font-size:12px;color:var(--dim);line-height:1.7;">
            &bull; Scans 600+ Crypto.com Exchange USDT pairs every 10 minutes<br>
            &bull; Scores each meme coin 0&ndash;100 using 7 meme-specific indicators<br>
            &bull; <strong style="color:#22c55e;">NEW:</strong> Quality gates (trend confirm + momentum + volume)<br>
            &bull; <strong style="color:#22c55e;">NEW:</strong> Stricter thresholds (72/78/85 vs old 70/75/85)<br>
            &bull; <strong style="color:#22c55e;">NEW:</strong> Bear market penalty (-10pts when BTC in downtrend)<br>
            &bull; Automated momentum detection with daily/weekly/monthly views<br>
            &bull; Historical signal tracking with continuous 2-hour resolve<br>
            &bull; Covers 14+ established meme coins (Tier 1) plus emerging pumps (Tier 2)
          </div>
        </div>
        <div
          style="background:var(--card);border:1px solid rgba(239,68,68,0.3);border-radius:var(--radius);padding:16px;">
          <h4 style="font-size:14px;color:var(--red);margin-bottom:8px;">Critical Flaws</h4>
          <div style="font-size:12px;color:var(--dim);line-height:1.7;">
            &bull; <strong>ZERO fundamental analysis:</strong> Meme coins have no fundamentals to analyze<br>
            &bull; <strong>No social sentiment:</strong> Missing Reddit, Twitter/X, Telegram data<br>
            &bull; <strong>No whale wallet tracking:</strong> Cannot detect large holder movements<br>
            &bull; <strong>No rug-pull detection:</strong> Cannot identify scams or token exploits<br>
            &bull; <strong>No liquidity pool analysis:</strong> Cannot verify DEX liquidity depth<br>
            &bull; <strong>No smart contract audits:</strong> Cannot verify token contract safety<br>
            &bull; <strong>No market cap verification:</strong> Circulating supply data not validated<br>
            &bull; <strong>No order book depth:</strong> Spread alone is misleading; thin books cause 50%+ slippage<br>
            &bull; <strong>Feature conflicts:</strong> Momentum vs mean-reversion heuristics contradict each other
          </div>
        </div>
        <div
          style="background:var(--card);border:1px solid rgba(34,197,94,0.3);border-radius:var(--radius);padding:16px;">
          <h4 style="font-size:14px;color:var(--green);margin-bottom:8px;">What's Working</h4>
          <div style="font-size:12px;color:var(--dim);line-height:1.7;">
            &bull; Automated 24/7 scanning (every 10 minutes)<br>
            &bull; Momentum detection across multiple timeframes<br>
            &bull; Honest performance tracking (5% WR reported transparently)<br>
            &bull; Tier 1 vs Tier 2 separation for risk awareness<br>
            &bull; Continuous candle-walk resolve method (accurate outcome tracking)
          </div>
        </div>
      </div>

      <h4 style="font-size:15px;margin-bottom:10px;color:#f59e0b;">ML &amp; Learning Status</h4>
      <div
        style="background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:16px;">
        <div style="font-size:12px;color:var(--dim);line-height:1.7;">
          <strong style="color:var(--gold);">ML capability: In progress.</strong> This system is currently rule-based
          momentum scanning with static indicator weights. Meme-specific ML integration is actively being built by other
          agents, including adaptive parameter tuning and pattern learning from past signals.<br><br>
          <strong style="color:var(--text);">Platform-wide ML deployed:</strong> The core trading platform now has <span
            style="color:#22c55e;">DEPLOYED</span> concept drift detection (<code>concept_drift_detector.py</code>),
          multi-timeframe regime analysis (<code>multi_timeframe_regime.py</code>), and online incremental learning
          (<code>online_meta_learner.py</code>). Meme-specific adaptation of these systems is in development.
        </div>
      </div>

      <h4 style="font-size:15px;margin-bottom:10px;color:#f59e0b;">Safety Assessment</h4>
      <div
        style="background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.3);border-radius:var(--radius);padding:16px;margin-bottom:16px;">
        <div style="font-size:12px;color:#fca5a5;line-height:1.7;">
          <strong style="color:var(--red);">ABSOLUTELY NOT SAFE for real trading.</strong> Meme coins are the
          highest-risk asset class in all of finance. Our scanner provides price data only &mdash; it cannot detect
          scams, rug pulls, or worthless tokens. The &gt;95% failure rate of meme coins means the vast majority of
          positions will lose money. Never invest money you cannot afford to lose entirely.
        </div>
      </div>

      <!-- QUICK FIX PLAN SECTION -->
      <h4 style="font-size:15px;margin-bottom:10px;color:#22c55e;"><a name="quick-fixes"></a>Quick-Fix Implementation
        Plan</h4>
      <div
        style="background:rgba(34,197,94,0.06);border:1px solid rgba(34,197,94,0.3);border-radius:var(--radius);padding:16px;margin-bottom:16px;">
        <div style="font-size:12px;color:#86efac;line-height:1.7;">
          <strong style="color:#22c55e;">Phase 1: Immediate Fixes (COMPLETE)</strong>
          <ul style="margin:8px 0;padding-left:20px;">
            <li>&#10004; <strong>Exact TP/SL prices displayed</strong> - No more mental math on entry</li>
            <li>&#10004; <strong>Position sizing guidance added</strong> - Max 2% portfolio risk per trade</li>
            <li>&#10004; <strong>Better risk visualization</strong> - Color-coded risk levels on all cards</li>
            <li>&#10004; <strong>Quick entry/exit calculator</strong> - Instant profit/loss scenarios</li>
          </ul>
          <strong style="color:#f59e0b;">Phase 2: Accuracy Improvements (COMPLETE)</strong>
          <ul style="margin:8px 0;padding-left:20px;">
            <li>&#10004; <strong>Quality gates implemented</strong> - EMA trend + momentum + volume</li>
            <li>&#10004; <strong>Stricter thresholds</strong> - Raised from 70/75/85 to 72/78/85</li>
            <li>&#10004; <strong>Bear market penalty</strong> - -10pts when BTC in downtrend</li>
            <li>&#10004; <strong>Tier 2 scrutiny</strong> - Extra +10pts required for emerging coins</li>
          </ul>
          <strong style="color:#a855f7;">Phase 3: Short-term (This Week)</strong>
          <ul style="margin:8px 0;padding-left:20px;color:#d4d4d8;">
            <li>&#9675; <strong>Risk/reward ratio filters</strong> - Hide signals below 2:1 R/R</li>
            <li>&#9675; <strong>Correlation warnings</strong> - Alert when multiple meme signals are correlated</li>
            <li>&#9675; <strong>Time-of-day filters</strong> - Meme pumps often happen in specific sessions</li>
          </ul>
          <strong style="color:var(--dim);">Phase 4: Medium-term (This Month)</strong>
          <ul style="margin:8px 0;padding-left:20px;color:#d4d4d8;">
            <li>&#9675; <strong>Social sentiment overlay</strong> - Reddit/Twitter mention velocity</li>
            <li>&#9675; <strong>On-chain smart money tracking</strong> - Whale wallet monitoring</li>
            <li>&#9675; <strong>Machine learning signal filtering</strong> - Train on resolved outcomes</li>
            <li>&#9675; <strong>Multi-exchange price validation</strong> - Cross-check for manipulation</li>
          </ul>
        </div>
      </div>

      <h4 style="font-size:15px;margin-bottom:10px;color:#22c55e;">Position Size Calculator</h4>
      <div
        style="background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:16px;">
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin-bottom:12px;">
          <div>
            <label style="font-size:11px;color:var(--dim);text-transform:uppercase;letter-spacing:0.5px;">Portfolio Size
              ($)</label>
            <input type="number" id="calc-portfolio" value="10000"
              style="width:100%;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:#fff;font-size:13px;margin-top:4px;"
              oninput="updatePositionCalc()">
          </div>
          <div>
            <label style="font-size:11px;color:var(--dim);text-transform:uppercase;letter-spacing:0.5px;">Risk Per Trade
              (%)</label>
            <input type="number" id="calc-risk" value="2" min="0.5" max="10" step="0.5"
              style="width:100%;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:#fff;font-size:13px;margin-top:4px;"
              oninput="updatePositionCalc()">
          </div>
          <div>
            <label style="font-size:11px;color:var(--dim);text-transform:uppercase;letter-spacing:0.5px;">Entry Price
              ($)</label>
            <input type="number" id="calc-entry" value="0.001" step="0.000001"
              style="width:100%;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:#fff;font-size:13px;margin-top:4px;"
              oninput="updatePositionCalc()">
          </div>
          <div>
            <label style="font-size:11px;color:var(--dim);text-transform:uppercase;letter-spacing:0.5px;">Stop Loss
              ($)</label>
            <input type="number" id="calc-sl" value="0.00095" step="0.000001"
              style="width:100%;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:6px;padding:8px 10px;color:#fff;font-size:13px;margin-top:4px;"
              oninput="updatePositionCalc()">
          </div>
        </div>
        <div id="calc-results"
          style="background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.2);border-radius:8px;padding:12px;font-size:13px;">
          <div
            style="display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:16px;text-align:center;">
            <div>
              <div style="font-size:11px;color:var(--dim);text-transform:uppercase;letter-spacing:0.5px;">Position Size
              </div>
              <div id="calc-position-size" style="font-size:18px;font-weight:700;color:#22c55e;">--</div>
            </div>
            <div>
              <div style="font-size:11px;color:var(--dim);text-transform:uppercase;letter-spacing:0.5px;">Max Loss</div>
              <div id="calc-max-loss" style="font-size:18px;font-weight:700;color:#ef4444;">--</div>
            </div>
            <div>
              <div style="font-size:11px;color:var(--dim);text-transform:uppercase;letter-spacing:0.5px;">Risk/Reward
              </div>
              <div id="calc-rr" style="font-size:18px;font-weight:700;color:#f59e0b;">--</div>
            </div>
          </div>
        </div>
        <div style="font-size:11px;color:var(--dim);margin-top:10px;">
          <strong style="color:#f59e0b;">Rule of thumb:</strong> Never risk more than 1-2% of your portfolio on a single
          meme coin trade. With a 5% win rate, you need strict risk management to survive until the next winning trade.
        </div>
      </div>
      <script>
        function updatePositionCalc() {
          var portfolio = parseFloat(document.getElementById('calc-portfolio').value) || 0;
          var riskPct = parseFloat(document.getElementById('calc-risk').value) || 0;
          var entry = parseFloat(document.getElementById('calc-entry').value) || 0;
          var sl = parseFloat(document.getElementById('calc-sl').value) || 0;

          if (portfolio > 0 && riskPct > 0 && entry > 0 && sl > 0 && entry !== sl) {
            var maxLoss = portfolio * (riskPct / 100);
            var priceRisk = Math.abs(entry - sl);
            var positionSize = maxLoss / (priceRisk / entry);
            var rr = priceRisk > 0 ? (entry * 0.05) / priceRisk : 0; // Assuming 5% target

            document.getElementById('calc-position-size').textContent = '$' + positionSize.toFixed(2);
            document.getElementById('calc-max-loss').textContent = '$' + maxLoss.toFixed(2);
            document.getElementById('calc-rr').textContent = '1:' + rr.toFixed(1);
          }
        }
        updatePositionCalc();
      </script>

      <h4 style="font-size:15px;margin-bottom:10px;color:#f59e0b;">API Endpoints</h4>
      <div
        style="background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:16px;">
        <div style="font-size:12px;color:var(--dim);line-height:1.8;">
          &bull; <strong>Scanner stats:</strong> <a href="api/meme_scanner.php?action=stats" target="_blank"
            style="color:#c4b5fd">meme_scanner.php?action=stats</a> &mdash; overall performance metrics<br>
          &bull; <strong>Live signals:</strong> <a href="api/meme_scanner.php?action=scan" target="_blank"
            style="color:#c4b5fd">meme_scanner.php?action=scan</a> &mdash; current top meme coins<br>
          &bull; <strong>Signal history:</strong> <a href="api/meme_scanner.php?action=history" target="_blank"
            style="color:#c4b5fd">meme_scanner.php?action=history</a> &mdash; all signals with outcomes<br>
          &bull; <strong>Data sources:</strong> Kraken public API + CoinGecko (rankings) and Crypto.com Exchange public
          API (scanner)
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- TAB 3: RESEARCH & FUTURE -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="main-panel" id="main-research">
      <div class="section-title" style="color:#a855f7;">Third-Party Analysis <span class="badge"
          style="background:rgba(168,85,247,0.15);color:#a855f7;border:1px solid rgba(168,85,247,0.3);">GROK.COM REVIEW</span>
        <a href="/findcryptopairs/meme-research-chatgpt.html" style="margin-left:12px;font-size:12px;color:#10a37f;text-decoration:underline;">View ChatGPT Audit &#8594;</a>
      </div>

      <!-- ChatGPT Deep Research Banner -->
      <div style="background:rgba(16,163,127,0.08);border:1px solid rgba(16,163,127,0.3);border-radius:var(--radius);padding:16px;margin-bottom:20px;">
        <h4 style="font-size:15px;color:#10a37f;margin-bottom:10px;display:flex;align-items:center;gap:8px;">
          <span>&#128241;</span> ChatGPT Deep Research Audit Available
        </h4>
        <div style="font-size:12px;color:#6ee7b7;line-height:1.7;">
          Comprehensive third-party analysis covering: statistical validity (sample size crisis), feature conflicts (momentum vs entry position), 
          microstructure blind spots (depth missing), survivorship bias, and a 4-phase implementation roadmap to achieve 40%+ win rate.
          <br><br>
          <a href="/findcryptopairs/meme-research-chatgpt.html" style="display:inline-block;padding:8px 16px;background:rgba(16,163,127,0.2);color:#10a37f;border:1px solid rgba(16,163,127,0.4);border-radius:6px;text-decoration:none;font-weight:600;">Read Full Audit Report &#8594;</a>
        </div>
      </div>
      <p style="font-size:13px;color:var(--dim);margin-bottom:16px;">Comprehensive third-party analysis from Grok.com (xAI) evaluating our framework's strengths, flaws, and competitive positioning against industry best practices.</p>

      <!-- Framework Strengths -->
      <div style="background:var(--card);border:1px solid rgba(34,197,94,0.3);border-radius:var(--radius);padding:16px;margin-bottom:16px;">
        <h4 style="font-size:15px;margin-bottom:12px;display:flex;align-items:center;gap:8px;color:#22c55e;">
          &#9989; Framework Strengths
          <span style="font-size:10px;padding:2px 8px;border-radius:4px;background:rgba(34,197,94,0.15);color:#22c55e;border:1px solid rgba(34,197,94,0.3);">VALIDATED</span>
        </h4>
        <div style="font-size:12px;color:var(--dim);line-height:1.8;">
          <strong style="color:var(--text);">Momentum-Based Efficiency:</strong> The scanner effectively identifies short-term opportunities using technical indicators like volume surges and RSI, with quality gates adding a layer of filtering. It's tailored for Kraken-listed coins, providing real-time rankings and exit strategies.<br><br>
          <strong style="color:var(--text);">Transparency &amp; User Tools:</strong> Includes historical logs, daily picks, risk calculators, and honest performance tracking (5% WR reported transparently). This aligns with best practices for avoiding overconfidence.<br><br>
          <strong style="color:var(--text);">Meme-Specific Tuning:</strong> Indicators like RSI Hype Zone (55-80 optimal) account for memes' unique behavior of sustaining overbought conditions, outperforming traditional TA in hype-driven markets.<br><br>
          <strong style="color:var(--text);">Quality Gates:</strong> Requires 2/3 gates passed (Trend Confirm, Momentum Gate, Volume Gate) to filter noise, potentially improving win rates from v1's baseline toward 40%+ targets.
        </div>
      </div>

      <!-- Critical Flaws Analysis -->
      <div style="background:var(--card);border:1px solid rgba(239,68,68,0.3);border-radius:var(--radius);padding:16px;margin-bottom:16px;">
        <h4 style="font-size:15px;margin-bottom:12px;display:flex;align-items:center;gap:8px;color:#ef4444;">
          &#9888;&#65039; Critical Flaws Identified
          <span style="font-size:10px;padding:2px 8px;border-radius:4px;background:rgba(239,68,68,0.15);color:#ef4444;border:1px solid rgba(239,68,68,0.3);">ACTION REQUIRED</span>
        </h4>
        <div style="font-size:12px;color:var(--dim);line-height:1.8;">
          <strong style="color:#fca5a5;">1. Incomplete Data Integration:</strong> Heavy dependence on price/volume proxies ignores direct social sentiment (Twitter, Reddit, Telegram) and on-chain metrics (holder concentration, liquidity pools). Studies show rug pulls and pump-and-dumps‚Äîprevalent in 60% of meme frauds‚Äîare undetectable here.<br><br>
          <strong style="color:#fca5a5;">2. Low Predictive Accuracy:</strong> The ~5% win rate indicates inefficiency; proxies like "Social Momentum" infer hype but miss real-time narratives (e.g., celeb endorsements). Without AI/NLP for sentiment, it lags behind bots achieving 80%+ accuracy via social scanning.<br><br>
          <strong style="color:#fca5a5;">3. Exchange &amp; Scope Bias:</strong> Kraken-only focus (despite Crypto.com for discovery) overlooks DEX listings or cross-exchange arbitrage, missing early winners. Broader markets drive 100x gains.<br><br>
          <strong style="color:#fca5a5;">4. Risk Management Gaps:</strong> While warnings exist, no automated whale tracking or AML/KYC integration exposes users to manipulations (e.g., single holders dumping 20-40%). Short 2-hour windows may miss intra-minute pumps.<br><br>
          <strong style="color:#fca5a5;">5. No AI/ML Integration:</strong> Lacks machine learning for predictive modeling, unlike advanced bots. No backtesting against historical frauds or rug-pull pattern detection.
        </div>
      </div>

      <!-- Framework vs Industry Best Practices -->
      <h4 style="font-size:15px;margin-bottom:10px;color:#a855f7;">Framework vs Industry Best Practices</h4>
      <div style="background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:16px;overflow-x:auto;">
        <table style="width:100%;font-size:11px;border-collapse:collapse;min-width:600px;">
          <thead>
            <tr style="border-bottom:1px solid var(--border);">
              <th style="text-align:left;padding:8px;color:var(--dim);font-size:10px;text-transform:uppercase;">Indicator</th>
              <th style="text-align:left;padding:8px;color:var(--dim);font-size:10px;text-transform:uppercase;">Our Framework</th>
              <th style="text-align:left;padding:8px;color:var(--dim);font-size:10px;text-transform:uppercase;">Industry Best Practice</th>
              <th style="text-align:left;padding:8px;color:var(--dim);font-size:10px;text-transform:uppercase;">Impact</th>
            </tr>
          </thead>
          <tbody style="color:var(--text);">
            <tr style="border-bottom:1px solid rgba(42,42,74,0.5);">
              <td style="padding:8px;font-weight:600;">Volume Analysis</td>
              <td style="padding:8px;color:var(--gold);">Explosive Volume (3x avg = +12 pts)</td>
              <td style="padding:8px;color:var(--green);">Combine with on-chain liquidity checks (DexScreener)</td>
              <td style="padding:8px;color:var(--red);">Misses fabricated volume</td>
            </tr>
            <tr style="border-bottom:1px solid rgba(42,42,74,0.5);">
              <td style="padding:8px;font-weight:600;">Momentum</td>
              <td style="padding:8px;color:var(--gold);">Parabolic (5m/15m acceleration)</td>
              <td style="padding:8px;color:var(--green);">EMA crosses + order flow analysis</td>
              <td style="padding:8px;color:var(--red);">Short-term bias</td>
            </tr>
            <tr style="border-bottom:1px solid rgba(42,42,74,0.5);">
              <td style="padding:8px;font-weight:600;">RSI</td>
              <td style="padding:8px;color:var(--gold);">Hype Zone (55-80 optimal)</td>
              <td style="padding:8px;color:var(--green);">Pair with sentiment scores from Twitter/Telegram</td>
              <td style="padding:8px;color:var(--gold);">Lacks hype validation</td>
            </tr>
            <tr style="border-bottom:1px solid rgba(42,42,74,0.5);">
              <td style="padding:8px;font-weight:600;">Social Proxy</td>
              <td style="padding:8px;color:var(--red);">Price &#215; Volume Ratio</td>
              <td style="padding:8px;color:var(--green);">AI/NLP sentiment analysis (bot monitoring)</td>
              <td style="padding:8px;color:var(--red);">Weak proxy; 20-30% accuracy loss</td>
            </tr>
            <tr style="border-bottom:1px solid rgba(42,42,74,0.5);">
              <td style="padding:8px;font-weight:600;">Breakouts</td>
              <td style="padding:8px;color:var(--gold);">vs. 4h High</td>
              <td style="padding:8px;color:var(--green);">Narrative rotation (theme tracking)</td>
              <td style="padding:8px;color:var(--gold);">FOMO-focused</td>
            </tr>
            <tr style="border-bottom:1px solid rgba(42,42,74,0.5);">
              <td style="padding:8px;font-weight:600;">Market Cap</td>
              <td style="padding:8px;color:var(--gold);">Low Cap Preference</td>
              <td style="padding:8px;color:var(--green);">Risk-adjusted (holder distribution)</td>
              <td style="padding:8px;color:var(--red);">Rug-prone without safeguards</td>
            </tr>
            <tr>
              <td style="padding:8px;font-weight:600;">Risk Management</td>
              <td style="padding:8px;color:var(--gold);">Quality Gates + Warnings</td>
              <td style="padding:8px;color:var(--green);">Full AML/KYC + AI fraud prediction</td>
              <td style="padding:8px;color:var(--red);">Reactive, not proactive</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Kraken Meme Coins Reference -->
      <h4 style="font-size:15px;margin-bottom:10px;color:#a855f7;">Kraken-Listed Meme Coins &amp; Prediction Factors</h4>
      <div style="background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:16px;overflow-x:auto;">
        <table style="width:100%;font-size:11px;border-collapse:collapse;min-width:700px;">
          <thead>
            <tr style="border-bottom:1px solid var(--border);">
              <th style="text-align:left;padding:8px;color:var(--dim);font-size:10px;text-transform:uppercase;">Coin</th>
              <th style="text-align:left;padding:8px;color:var(--dim);font-size:10px;text-transform:uppercase;">Est. Market Cap</th>
              <th style="text-align:left;padding:8px;color:var(--dim);font-size:10px;text-transform:uppercase;">Key Prediction Factors</th>
              <th style="text-align:left;padding:8px;color:var(--dim);font-size:10px;text-transform:uppercase;">Historical Performance</th>
              <th style="text-align:left;padding:8px;color:var(--dim);font-size:10px;text-transform:uppercase;">Kraken Since</th>
            </tr>
          </thead>
          <tbody style="color:var(--text);">
            <tr style="border-bottom:1px solid rgba(42,42,74,0.5);">
              <td style="padding:8px;font-weight:700;color:#fff;">DOGE</td>
              <td style="padding:8px;">$50B+</td>
              <td style="padding:8px;color:var(--dim);">Strong community, celeb influence (Elon Musk)</td>
              <td style="padding:8px;color:var(--green);">+10,000% since 2021</td>
              <td style="padding:8px;">2014</td>
            </tr>
            <tr style="border-bottom:1px solid rgba(42,42,74,0.5);">
              <td style="padding:8px;font-weight:700;color:#fff;">SHIB</td>
              <td style="padding:8px;">$15B</td>
              <td style="padding:8px;color:var(--dim);">Burn mechanisms, ecosystem utility</td>
              <td style="padding:8px;color:var(--green);">+1M% peak in 2021</td>
              <td style="padding:8px;">2021</td>
            </tr>
            <tr style="border-bottom:1px solid rgba(42,42,74,0.5);">
              <td style="padding:8px;font-weight:700;color:#fff;">PEPE</td>
              <td style="padding:8px;">$5B</td>
              <td style="padding:8px;color:var(--dim);">Viral memes, high volatility</td>
              <td style="padding:8px;color:var(--green);">+10,000% in 2023</td>
              <td style="padding:8px;">2023</td>
            </tr>
            <tr style="border-bottom:1px solid rgba(42,42,74,0.5);">
              <td style="padding:8px;font-weight:700;color:#fff;">BONK</td>
              <td style="padding:8px;">$2B</td>
              <td style="padding:8px;color:var(--dim);">Solana ecosystem ties</td>
              <td style="padding:8px;color:var(--green);">+5,000% in 2024</td>
              <td style="padding:8px;">2023</td>
            </tr>
            <tr style="border-bottom:1px solid rgba(42,42,74,0.5);">
              <td style="padding:8px;font-weight:700;color:#fff;">WIF</td>
              <td style="padding:8px;">$1.5B</td>
              <td style="padding:8px;color:var(--dim);">Narrative hype (dog-themed)</td>
              <td style="padding:8px;color:var(--green);">+2,000% in 2025</td>
              <td style="padding:8px;">2024</td>
            </tr>
            <tr style="border-bottom:1px solid rgba(42,42,74,0.5);">
              <td style="padding:8px;font-weight:700;color:#fff;">FLOKI</td>
              <td style="padding:8px;">$1B</td>
              <td style="padding:8px;color:var(--dim);">Marketing campaigns</td>
              <td style="padding:8px;color:var(--green);">+500% in 2025</td>
              <td style="padding:8px;">2022</td>
            </tr>
            <tr>
              <td style="padding:8px;font-weight:700;color:#fff;">POPCAT</td>
              <td style="padding:8px;">$800M</td>
              <td style="padding:8px;color:var(--dim);">Pop culture trends</td>
              <td style="padding:8px;color:var(--green);">+1,000% in 2025</td>
              <td style="padding:8px;">2025</td>
            </tr>
          </tbody>
        </table>
        <div style="font-size:10px;color:var(--dim);margin-top:8px;">Data sourced from Kraken and CoinGecko; predictions based on momentum/social factors.</div>
      </div>

      <!-- Strategies to Beat Competitors -->
      <h4 style="font-size:15px;margin-bottom:10px;color:#22c55e;">Strategies to Outperform Competitors</h4>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:12px;margin-bottom:16px;">
        <div style="background:var(--card);border:1px solid rgba(34,197,94,0.2);border-radius:var(--radius);padding:14px;">
          <h5 style="font-size:13px;color:#22c55e;margin-bottom:8px;">&#128200; Enhanced Data Layers</h5>
          <div style="font-size:11px;color:var(--dim);line-height:1.7;">
            Add on-chain analysis (DexScreener for holder audits) and social monitoring (X/Twitter sentiment via AI bots). AI achieves 80%+ win rates by processing vast data pre-market reaction.
          </div>
        </div>
        <div style="background:var(--card);border:1px solid rgba(34,197,94,0.2);border-radius:var(--radius);padding:14px;">
          <h5 style="font-size:13px;color:#22c55e;margin-bottom:8px;">&#128640; Advanced Prediction</h5>
          <div style="font-size:11px;color:var(--dim);line-height:1.7;">
            Use momentum surfing (scan 24-72h top performers) and narrative rotation (track themes like AI-memes). Incorporate ML models for rug-pull prediction.
          </div>
        </div>
        <div style="background:var(--card);border:1px solid rgba(34,197,94,0.2);border-radius:var(--radius);padding:14px;">
          <h5 style="font-size:13px;color:#22c55e;margin-bottom:8px;">&#128737; Risk Mitigation</h5>
          <div style="font-size:11px;color:var(--dim);line-height:1.7;">
            Enforce 1% position sizing, trailing stops, and DCA (Kraken-supported). Avoid neglecting charts‚Äîuse EMA for entries. Aim for 10-20% portfolio allocation to memes max.
          </div>
        </div>
        <div style="background:var(--card);border:1px solid rgba(34,197,94,0.2);border-radius:var(--radius);padding:14px;">
          <h5 style="font-size:13px;color:#22c55e;margin-bottom:8px;">&#127942; Competitive Edge</h5>
          <div style="font-size:11px;color:var(--dim);line-height:1.7;">
            Backtest against historical meme cycles; diversify to upcoming Kraken listings. Balance with stables. Refined strategies have shown 40-80% improvements in controlled tests.
          </div>
        </div>
      </div>

      <!-- Implementation Roadmap (Combined Grok + ChatGPT) -->
      <div style="background:var(--card);border:1px solid rgba(232,121,249,0.3);border-radius:var(--radius);padding:16px;margin-bottom:16px;">
        <h3 style="font-size:15px;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
          Implementation Roadmap
          <span style="font-size:10px;padding:2px 8px;border-radius:4px;background:rgba(34,197,94,0.15);color:#22c55e;border:1px solid rgba(34,197,94,0.3);">POST-AUDIT</span>
        </h3>
        <div style="font-size:12px;color:var(--dim);line-height:1.9;">
          <strong style="color:var(--green);">Week 1 &#8212; Formalize Labels &amp; Evaluation (ChatGPT P0):</strong><br>
          &#8226; Define canonical prediction task (TP/SL/horizon) for both Kraken &amp; scanner<br>
          &#8226; Build unified evaluation script with same resolution rules<br>
          &#8226; Add immutable logging (signals + features + version hash)<br>
          &#8226; Target: 350+ resolved signals for statistical validity<br><br>
          
          <strong style="color:var(--gold);">Weeks 2-3 &#8212; Microstructure &amp; Execution (ChatGPT P0):</strong><br>
          &#8226; Add Kraken depth proxies (order book depth buckets)<br>
          &#8226; Calibrate slippage models with live paper-trades<br>
          &#8226; Resolve momentum vs entry position conflict (pick one regime)<br>
          &#8226; Dashboards: expectancy + drawdown by tier/regime<br><br>
          
          <strong style="color:#a855f7;">Month 1-2 &#8212; Social + On-Chain Gating:</strong><br>
          &#8226; Integrate mention velocity &amp; sentiment (30-120 min lag, timestamped)<br>
          &#8226; Implement Tier-2 on-chain safety (LP lock, top-holder %, contract flags)<br>
          &#8226; Run walk-forward tests; freeze "v3" with locked parameters<br>
          &#8226; Replace static thresholds (72/78/85) with calibrated probabilities<br><br>
          
          <strong style="color:var(--dim);">Long-Term &#8212; 40%+ Win Rate Target:</strong><br>
          &#8226; Full on-chain analytics (Nansen-level wallet labeling)<br>
          &#8226; AI/NLP sentiment with price prediction (research shows 80%+ accuracy)<br>
          &#8226; ML rug-pull detection (trained on known scams)<br>
          &#8226; Unified backtesting + online evaluation with A/B testing
        </div>
      </div>

      <!-- Academic Research -->
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:12px;margin-bottom:20px;">
        <div style="background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;">
          <h4 style="font-size:14px;color:#a855f7;margin-bottom:8px;">Academic Research</h4>
          <div style="font-size:12px;color:var(--dim);line-height:1.7;">
            <strong>Meme coin pump dynamics:</strong> Price surges driven primarily by social media virality, not fundamentals. Pumps follow power-law distributions.<br>
            <strong>Ante (2023):</strong> Social sentiment precedes price movement by 30&#8211;120 minutes.<br>
            <strong>Rug-pull detection:</strong> 64.7% of traders lose money due to undetected manipulations.<br>
            <strong>AI/NLP bots:</strong> Achieve 80%+ win rates by analyzing social data pre-market reaction.
          </div>
        </div>
        <div style="background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;">
          <h4 style="font-size:14px;color:#a855f7;margin-bottom:8px;">World-Class Tools</h4>
          <div style="font-size:12px;color:var(--dim);line-height:1.7;">
            <strong>Nansen ($100/mo):</strong> On-chain analytics, wallet labeling, smart money tracking.<br>
            <strong>Dune Analytics:</strong> Custom blockchain queries, token holder analysis.<br>
            <strong>LunarCrush ($30/mo):</strong> Social intelligence, influencer tracking.<br>
            <strong>Bubblemaps:</strong> Visual wallet clustering, concentration risk.<br>
            <strong>Our gap:</strong> Price-only vs. full social + on-chain layer.
          </div>
        </div>
      </div>

      <!-- Key Citations -->
      <div style="background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:16px;">
        <h4 style="font-size:13px;margin-bottom:10px;color:var(--dim);">Key Citations &amp; Sources</h4>
        <div style="font-size:11px;color:var(--dim);line-height:1.8;">
          &#8226; Kraken: Trading Memecoins Guide | FXEmpire: Memecoin Trading Strategies | Medium: Building Crypto Trading Bot with Meme Support<br>
          &#8226; BitDegree: Finding Meme Coins Early | ResearchGate: Risks in Meme Coins (64% trader loss rate)<br>
          &#8226; SSRN: Decompose Market Manipulation in Meme Coins | Ante (2023): Social sentiment correlation<br>
          &#8226; Grok.com (xAI) Analysis: Framework evaluation and competitive benchmarking (Feb 2026)
        </div>
      </div>

      <!-- Bottom Disclaimer -->
      <div style="background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.2);border-radius:var(--radius);padding:16px;margin-bottom:16px;">
        <div style="font-size:12px;color:#fca5a5;line-height:1.7;">
          <strong style="color:var(--red);">Third-Party Analysis Disclaimer:</strong> This analysis was generated by Grok.com (xAI) as an independent evaluation. 
          The ~5% win rate reflects historical performance of our v1/v2 algorithm. Past performance does not guarantee future results. 
          Meme coins are highly speculative&#8212;64.7% of traders lose or break even according to industry research. 
          Always use disposable capital and conduct personal due diligence. This is not financial advice.
        </div>
      </div>
    </div>

  </div>

  <script>
    // ‚îÄ‚îÄ Main tab switching ‚îÄ‚îÄ
    function switchMainTab(tab) {
      var tabNames = ['scanner', 'hot', 'analysis', 'research'];
      var btns = document.querySelectorAll('.main-tab-btn');
      var panels = document.querySelectorAll('.main-panel');
      for (var i = 0; i < btns.length; i++) {
        btns[i].classList.toggle('active', tabNames[i] === tab);
      }
      for (var j = 0; j < panels.length; j++) {
        panels[j].classList.remove('active');
      }
      document.getElementById('main-' + tab).classList.add('active');
      
      // Load hot trending if switching to that tab
      if (tab === 'hot' && !window.hotTrendingLoaded) {
        window.hotTrendingLoaded = true;
        loadHotTrending('30m');
      }
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  HOT TRENDING SCANNER ‚Äî Real-time momentum detection
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    var HOT_API = '/findcryptopairs/api/hot_trending_scanner.php';
    var currentHotTimeframe = '30m';
    
    function loadHotTrending(timeframe) {
      if (typeof timeframe === 'string') {
        currentHotTimeframe = timeframe;
        // Update button states
        document.querySelectorAll('.hot-tf-btn').forEach(function(btn) {
          btn.classList.remove('active');
          btn.style.background = 'rgba(255,255,255,0.05)';
          btn.style.color = 'var(--dim)';
          btn.style.borderColor = 'var(--border)';
        });
        var activeBtn = document.getElementById('tf-' + timeframe);
        if (activeBtn) {
          activeBtn.classList.add('active');
          activeBtn.style.background = 'rgba(239,68,68,0.15)';
          activeBtn.style.color = '#ef4444';
          activeBtn.style.borderColor = 'rgba(239,68,68,0.3)';
        }
      }
      
      var statusEl = document.getElementById('hot-scan-status');
      if (statusEl) statusEl.style.display = 'block';
      
      var url = HOT_API + '?action=scan&tf=' + currentHotTimeframe + '&_=' + Date.now();
      var x = new XMLHttpRequest();
      x.open('GET', url);
      x.onload = function() {
        try {
          var r = JSON.parse(x.responseText);
          if (r.ok) {
            renderHotTrending(r);
          } else {
            showHotError(r.error || 'Unknown error');
          }
        } catch (e) {
          showHotError('Parse error: ' + e.message);
        }
      };
      x.onerror = function() {
        showHotError('Network error');
      };
      x.send();
    }
    
    function renderHotTrending(data) {
      // Hide loading
      var statusEl = document.getElementById('hot-scan-status');
      if (statusEl) statusEl.style.display = 'none';
      
      // Show sections
      var krakenSection = document.getElementById('hot-kraken-section');
      var watchSection = document.getElementById('hot-watch-section');
      var otherSection = document.getElementById('hot-other-section');
      var emptyState = document.getElementById('hot-empty-state');
      
      // Render Kraken Hot (high confidence)
      var krakenList = document.getElementById('hot-kraken-list');
      if (data.kraken_hot && data.kraken_hot.length > 0) {
        krakenList.innerHTML = renderHotCoinCards(data.kraken_hot, 'high');
        krakenSection.style.display = 'block';
      } else {
        krakenSection.style.display = 'none';
      }
      
      // Render Watch List
      var watchList = document.getElementById('hot-watch-list');
      if (data.watch_list && data.watch_list.length > 0) {
        watchList.innerHTML = renderHotCoinCards(data.watch_list, 'medium');
        watchSection.style.display = 'block';
      } else {
        watchSection.style.display = 'none';
      }
      
      // Render Other
      var otherList = document.getElementById('hot-other-list');
      if (data.other_trending && data.other_trending.length > 0) {
        otherList.innerHTML = renderHotCoinCards(data.other_trending, 'low');
        otherSection.style.display = 'block';
      } else {
        otherSection.style.display = 'none';
      }
      
      // Show empty state if nothing found
      if ((!data.kraken_hot || data.kraken_hot.length === 0) &&
          (!data.watch_list || data.watch_list.length === 0)) {
        emptyState.style.display = 'block';
      } else {
        emptyState.style.display = 'none';
      }
    }
    
    function renderHotCoinCards(coins, tier) {
      var html = '<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:12px;">';
      
      for (var i = 0; i < coins.length; i++) {
        var c = coins[i];
        var confColor = c.confidence >= 75 ? '#22c55e' : c.confidence >= 60 ? '#86efac' : c.confidence >= 45 ? '#fcd34d' : '#9ca3af';
        var recColor = c.recommendation === 'STRONG_BUY' ? '#22c55e' : c.recommendation === 'BUY' ? '#86efac' : c.recommendation === 'WATCH' ? '#fcd34d' : '#9ca3af';
        var recText = c.recommendation === 'STRONG_BUY' ? 'Strong Buy' : c.recommendation === 'BUY' ? 'Buy' : c.recommendation === 'WATCH' ? 'Watch' : c.recommendation === 'WEAK' ? 'Weak' : 'Not Tradable';
        
        html += '<div style="background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;position:relative;overflow:hidden;">';
        
        // Confidence bar at top
        html += '<div style="position:absolute;top:0;left:0;right:0;height:4px;background:' + confColor + ';opacity:0.8;"></div>';
        
        // Header
        html += '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">';
        html += '<div><strong style="font-size:18px;color:#fff;">' + c.symbol + '</strong>';
        html += '<div style="font-size:11px;color:var(--dim);">' + c.name + '</div></div>';
        html += '<div style="text-align:right;">';
        html += '<div style="font-size:24px;font-weight:800;color:' + confColor + ';">' + c.confidence + '<span style="font-size:12px;">%</span></div>';
        html += '<div style="font-size:10px;color:var(--dim);text-transform:uppercase;">Confidence</div>';
        html += '</div></div>';
        
        // Price and change
        html += '<div style="display:flex;gap:16px;margin-bottom:12px;font-size:13px;">';
        html += '<span>Price: <strong style="color:#fff;">$' + (c.price ? c.price.toFixed(6) : '--') + '</strong></span>';
        html += '<span>24h: <strong style="color:' + (c.chg_24h >= 0 ? '#22c55e' : '#ef4444') + ';">' + (c.chg_24h >= 0 ? '+' : '') + (c.chg_24h ? c.chg_24h.toFixed(2) : '0') + '%</strong></span>';
        html += '</div>';
        
        // Technical factors
        if (c.technical && c.technical.factors) {
          html += '<div style="margin-bottom:12px;">';
          html += '<div style="font-size:10px;color:var(--dim);margin-bottom:4px;">Technical Factors:</div>';
          html += '<div style="display:flex;flex-wrap:wrap;gap:4px;">';
          for (var j = 0; j < c.technical.factors.length; j++) {
            var factor = c.technical.factors[j];
            var factorLabel = factor.replace(/_/g, ' ');
            html += '<span style="font-size:9px;padding:2px 6px;background:rgba(34,197,94,0.15);color:#22c55e;border-radius:3px;">' + factorLabel + '</span>';
          }
          html += '</div></div>';
        }
        
        // RSI and Volume
        if (c.technical) {
          html += '<div style="display:flex;gap:12px;margin-bottom:12px;font-size:11px;color:var(--dim);">';
          if (c.technical.rsi) html += '<span>RSI: <strong style="color:#fff;">' + c.technical.rsi.toFixed(1) + '</strong></span>';
          if (c.technical.volume_ratio) html += '<span>Vol: <strong style="color:#fff;">' + c.technical.volume_ratio.toFixed(1) + 'x</strong></span>';
          html += '</div>';
        }
        
        // Recommendation, Audit, and Trade buttons
        html += '<div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.05);gap:8px;">';
        html += '<span style="font-size:11px;padding:3px 10px;border-radius:4px;background:' + recColor + '20;color:' + recColor + ';border:1px solid ' + recColor + '40;font-weight:600;flex-shrink:0;">' + recText + '</span>';
        
        html += '<div style="display:flex;gap:6px;">';
        // Audit button
        html += '<button onclick="openAuditModal(\'' + c.symbol + '\', \'hot\')" style="font-size:10px;padding:4px 8px;background:rgba(99,102,241,0.15);color:#818cf8;border:1px solid rgba(99,102,241,0.3);border-radius:4px;cursor:pointer;font-weight:600;" title="View audit trail">üîç Audit</button>';
        
        // Trade button
        if (c.on_kraken && c.kraken_pair) {
          var symLower = c.symbol.toLowerCase();
          html += '<a href="https://pro.kraken.com/app/trade/' + symLower + '-usd" target="_blank" style="font-size:10px;padding:4px 10px;background:rgba(239,68,68,0.15);color:#ef4444;border:1px solid rgba(239,68,68,0.3);border-radius:4px;text-decoration:none;font-weight:600;">Trade ‚Üí</a>';
        }
        html += '</div>';
        
        html += '</div></div>';
      }
      
      html += '</div>';
      return html;
    }
    
    function showHotError(msg) {
      var statusEl = document.getElementById('hot-scan-status');
      if (statusEl) {
        statusEl.innerHTML = '<div style="color:#ef4444;">Error: ' + msg + '</div>';
      }
    }

    function toggleEdu(el) {
      var body = el.nextElementSibling;
      var arrow = el.querySelector('.edu-arrow');
      if (body.classList.contains('open')) {
        body.classList.remove('open');
        arrow.classList.remove('open');
      } else {
        body.classList.add('open');
        arrow.classList.add('open');
      }
    }

    var API = '/findcryptopairs/api/meme_scanner.php';

    function api(action, cb) {
      var x = new XMLHttpRequest();
      x.open('GET', API + '?action=' + action);
      x.onload = function () {
        try { cb(JSON.parse(x.responseText)); } catch (e) { console.error(e); }
      };
      x.onerror = function () { console.error('API error'); };
      x.send();
    }

    function formatPnl(v) {
      v = parseFloat(v);
      if (isNaN(v)) return '--';
      var cls = v >= 0 ? 'green' : 'red';
      return '<span class="' + cls + '">' + (v >= 0 ? '+' : '') + v.toFixed(2) + '%</span>';
    }

    function verdictBadge(v) {
      if (v === 'STRONG_BUY') return '<span class="badge badge-strong">Strong Buy</span>';
      if (v === 'BUY') return '<span class="badge badge-buy">Buy</span>';
      return '<span class="badge badge-lean">Lean Buy</span>';
    }

    function tierBadge(t) {
      if (t === 'tier1') return '<span class="badge-tier1">Established</span>';
      return '<span class="badge-tier2">Emerging</span>';
    }

    function factorBar(score, max) {
      var pct = Math.round((score / max) * 100);
      var color = pct >= 80 ? 'var(--green)' : pct >= 50 ? 'var(--gold)' : 'var(--red)';
      return '<div class="factor-bar"><div class="factor-fill" style="width:' + pct + '%;background:' + color + '"></div></div>';
    }

    // ‚îÄ‚îÄ BUY NOW Ranking System ‚îÄ‚îÄ
    // Computes a composite rank factoring freshness, R:R, and base score
    function computeBuyNowRank(w) {
      var baseScore = parseInt(w.score) || 0;
      var targetPct = parseFloat(w.target_pct || 0);
      var riskPct = parseFloat(w.risk_pct || 0);
      var createdAt = w.created_at || '';

      // Freshness penalty: -2 pts per minute since signal, max -30
      var ageMinutes = 0;
      if (createdAt) {
        var signalTime = new Date(createdAt.replace(' ', 'T') + 'Z');
        ageMinutes = Math.max(0, (Date.now() - signalTime.getTime()) / 60000);
      }
      var freshnessPenalty = Math.min(30, Math.floor(ageMinutes) * 2);

      // R:R bonus: better ratio = higher rank (max +10)
      var rrRatio = riskPct > 0 ? targetPct / riskPct : 0;
      var rrBonus = Math.min(10, Math.floor(rrRatio * 3));

      // Regime bonus from factors
      var f = w.factors_json || {};
      var regimeAdj = 0;
      if (f.btc_regime && f.btc_regime.adjustment) {
        regimeAdj = parseInt(f.btc_regime.adjustment) || 0;
      }

      // Quality gate bonus
      var qualityBonus = 0;
      if (f.quality_check && f.quality_check.score >= 3) qualityBonus = 5;
      else if (f.quality_check && f.quality_check.score >= 2) qualityBonus = 2;

      var rank = baseScore - freshnessPenalty + rrBonus + regimeAdj + qualityBonus;
      return {
        rank: Math.max(0, Math.min(100, rank)),
        ageMinutes: Math.floor(ageMinutes),
        freshnessPenalty: freshnessPenalty,
        rrBonus: rrBonus,
        rrRatio: rrRatio,
        regimeAdj: regimeAdj,
        qualityBonus: qualityBonus
      };
    }

    function getAgeBadge(ageMinutes) {
      if (ageMinutes < 10) return '<span class="signal-age-badge age-fresh">' + ageMinutes + 'm ago</span>';
      if (ageMinutes < 20) return '<span class="signal-age-badge age-aging">' + ageMinutes + 'm ago</span>';
      return '<span class="signal-age-badge age-stale">' + ageMinutes + 'm ago</span>';
    }

    // Store current winners globally for live mode and verify modal
    window.currentWinners = [];

    function renderWinners(data) {
      // Show BTC regime indicator if available
      updateBtcRegimeBar(data.btc_regime, data.btc_trend_pct, data.last_scan);

      if (!data.ok || data.count === 0) {
        document.getElementById('winner-count').textContent = '0 winners';
        window.currentWinners = [];
        // Show helpful empty state with watchlist from scan log
        var emptyHtml = '<div style="text-align:center;padding:30px 20px;color:var(--dim);font-size:14px;background:var(--card);border:1px solid var(--border);border-radius:12px;margin-bottom:12px">';
        emptyHtml += '<div style="font-size:40px;margin-bottom:12px">&#128056;</div>';
        emptyHtml += '<div style="font-size:18px;color:#fff;margin-bottom:8px">No Buy Signals Right Now</div>';
        emptyHtml += '<div>None of the monitored meme coins are scoring above 70/100. The scanner is being selective &mdash; when volume explodes and momentum aligns, signals will appear instantly.';
        if (data.btc_regime === 'bear') {
          emptyHtml += '<br><br><span style="color:#fca5a5;font-weight:600">&#128308; BTC is in a bear regime, which reduces meme coin scores and suppresses signals.</span>';
        }
        emptyHtml += '<br><br>Scans every 15 minutes, 24/7. See the <strong>watchlist</strong> below for the closest candidates.</div>';
        emptyHtml += '</div>';
        emptyHtml += '<div id="watchlist-container"><div class="loading">Loading watchlist...</div></div>';
        document.getElementById('winners-list').innerHTML = emptyHtml;
        document.getElementById('auto-verify-summary').innerHTML = '';
        loadWatchlist();
        return;
      }

      // Compute BUY NOW rank for each winner and sort
      var ranked = [];
      for (var ri = 0; ri < data.winners.length; ri++) {
        var rw = data.winners[ri];
        rw._buyNow = computeBuyNowRank(rw);
        ranked.push(rw);
      }
      ranked.sort(function (a, b) { return b._buyNow.rank - a._buyNow.rank; });
      window.currentWinners = ranked;

      document.getElementById('winner-count').textContent = data.count + ' winners';
      var html = '';
      var defaultPortfolio = 10000;
      for (var i = 0; i < ranked.length; i++) {
        var w = ranked[i];
        var f = w.factors_json || {};
        var bn = w._buyNow;

        // FIXED: Define variables BEFORE using them
        var entryPrice = parseFloat(w.price_at_signal || 0);
        var targetPct = parseFloat(w.target_pct || 0);
        var riskPct = parseFloat(w.risk_pct || 0);
        var takeProfitPrice = entryPrice * (1 + targetPct / 100);
        var stopLossPrice = entryPrice * (1 - riskPct / 100);
        var priceDecimals = entryPrice >= 1 ? 4 : entryPrice >= 0.01 ? 6 : entryPrice >= 0.0001 ? 8 : 10;

        var scoreColor = w.score >= 85 ? 'accent' : w.score >= 75 ? 'gold' : 'cyan';
        var pair = (w.pair || '').replace('_USDT', '/USDT');

        // R:R ratio (now using correctly defined variables)
        var rrRatio = riskPct > 0 ? (targetPct / riskPct).toFixed(1) : '0';
        var rrBadge = '<span style="background:rgba(245,158,11,0.15);color:#f59e0b;padding:1px 6px;border-radius:4px;font-size:10px;font-weight:600;border:1px solid rgba(245,158,11,0.3);">R:R 1:' + rrRatio + '</span>';

        // Staleness
        var isStale = bn.ageMinutes >= 30;
        var cardClass = 'winner-card' + (isStale ? ' stale-card' : '');

        // Risk bar color
        var riskColor = w.tier === 'tier2' ? '239,68,68' : w.score >= 85 ? '245,158,11' : '234,179,8';

        html += '<div class="' + cardClass + '" id="winner-card-' + i + '" style="position:relative;overflow:hidden;" data-pair="' + (w.pair || '') + '" data-idx="' + i + '">';
        html += '<div style="position:absolute;top:0;left:0;right:0;height:3px;background:rgba(' + riskColor + ',0.5);"></div>';

        // Header with BUY NOW badge + age badge
        html += '<div class="winner-header">';
        html += '<div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">';
        html += '<span class="winner-pair">' + pair + '</span> ';
        html += verdictBadge(w.verdict) + ' ' + tierBadge(w.tier) + ' ' + rrBadge + ' ';
        html += getAgeBadge(bn.ageMinutes) + ' ';
        // BUY NOW badge (only if rank >= 70)
        if (bn.rank >= 70 && !isStale) {
          html += '<span class="buy-now-badge" onclick="openVerifyModal(' + i + ')">VERIFY &amp; BUY</span>';
        } else if (isStale) {
          html += '<span class="buy-now-badge" style="background:rgba(239,68,68,0.15);border-color:rgba(239,68,68,0.3);color:#fca5a5;font-size:10px" onclick="openVerifyModal(' + i + ')">STALE &mdash; VERIFY FIRST</span>';
        } else {
          html += '<span class="buy-now-badge" style="background:rgba(255,255,255,0.05);border-color:var(--border);color:var(--dim);font-size:10px" onclick="openVerifyModal(' + i + ')">VERIFY PRICE</span>';
        }
        html += '</div>';
        html += '<div style="text-align:right">';
        html += '<div class="winner-score ' + scoreColor + '">' + w.score + '<span style="font-size:12px;color:var(--dim)">/100</span></div>';
        html += '<div class="buy-now-rank">BUY NOW: <span class="rank-val ' + (bn.rank >= 70 ? 'green' : bn.rank >= 50 ? 'gold' : 'red') + '">' + bn.rank + '</span></div>';
        html += '</div>';
        html += '</div>';

        // Stale warning
        if (isStale) {
          html += '<div class="stale-overlay">STALE SIGNAL &mdash; Data is ' + bn.ageMinutes + ' minutes old. Verify current price before acting.</div>';
        }

        // Auto-verify verdict banner (populated on page load)
        html += '<div id="live-verdict-' + i + '" style="display:none"></div>';

        // Live price slot (populated by live mode)
        html += '<div id="live-price-' + i + '" style="display:none;margin:8px 0;padding:8px 12px;background:rgba(6,182,212,0.08);border:1px solid rgba(6,182,212,0.2);border-radius:6px;font-size:12px;"></div>';

        html += '<div class="winner-meta">';
        html += '<span>Entry: $' + entryPrice.toFixed(priceDecimals) + '</span>';
        html += '<span>24h: ' + formatPnl(w.chg_24h) + '</span>';
        html += '<span>Vol: $' + (parseFloat(w.vol_usd_24h) / 1000).toFixed(0) + 'K</span>';
        html += '<span style="background:rgba(34,197,94,0.15);padding:2px 8px;border-radius:4px;font-weight:600;">TP: $' + takeProfitPrice.toFixed(priceDecimals) + '</span>';
        html += '<span style="background:rgba(239,68,68,0.15);padding:2px 8px;border-radius:4px;font-weight:600;">SL: $' + stopLossPrice.toFixed(priceDecimals) + '</span>';
        html += '<span>' + (w.created_at || '').substring(11, 16) + ' UTC</span>';
        html += '</div>';

        // P&L preview
        var previewPositionSize = defaultPortfolio * 0.02;
        html += '<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin:12px 0;padding:10px;background:rgba(255,255,255,0.02);border-radius:8px;border:1px solid rgba(255,255,255,0.04);">';
        html += '<div style="text-align:center;"><div style="font-size:10px;color:var(--dim);text-transform:uppercase;letter-spacing:0.5px;">If TP Hit</div><div style="font-size:14px;font-weight:700;color:var(--green);">+$' + (previewPositionSize * targetPct / 100).toFixed(2) + '</div></div>';
        html += '<div style="text-align:center;border-left:1px solid rgba(255,255,255,0.06);border-right:1px solid rgba(255,255,255,0.06);"><div style="font-size:10px;color:var(--dim);text-transform:uppercase;letter-spacing:0.5px;">Position Size</div><div style="font-size:14px;font-weight:700;color:#fff;">$' + previewPositionSize.toFixed(2) + '</div></div>';
        html += '<div style="text-align:center;"><div style="font-size:10px;color:var(--dim);text-transform:uppercase;letter-spacing:0.5px;">If SL Hit</div><div style="font-size:14px;font-weight:700;color:var(--red);">-$' + (previewPositionSize * riskPct / 100).toFixed(2) + '</div></div>';
        html += '</div>';

        // Quality gates
        var qc = f['quality_check'] || {};
        if (qc.score !== undefined) {
          var qualityColor = qc.score >= 2 ? 'var(--green)' : qc.score >= 1 ? 'var(--gold)' : 'var(--red)';
          var qualityText = qc.score >= 2 ? 'Quality: PASS' : qc.score >= 1 ? 'Quality: WEAK' : 'Quality: FAIL';
          html += '<div style="margin:10px 0;padding:8px 12px;background:rgba(255,255,255,0.03);border-radius:6px;border-left:3px solid ' + qualityColor + ';">';
          html += '<div style="font-size:11px;color:' + qualityColor + ';font-weight:600;">' + qualityText + ' (' + qc.score + '/3 gates)</div>';
          if (qc.issues && qc.issues.length > 0) {
            html += '<div style="font-size:10px;color:var(--dim);margin-top:4px;">Issues: ' + qc.issues.join(', ') + '</div>';
          }
          html += '</div>';
        }

        // BTC Regime
        var btcRegime = f['btc_regime'] || {};
        if (btcRegime.regime) {
          var regimeColor = btcRegime.regime === 'bull' ? 'var(--green)' : btcRegime.regime === 'bear' ? 'var(--red)' : 'var(--dim)';
          var regimeEmoji = btcRegime.regime === 'bull' ? '\uD83D\uDC02' : btcRegime.regime === 'bear' ? '\uD83D\uDC3B' : '\u26A1';
          html += '<div style="margin:8px 0;font-size:10px;color:var(--dim);">BTC Regime: <span style="color:' + regimeColor + '">' + regimeEmoji + ' ' + btcRegime.regime.toUpperCase() + '</span>';
          if (btcRegime.adjustment !== 0) {
            var adjColor = btcRegime.adjustment > 0 ? 'var(--green)' : 'var(--red)';
            html += ' <span style="color:' + adjColor + '">(' + (btcRegime.adjustment > 0 ? '+' : '') + btcRegime.adjustment + ' pts)</span>';
          }
          html += '</div>';
        }

        // BUY NOW rank breakdown (collapsed)
        html += '<div style="margin:8px 0;font-size:10px;color:var(--dim);cursor:pointer" onclick="var d=this.nextElementSibling;d.style.display=d.style.display===\'none\'?\'block\':\'none\'">';
        html += 'BUY NOW rank breakdown: <strong style="color:' + (bn.rank >= 70 ? 'var(--green)' : bn.rank >= 50 ? 'var(--gold)' : 'var(--red)') + '">' + bn.rank + '/100</strong> (click to expand)';
        html += '</div>';
        html += '<div style="display:none;font-size:10px;color:var(--dim);padding:6px 10px;background:rgba(255,255,255,0.02);border-radius:6px;margin-bottom:8px;">';
        html += 'Base: ' + w.score + ' | Freshness: -' + bn.freshnessPenalty + ' | R:R: +' + bn.rrBonus + ' | Regime: ' + (bn.regimeAdj >= 0 ? '+' : '') + bn.regimeAdj + ' | Quality: +' + bn.qualityBonus;
        html += '</div>';

        html += '<div class="factors">';
        var factorInfo = {
          'explosive_volume': { name: 'Expl. Volume', tip: 'Recent volume vs average. 3x=pump starting. 10x+=massive surge.' },
          'parabolic_momentum': { name: 'Parabolic Mom.', tip: 'Price acceleration on 15m + 5m charts. Both positive = confirmed uptrend.' },
          'rsi_hype_zone': { name: 'RSI Hype Zone', tip: 'RSI 60-75 is the sweet spot. Rising RSI = full points. Above 85 = dangerous.' },
          'social_proxy': { name: 'Social Proxy', tip: 'Price change x volume ratio = proxy for social buzz.' },
          'volume_concentration': { name: 'Vol. Conc.', tip: 'How much of recent volume is in the last 3 candles.' },
          'breakout_4h': { name: 'Breakout 4h', tip: 'Price breaking above its 4-hour high.' },
          'low_cap_bonus': { name: 'Low Cap', tip: 'Smaller coins move bigger on less capital.' }
        };
        for (var key in factorInfo) {
          if (f[key] && f[key].score !== undefined) {
            var fi = factorInfo[key];
            var displayScore = f[key].score;
            var displayMax = f[key].max || 1;
            if (key === 'trend_confirm' || key === 'momentum_gate' || key === 'volume_gate') {
              var passed = f[key].passed || f[key].aligned;
              displayScore = passed ? displayMax : 0;
            }
            html += '<div class="factor"><div class="factor-name">' + fi.name + ' (' + displayScore + '/' + displayMax + ') <i class="info-tip">i<span class="tip-text">' + fi.tip + '</span></i></div>' + factorBar(displayScore, displayMax) + '</div>';
          }
        }
        // Quick actions footer with verify button
        html += '<div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.04);display:flex;gap:8px;flex-wrap:wrap;align-items:center;">';
        html += '<span class="buy-now-badge" onclick="openVerifyModal(' + i + ')" style="font-size:11px;">Verify Live Price</span>';
        var baseSym = pair.replace('/USDT', '');
        var baseSymLower = baseSym.toLowerCase();
        // Kraken trade link ‚Äî primary for Canadian traders
        html += '<a href="https://www.kraken.com/prices/' + baseSymLower + '" target="_blank" style="font-size:11px;padding:4px 10px;background:rgba(114,66,200,0.2);color:#9b7cdb;border:1px solid rgba(114,66,200,0.4);border-radius:4px;text-decoration:none;font-weight:700;transition:all 0.15s;" onmouseover="this.style.background=\'rgba(114,66,200,0.35)\'" onmouseout="this.style.background=\'rgba(114,66,200,0.2)\'">&#127464;&#127462; Kraken</a>';
        html += '<a href="https://www.kucoin.com/trade/' + baseSym + '-USDT" target="_blank" style="font-size:11px;padding:4px 10px;background:rgba(35,185,140,0.15);color:#23b98c;border:1px solid rgba(35,185,140,0.3);border-radius:4px;text-decoration:none;transition:all 0.15s;" onmouseover="this.style.background=\'rgba(35,185,140,0.25)\'" onmouseout="this.style.background=\'rgba(35,185,140,0.15)\'">KuCoin</a>';
        html += '<a href="https://www.gate.io/trade/' + baseSym + '_USDT" target="_blank" style="font-size:11px;padding:4px 10px;background:rgba(44,125,255,0.15);color:#2c7dff;border:1px solid rgba(44,125,255,0.3);border-radius:4px;text-decoration:none;transition:all 0.15s;" onmouseover="this.style.background=\'rgba(44,125,255,0.25)\'" onmouseout="this.style.background=\'rgba(44,125,255,0.15)\'">Gate.io</a>';
        html += '<a href="https://www.coingecko.com/en/coins/' + baseSymLower + '" target="_blank" style="font-size:11px;padding:4px 10px;background:rgba(255,255,255,0.05);color:var(--dim);border:1px solid var(--border);border-radius:4px;text-decoration:none;">CoinGecko</a>';
        html += '</div>';

        html += '</div></div>';
      }
      document.getElementById('winners-list').innerHTML = html;

      // Auto-verify all winners against live prices on render
      if (ranked.length > 0) {
        autoVerifyWinners();
      }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  AUTO-VERIFY: batch check all winners against live prices on page load
    //  Marks each card as VALID / CAUTION / INVALIDATED and shows summary
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    var _autoVerifyRunning = false;
    function autoVerifyWinners() {
      if (_autoVerifyRunning) return;
      _autoVerifyRunning = true;

      var winners = window.currentWinners;
      if (!winners || winners.length === 0) {
        _autoVerifyRunning = false;
        return;
      }

      // Collect unique pairs for batch fetch
      var pairSet = {};
      for (var pi = 0; pi < winners.length; pi++) {
        pairSet[winners[pi].pair] = true;
      }
      var uniquePairs = [];
      for (var pk in pairSet) {
        if (pairSet.hasOwnProperty(pk)) uniquePairs.push(pk);
      }

      var summaryEl = document.getElementById('auto-verify-summary');
      summaryEl.innerHTML = '<div style="text-align:center;padding:8px;color:var(--dim);font-size:12px">Verifying live prices across 7 exchanges...</div>';

      // Batch price fetch
      var url = PRICE_CHECK_API + '?action=batch_price&pairs=' + encodeURIComponent(uniquePairs.join(','));
      var x = new XMLHttpRequest();
      x.open('GET', url);
      x.onload = function () {
        _autoVerifyRunning = false;
        try {
          var r = JSON.parse(x.responseText);
          if (!r.ok) {
            summaryEl.innerHTML = '';
            return;
          }
          // Build price map
          var priceMap = {};
          for (var pi2 = 0; pi2 < r.prices.length; pi2++) {
            var pd = r.prices[pi2];
            if (pd.price) priceMap[pd.pair] = pd;
          }
          applyAutoVerifyResults(priceMap);
        } catch (e) {
          summaryEl.innerHTML = '';
        }
      };
      x.onerror = function () {
        _autoVerifyRunning = false;
        summaryEl.innerHTML = '';
      };
      x.send();
    }

    function applyAutoVerifyResults(priceMap) {
      lastPriceMap = priceMap; // cache for re-render on Kraken toggle
      var winners = window.currentWinners;
      var validCount = 0;
      var cautionCount = 0;
      var invalidCount = 0;
      var noPriceCount = 0;
      // Kraken-specific counters
      var krakenValid = 0;
      var krakenCaution = 0;
      var krakenInvalid = 0;

      for (var i = 0; i < winners.length; i++) {
        var w = winners[i];
        var card = document.getElementById('winner-card-' + i);
        var verdictSlot = document.getElementById('live-verdict-' + i);
        if (!card || !verdictSlot) continue;

        var pd = priceMap[w.pair];
        if (!pd || !pd.price) {
          noPriceCount++;
          // If no price data, assume not on Kraken
          card.className = card.className.replace(/ card-not-kraken/g, '');
          card.className += ' card-not-kraken';
          continue;
        }

        var isKraken = (pd.source === 'kraken');
        var entryPrice = parseFloat(w.price_at_signal || 0);
        var targetPct = parseFloat(w.target_pct || 0);
        var riskPct = parseFloat(w.risk_pct || 0);
        var currentPrice = parseFloat(pd.price);
        if (entryPrice <= 0) continue;

        var changePct = ((currentPrice - entryPrice) / entryPrice) * 100;
        var remainingUp = targetPct - changePct;
        var priceDecimals = entryPrice >= 1 ? 4 : entryPrice >= 0.01 ? 6 : entryPrice >= 0.0001 ? 8 : 10;

        // Determine verdict (same logic as price_check.php)
        var verdict = 'VALID';
        var verdictText = '';
        var verdictClass = 'v-valid';

        if (changePct > targetPct * 0.8) {
          verdict = 'INVALIDATED';
          verdictText = 'Price already moved +' + changePct.toFixed(1) + '% ‚Äî target nearly hit, upside gone';
          verdictClass = 'v-invalidated';
          invalidCount++;
          if (isKraken) krakenInvalid++;
        } else if (changePct < -riskPct) {
          verdict = 'INVALIDATED';
          verdictText = 'Price dropped ' + Math.abs(changePct).toFixed(1) + '% ‚Äî past stop loss';
          verdictClass = 'v-invalidated';
          invalidCount++;
          if (isKraken) krakenInvalid++;
        } else if (changePct > targetPct * 0.5) {
          verdict = 'CAUTION';
          verdictText = 'Price moved +' + changePct.toFixed(1) + '% ‚Äî reduced R:R, be cautious';
          verdictClass = 'v-caution';
          cautionCount++;
          if (isKraken) krakenCaution++;
        } else if (changePct < -(riskPct * 0.5)) {
          verdict = 'CAUTION';
          verdictText = 'Price dropped ' + Math.abs(changePct).toFixed(1) + '% ‚Äî approaching stop loss';
          verdictClass = 'v-caution';
          cautionCount++;
          if (isKraken) krakenCaution++;
        } else {
          verdictText = 'Signal still viable ‚Äî ' + remainingUp.toFixed(1) + '% upside remaining';
          validCount++;
          if (isKraken) krakenValid++;
        }

        // Apply card class
        card.className = card.className.replace(/ card-invalidated| card-caution| card-valid| card-not-kraken/g, '');
        if (verdict === 'INVALIDATED') {
          card.className += ' card-invalidated';
        } else if (verdict === 'CAUTION') {
          card.className += ' card-caution';
        } else {
          card.className += ' card-valid';
        }

        // Tag non-Kraken coins
        if (!isKraken) {
          card.className += ' card-not-kraken';
        }

        // Show inline verdict banner
        var changeColor = changePct >= 0 ? 'var(--green)' : 'var(--red)';
        var bannerHtml = '<div class="live-verdict-banner ' + verdictClass + '">';
        if (verdict === 'INVALIDATED') {
          bannerHtml += '<span style="font-size:14px">&#10060;</span> ';
        } else if (verdict === 'CAUTION') {
          bannerHtml += '<span style="font-size:14px">&#9888;&#65039;</span> ';
        } else {
          bannerHtml += '<span style="font-size:14px">&#9989;</span> ';
        }
        bannerHtml += '<span>' + verdict + ': ' + verdictText + '</span>';
        var sourceLabel = pd.source;
        if (isKraken) sourceLabel = 'Kraken &#127464;&#127462;';
        bannerHtml += '<span class="v-price">Now: $' + currentPrice.toFixed(priceDecimals) + ' (' + (changePct >= 0 ? '+' : '') + changePct.toFixed(2) + '%) via ' + sourceLabel + '</span>';
        bannerHtml += '</div>';
        verdictSlot.innerHTML = bannerHtml;
        verdictSlot.style.display = 'block';
      }

      // Render summary banner
      var summaryEl = document.getElementById('auto-verify-summary');
      var totalChecked = validCount + cautionCount + invalidCount;
      var krakenViable = krakenValid + krakenCaution;
      var totalViable = validCount + cautionCount;

      if (totalChecked === 0) {
        summaryEl.innerHTML = '';
        return;
      }

      // Decide which banner to show based on Kraken mode
      if (krakenOnlyMode && krakenViable === 0 && totalViable > 0) {
        // There ARE viable signals but NONE on Kraken
        var bannerHtml = '<div class="no-viable-banner" style="border-color:rgba(114,66,200,0.4);background:rgba(114,66,200,0.08)">' +
          '<h3 style="color:#9b7cdb">&#127464;&#127462; No Kraken-Eligible Signals Right Now</h3>' +
          '<p>' + totalViable + ' viable signal' + (totalViable > 1 ? 's' : '') + ' found on other exchanges, but none are tradeable on <strong>Kraken</strong> (Canadian-eligible).<br>' +
          '<span style="color:#aaa;font-size:12px">Turn off "&#127464;&#127462; Kraken Only" above to see all ' + totalViable + ' viable signal' + (totalViable > 1 ? 's' : '') + '.</span></p>' +
          '</div>';
        summaryEl.innerHTML = bannerHtml;
      } else if (validCount === 0 && cautionCount === 0) {
        // ALL invalidated
        var hiddenNote = hideInvalidated ?
          'Invalidated signals are hidden. Toggle "Hide Invalidated" above to show them.' :
          'Invalidated signals are shown crossed out below for transparency.';
        summaryEl.innerHTML = '<div class="no-viable-banner">' +
          '<h3>&#10060; No Viable Signals Right Now</h3>' +
          '<p>All ' + invalidCount + ' signal' + (invalidCount > 1 ? 's' : '') + ' have been invalidated ‚Äî prices moved past their targets or stop losses since they were generated. ' +
          'The scanner checks every 15 minutes. Fresh signals will appear when new setups form.<br>' +
          '<span style="color:#888;font-size:11px">' + hiddenNote + '</span></p>' +
          '</div>';
      } else {
        // Build summary parts ‚Äî total counts
        var summaryParts = [];
        if (validCount > 0) summaryParts.push('<span style="color:#86efac;font-weight:700">' + validCount + ' valid</span>');
        if (cautionCount > 0) summaryParts.push('<span style="color:#fcd34d;font-weight:700">' + cautionCount + ' caution</span>');
        if (invalidCount > 0) summaryParts.push('<span style="color:#fca5a5;font-weight:700">' + invalidCount + ' invalidated</span>');

        // Build Kraken breakdown line
        var krakenLine = '';
        if (krakenOnlyMode) {
          var krakenParts = [];
          if (krakenValid > 0) krakenParts.push(krakenValid + ' valid');
          if (krakenCaution > 0) krakenParts.push(krakenCaution + ' caution');
          if (krakenViable > 0) {
            krakenLine = '<br><span style="color:#9b7cdb;font-weight:700;font-size:13px">&#127464;&#127462; ' + krakenViable + ' on Kraken</span>' +
              '<span style="color:#aaa;font-size:11px"> (' + krakenParts.join(', ') + ')</span>';
          } else {
            krakenLine = '<br><span style="color:#9b7cdb;font-size:12px">&#127464;&#127462; 0 on Kraken</span>' +
              '<span style="color:#888;font-size:11px"> ‚Äî turn off filter to see ' + totalViable + ' on other exchanges</span>';
          }
        }

        // Show the EFFECTIVE visible count as the big number
        var displayCount = krakenOnlyMode ? krakenViable : totalViable;
        var displayLabel = krakenOnlyMode ? '&#127464;&#127462; VIABLE' : 'VIABLE';

        summaryEl.innerHTML = '<div class="some-viable-banner">' +
          '<span class="viable-count">' + displayCount + ' ' + displayLabel + '</span>' +
          '<span style="color:#ccc">Live-checked against 8 exchanges: ' + summaryParts.join(' &bull; ') + krakenLine + '</span>' +
          '</div>';
      }

      // Update hidden count for the toggle label
      if (typeof updateHiddenCount === 'function') updateHiddenCount();
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  WATCHLIST: Show top candidates when no signals are above threshold
    //  Fetches scan_log and displays the closest-to-threshold coins
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function loadWatchlist() {
      var url = '/findcryptopairs/api/meme_scanner.php?action=scan_log&limit=20';
      var x = new XMLHttpRequest();
      x.open('GET', url);
      x.onload = function () {
        try {
          var r = JSON.parse(x.responseText);
          renderWatchlist(r);
        } catch (e) {
          var c = document.getElementById('watchlist-container');
          if (c) c.innerHTML = '';
        }
      };
      x.onerror = function () {
        var c = document.getElementById('watchlist-container');
        if (c) c.innerHTML = '';
      };
      x.send();
    }

    function renderWatchlist(data) {
      var container = document.getElementById('watchlist-container');
      if (!container || !data.ok) {
        if (container) container.innerHTML = '';
        return;
      }

      var items = data.log || [];
      if (items.length === 0) {
        container.innerHTML = '<div style="color:var(--dim);text-align:center;padding:12px">No scan data available yet.</div>';
        return;
      }

      // Sort by score descending, take top 8
      items.sort(function (a, b) { return (parseInt(b.score) || 0) - (parseInt(a.score) || 0); });
      items = items.slice(0, 8);

      var html = '<div style="margin-bottom:8px;font-size:13px;font-weight:700;color:var(--text);display:flex;align-items:center;gap:8px">';
      html += '<span style="font-size:16px">&#128065;</span> Watchlist &mdash; Top Candidates (not buy signals)';
      html += '</div>';

      html += '<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:8px">';
      for (var i = 0; i < items.length; i++) {
        var item = items[i];
        var score = parseInt(item.score) || 0;
        var pair = (item.pair || '').replace('_USDT', '/USDT');
        var chg = parseFloat(item.chg_24h || 0);
        var vol = parseFloat(item.vol_usd_24h || 0);
        var price = parseFloat(item.price || 0);
        var priceDecimals = price >= 1 ? 4 : price >= 0.01 ? 6 : price >= 0.0001 ? 8 : 10;

        var scoreColor = score >= 50 ? '#fcd34d' : score >= 30 ? '#94a3b8' : '#475569';
        var barWidth = Math.min(100, Math.max(3, score));
        var chgColor = chg >= 0 ? 'var(--green)' : 'var(--red)';

        html += '<div style="background:var(--card);border:1px solid var(--border);border-radius:8px;padding:10px 12px;opacity:0.7;transition:opacity 0.2s" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.7">';
        html += '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">';
        html += '<span style="font-weight:700;font-size:13px;color:#fff">' + pair + '</span>';
        html += '<span style="font-size:12px;color:' + scoreColor + ';font-weight:700">' + score + '<span style="color:var(--dim);font-weight:400">/100</span></span>';
        html += '</div>';

        // Score bar
        html += '<div style="height:3px;background:rgba(255,255,255,0.05);border-radius:2px;margin-bottom:6px">';
        html += '<div style="height:100%;width:' + barWidth + '%;background:' + scoreColor + ';border-radius:2px;transition:width 0.3s"></div>';
        html += '</div>';

        html += '<div style="display:flex;gap:8px;font-size:11px;color:var(--dim);flex-wrap:wrap">';
        html += '<span>$' + price.toFixed(priceDecimals) + '</span>';
        html += '<span style="color:' + chgColor + '">' + (chg >= 0 ? '+' : '') + chg.toFixed(1) + '%</span>';
        html += '<span>Vol: $' + (vol >= 1000000 ? (vol / 1000000).toFixed(1) + 'M' : (vol / 1000).toFixed(0) + 'K') + '</span>';
        if (score >= 50) {
          html += '<span style="color:#fcd34d;font-weight:600">Closest to threshold</span>';
        }
        html += '</div>';
        html += '</div>';
      }
      html += '</div>';

      html += '<div style="text-align:center;margin-top:8px;font-size:11px;color:#555">Coins need a score of 70+ across 7 technical indicators to generate a buy signal. These are the current leaders.</div>';

      container.innerHTML = html;
    }

    function updateBtcRegimeBar(regime, trendPct, lastScan) {
      var bar = document.getElementById('btc-regime-bar');
      if (!bar) return;

      if (!regime) {
        bar.style.display = 'none';
        return;
      }

      bar.style.display = 'flex';
      var icon = '';
      var label = '';
      var color = '';
      var bgColor = '';
      var borderColor = '';
      var detail = '';

      if (regime === 'bull') {
        icon = '&#128994;';
        label = 'BULL MARKET';
        color = '#86efac';
        bgColor = 'rgba(34,197,94,0.06)';
        borderColor = 'rgba(34,197,94,0.3)';
        detail = 'BTC trending up (' + (trendPct > 0 ? '+' : '') + (trendPct || 0).toFixed(1) + '% vs 24h SMA). Meme coins have better odds.';
      } else if (regime === 'bear') {
        icon = '&#128308;';
        label = 'BEAR MARKET';
        color = '#fca5a5';
        bgColor = 'rgba(239,68,68,0.06)';
        borderColor = 'rgba(239,68,68,0.3)';
        detail = 'BTC trending down (' + (trendPct || 0).toFixed(1) + '% vs 24h SMA). Meme signals carry extra risk. Scores adjusted.';
      } else {
        icon = '&#128992;';
        label = 'CHOPPY MARKET';
        color = '#fcd34d';
        bgColor = 'rgba(245,158,11,0.06)';
        borderColor = 'rgba(245,158,11,0.3)';
        detail = 'BTC in sideways range. Mixed conditions for meme plays.';
      }

      var scanAge = '';
      if (lastScan) {
        var scanDate = new Date(lastScan.replace(' ', 'T') + 'Z');
        var ageMin = Math.floor((Date.now() - scanDate.getTime()) / 60000);
        scanAge = '<span style="margin-left:auto;font-size:11px;color:var(--dim)">Last scan: ' + ageMin + 'm ago</span>';
      }

      bar.style.background = bgColor;
      bar.style.borderColor = borderColor;
      bar.innerHTML = '<span style="font-size:14px">' + icon + '</span>' +
        '<span style="background:' + bgColor + ';color:' + color + ';padding:2px 8px;border-radius:4px;font-weight:800;font-size:11px;border:1px solid ' + borderColor + ';letter-spacing:0.5px">' + label + '</span>' +
        '<span style="color:' + color + ';font-size:12px">' + detail + '</span>' +
        scanAge;
    }

    function renderStats(data) {
      if (!data.ok || !data.stats) return;
      var s = data.stats;
      document.getElementById('s-wr').innerHTML = s.overall_win_rate !== null ? '<span class="' + (s.overall_win_rate >= 60 ? 'green' : s.overall_win_rate >= 50 ? 'gold' : 'red') + '">' + s.overall_win_rate + '%</span>' : '--';
      document.getElementById('s-pnl').innerHTML = s.avg_pnl !== null ? formatPnl(s.avg_pnl) : '--';
      document.getElementById('s-total').textContent = s.total_signals || 0;
      document.getElementById('s-resolved').textContent = (s.resolved || 0) + ' resolved, ' + (s.pending || 0) + ' pending';
      document.getElementById('s-best').textContent = s.best_trade ? '+' + parseFloat(s.best_trade).toFixed(1) + '%' : '--';
      document.getElementById('s-worst').textContent = s.worst_trade ? 'Worst: ' + parseFloat(s.worst_trade).toFixed(1) + '%' : '';
      document.getElementById('s-pairs').textContent = s.unique_pairs || 0;
      document.getElementById('s-scans').textContent = (s.total_scans || 0) + ' scans';
      document.getElementById('s-last').textContent = s.last_scan ? s.last_scan.substring(5, 16) : '--';
      document.getElementById('s-first').textContent = s.first_scan ? 'Since ' + s.first_scan.substring(0, 10) : '';
    }

    function renderLeaderboard(data) {
      if (!data.ok) return;

      // By verdict tier
      var tiers = data.by_verdict || [];
      if (tiers.length === 0) {
        document.getElementById('tier-table').innerHTML = '<div class="loading">No resolved data yet. Check back after signals have been tracked for 2+ hours.</div>';
      } else {
        var html = '<table class="history-table"><tr><th>Tier</th><th>Signals</th><th>Wins</th><th>Losses</th><th>Win Rate</th><th>Avg P&L</th></tr>';
        for (var i = 0; i < tiers.length; i++) {
          var t = tiers[i];
          var wrClass = t.win_rate >= 60 ? 'green' : t.win_rate >= 50 ? 'gold' : 'red';
          html += '<tr><td>' + verdictBadge(t.verdict) + '</td><td>' + t.signals + '</td><td class="green">' + t.wins + '</td><td class="red">' + t.losses + '</td>';
          html += '<td class="' + wrClass + '">' + (t.win_rate !== null ? t.win_rate + '%' : '--') + '</td>';
          html += '<td>' + formatPnl(t.avg_pnl) + '</td></tr>';
        }
        html += '</table>';
        document.getElementById('tier-table').innerHTML = html;
      }

      // Tier 1 vs Tier 2 comparison
      var tc = data.by_tier || [];
      if (tc.length === 0) {
        document.getElementById('tier-comparison').innerHTML = '<div class="loading">No tier comparison data yet.</div>';
      } else {
        var html2 = '<table class="history-table"><tr><th>Tier</th><th>Signals</th><th>Wins</th><th>Losses</th><th>Win Rate</th><th>Avg P&L</th></tr>';
        for (var j = 0; j < tc.length; j++) {
          var r = tc[j];
          var wrC = r.win_rate >= 60 ? 'green' : r.win_rate >= 50 ? 'gold' : 'red';
          var tierLabel = r.tier === 'tier1' ? '<span class="badge-tier1">Established</span>' : '<span class="badge-tier2">Emerging</span>';
          html2 += '<tr><td>' + tierLabel + '</td><td>' + r.signals + '</td><td class="green">' + r.wins + '</td><td class="red">' + r.losses + '</td>';
          html2 += '<td class="' + wrC + '">' + (r.win_rate !== null ? r.win_rate + '%' : '--') + '</td>';
          html2 += '<td>' + formatPnl(r.avg_pnl) + '</td></tr>';
        }
        html2 += '</table>';
        document.getElementById('tier-comparison').innerHTML = html2;
      }
    }

    function renderHistory(data) {
      if (!data.ok || data.count === 0) {
        document.getElementById('history-list').innerHTML = '<div class="loading">No signal history yet.</div>';
        return;
      }
      var html = '<table class="history-table"><tr><th>Pair</th><th>Tier</th><th>Score</th><th>Entry</th><th>TP / SL</th><th>Resolve</th><th>P&L</th><th>Outcome</th><th>Time</th></tr>';
      for (var i = 0; i < Math.min(data.history.length, 50); i++) {
        var h = data.history[i];
        var pair = (h.pair || '').replace('_USDT', '/USDT');
        var outcomeClass = '';
        if (h.outcome === 'win' || h.outcome === 'partial_win') outcomeClass = 'outcome-win';
        else if (h.outcome === 'loss' || h.outcome === 'partial_loss') outcomeClass = 'outcome-loss';
        else outcomeClass = 'outcome-pending';

        // Calculate TP/SL prices for history
        var entryHist = parseFloat(h.price_at_signal || 0);
        var targetHist = parseFloat(h.target_pct || 5);
        var riskHist = parseFloat(h.risk_pct || 2);
        var histDecimals = entryHist >= 1 ? 4 : entryHist >= 0.01 ? 6 : entryHist >= 0.0001 ? 8 : 10;
        var tpHist = entryHist * (1 + targetHist / 100);
        var slHist = entryHist * (1 - riskHist / 100);

        html += '<tr>';
        html += '<td>' + pair + '</td>';
        html += '<td>' + tierBadge(h.tier) + '</td>';
        html += '<td>' + h.score + '</td>';
        html += '<td>$' + entryHist.toFixed(histDecimals) + '</td>';
        html += '<td style="font-size:10px;"><span style="color:var(--green);">$' + tpHist.toFixed(histDecimals) + '</span><br><span style="color:var(--red);">$' + slHist.toFixed(histDecimals) + '</span></td>';
        html += '<td>' + (h.price_at_resolve ? '$' + parseFloat(h.price_at_resolve).toFixed(histDecimals) : '--') + '</td>';
        html += '<td>' + (h.pnl_pct !== null ? formatPnl(h.pnl_pct) : '--') + '</td>';
        html += '<td class="' + outcomeClass + '">' + (h.outcome || 'pending') + '</td>';
        html += '<td>' + (h.created_at || '').substring(5, 16) + '</td>';
        html += '</tr>';
      }
      html += '</table>';
      document.getElementById('history-list').innerHTML = html;
    }

    // Scan Log
    function factorClass(score, max) {
      var pct = (score / max) * 100;
      if (pct >= 70) return 'f-high';
      if (pct >= 40) return 'f-mid';
      return 'f-low';
    }

    function renderScanLog(data) {
      if (!data.ok || data.count === 0) {
        document.getElementById('scan-log-list').innerHTML = '<div class="loading">No scan log data yet. Log is populated after the next scan runs.</div>';
        return;
      }

      var picker = document.getElementById('scan-picker');
      if (data.recent_scans && data.recent_scans.length > 0 && picker.options.length <= 1) {
        picker.innerHTML = '';
        for (var s = 0; s < data.recent_scans.length; s++) {
          var sc = data.recent_scans[s];
          var label = (sc.created_at || '').substring(0, 16) + ' UTC ‚Äî ' + sc.analyzed + ' analyzed, ' + sc.winners + ' winners';
          var opt = document.createElement('option');
          opt.value = sc.scan_id;
          opt.textContent = label;
          if (s === 0) opt.selected = true;
          picker.appendChild(opt);
        }
      }

      var log = data.log;
      var winnersInLog = 0;
      for (var m = 0; m < log.length; m++) { if (log[m].score >= 70) winnersInLog++; }
      document.getElementById('scan-meta').textContent = log.length + ' memes analyzed, ' + winnersInLog + ' passed threshold (70+)';

      var html = '<table class="scan-log-table">';
      html += '<tr><th>#</th><th>Pair</th><th>Kraken</th><th>Tier</th><th>Score</th><th>Decision</th>';
      html += '<th>Expl Vol<br>0-25</th><th>Mom<br>0-20</th><th>RSI<br>0-15</th><th>Social<br>0-15</th><th>Vol Conc<br>0-10</th><th>Break<br>0-10</th><th>Cap<br>0-5</th>';
      html += '<th>24h Chg</th><th>Volume</th></tr>';

      for (var i = 0; i < log.length; i++) {
        var r = log[i];
        var f = r.factors_json || {};
        var pair = (r.pair || '').replace('_USDT', '/USDT');
        var rowClass = r.score >= 70 ? ' class="is-winner"' : '';

        var vd = '';
        if (r.verdict === 'STRONG_BUY') vd = '<span class="badge badge-strong">Strong Buy</span>';
        else if (r.verdict === 'BUY') vd = '<span class="badge badge-buy">Buy</span>';
        else if (r.verdict === 'LEAN_BUY') vd = '<span class="badge badge-lean">Lean Buy</span>';
        else vd = '<span class="verdict-skip">Skip</span>';

        var scColor = r.score >= 85 ? 'accent' : r.score >= 75 ? 'gold' : r.score >= 70 ? 'cyan' : 'dim';

        var factors = [
          { key: 'explosive_volume', max: 25 },
          { key: 'parabolic_momentum', max: 20 },
          { key: 'rsi_hype_zone', max: 15 },
          { key: 'social_proxy', max: 15 },
          { key: 'volume_concentration', max: 10 },
          { key: 'breakout_4h', max: 10 },
          { key: 'low_cap_bonus', max: 5 }
        ];

        html += '<tr' + rowClass + '>';
        html += '<td style="color:var(--dim)">' + (i + 1) + '</td>';
        html += '<td style="font-weight:600;color:#fff">' + pair + '</td>';
        html += '<td style="text-align:center">' + (r.on_kraken == 1 ? '<span style="color:#9b7cdb;font-weight:700" title="Available on Kraken">&#127464;&#127462;</span>' : '<span style="color:#555" title="Not on Kraken">&mdash;</span>') + '</td>';
        html += '<td>' + tierBadge(r.tier) + '</td>';
        html += '<td><span class="' + scColor + '" style="font-weight:700">' + r.score + '</span></td>';
        html += '<td>' + vd + '</td>';

        for (var j = 0; j < factors.length; j++) {
          var fk = factors[j].key;
          var fm = factors[j].max;
          if (f[fk]) {
            var fs = f[fk].score;
            html += '<td><span class="factor-cell ' + factorClass(fs, fm) + '">' + fs + '/' + fm + '</span></td>';
          } else {
            html += '<td><span class="factor-cell f-low">0/' + fm + '</span></td>';
          }
        }

        html += '<td>' + formatPnl(r.chg_24h) + '</td>';
        html += '<td style="color:var(--dim)">$' + (parseFloat(r.vol_usd_24h || 0) / 1000).toFixed(0) + 'K</td>';
        html += '</tr>';
      }
      html += '</table>';
      document.getElementById('scan-log-list').innerHTML = html;
    }

    function loadScanLog(scanId) {
      var q = 'scan_log';
      if (scanId) q += '&scan_id=' + scanId;
      api(q, function (data) {
        if (scanId) {
          var picker = document.getElementById('scan-picker');
          var tempPicker = picker.innerHTML;
          renderScanLog(data);
          picker.innerHTML = tempPicker;
          for (var k = 0; k < picker.options.length; k++) {
            if (picker.options[k].value === scanId) { picker.options[k].selected = true; break; }
          }
        } else {
          renderScanLog(data);
        }
      });
    }

    // ‚îÄ‚îÄ Daily Picks ‚îÄ‚îÄ
    function renderDailyPicks(data) {
      if (!data.ok || data.total_picks === 0) {
        document.getElementById('daily-picks-list').innerHTML = '<div class="loading">No picks for this date.</div>';
        document.getElementById('picks-summary').innerHTML = '';
        return;
      }

      // Populate date picker
      var picker = document.getElementById('picks-date');
      if (data.available_dates && data.available_dates.length > 0 && picker.options.length <= 1) {
        picker.innerHTML = '';
        for (var d = 0; d < data.available_dates.length; d++) {
          var dt = data.available_dates[d];
          var opt = document.createElement('option');
          opt.value = dt.pick_date;
          opt.textContent = dt.pick_date + ' (' + dt.cnt + ' picks)';
          if (dt.pick_date === data.date) opt.selected = true;
          picker.appendChild(opt);
        }
      }

      // Day summary
      var ds = data.day_summary || {};
      var sumHtml = '';
      sumHtml += '<span>Picks: <strong style="color:#fff">' + (ds.total_picks || 0) + '</strong></span>';
      if (ds.win_rate !== null) {
        var wrCls = ds.win_rate >= 60 ? 'green' : ds.win_rate >= 50 ? 'gold' : 'red';
        sumHtml += '<span>Win Rate: <strong class="' + wrCls + '">' + ds.win_rate + '%</strong></span>';
      }
      sumHtml += '<span>Wins: <strong class="green">' + (ds.wins || 0) + '</strong> / Losses: <strong class="red">' + (ds.losses || 0) + '</strong></span>';
      if (ds.pending > 0) sumHtml += '<span>Pending: ' + ds.pending + '</span>';
      if (ds.avg_pnl !== null) sumHtml += '<span>Avg P&L: ' + formatPnl(ds.avg_pnl) + '</span>';
      if (ds.best_trade) sumHtml += '<span>Best: <strong class="green">+' + parseFloat(ds.best_trade).toFixed(1) + '%</strong></span>';
      document.getElementById('picks-summary').innerHTML = sumHtml;
      document.getElementById('picks-date-label').textContent = data.date;

      // Picks table
      var html = '<table class="history-table"><tr><th>Time (UTC)</th><th>Pair</th><th>Tier</th><th>Score</th><th>Verdict</th><th>Entry</th><th>Target</th><th>P&L</th><th>Outcome</th></tr>';
      for (var i = 0; i < data.picks.length; i++) {
        var p = data.picks[i];
        var pair = (p.pair || '').replace('_USDT', '/USDT');
        var time = (p.created_at || '').substring(11, 16);
        var outClass = '';
        if (p.outcome === 'win' || p.outcome === 'partial_win') outClass = 'outcome-win';
        else if (p.outcome === 'loss' || p.outcome === 'partial_loss') outClass = 'outcome-loss';
        else outClass = 'outcome-pending';

        html += '<tr>';
        html += '<td style="color:var(--dim)">' + time + '</td>';
        html += '<td style="font-weight:600;color:#fff">' + pair + '</td>';
        html += '<td>' + tierBadge(p.tier) + '</td>';
        html += '<td>' + p.score + '</td>';
        html += '<td>' + verdictBadge(p.verdict) + '</td>';
        html += '<td>$' + parseFloat(p.price_at_signal || 0).toFixed(6) + '</td>';
        html += '<td>+' + p.target_pct + '% / -' + p.risk_pct + '%</td>';
        html += '<td>' + (p.pnl_pct !== null ? formatPnl(p.pnl_pct) : '--') + '</td>';
        html += '<td class="' + outClass + '">' + (p.outcome || 'pending') + '</td>';
        html += '</tr>';
      }
      html += '</table>';
      document.getElementById('daily-picks-list').innerHTML = html;
    }

    function loadDailyPicks(date) {
      var q = 'daily_picks';
      if (date) q += '&date=' + date;
      api(q, function (data) {
        if (date) {
          var picker = document.getElementById('picks-date');
          var saved = picker.innerHTML;
          renderDailyPicks(data);
          picker.innerHTML = saved;
          for (var k = 0; k < picker.options.length; k++) {
            if (picker.options[k].value === date) { picker.options[k].selected = true; break; }
          }
        } else {
          renderDailyPicks(data);
        }
      });
    }

    // ‚îÄ‚îÄ Performance Tracker ‚îÄ‚îÄ
    function renderPerformance(data) {
      if (!data.ok) {
        document.getElementById('perf-summary').innerHTML = '<div class="loading">No performance data yet.</div>';
        return;
      }

      var s = data.summary || {};
      var streaks = data.streaks || {};

      // Summary cards
      var cards = '';
      var wrCls = s.win_rate >= 60 ? 'green' : s.win_rate >= 50 ? 'gold' : 'red';
      cards += '<div class="perf-card"><div class="p-label">Win Rate</div><div class="p-val ' + (s.win_rate !== null ? wrCls : '') + '">' + (s.win_rate !== null ? s.win_rate + '%' : '--') + '</div><div class="p-sub">' + (s.resolved || 0) + ' resolved</div></div>';
      cards += '<div class="perf-card"><div class="p-label">Avg P&L</div><div class="p-val">' + (s.avg_pnl !== null ? formatPnl(s.avg_pnl) : '--') + '</div><div class="p-sub">per signal</div></div>';
      cards += '<div class="perf-card"><div class="p-label">Total P&L</div><div class="p-val">' + (s.total_pnl !== null ? formatPnl(s.total_pnl) : '--') + '</div><div class="p-sub">' + (s.total_signals || 0) + ' signals</div></div>';
      cards += '<div class="perf-card"><div class="p-label">Best Trade</div><div class="p-val green">' + (s.best_trade ? '+' + parseFloat(s.best_trade).toFixed(1) + '%' : '--') + '</div><div class="p-sub">Worst: ' + (s.worst_trade ? parseFloat(s.worst_trade).toFixed(1) + '%' : '--') + '</div></div>';
      cards += '<div class="perf-card"><div class="p-label">Active Days</div><div class="p-val cyan">' + (s.active_days || 0) + '</div><div class="p-sub">' + (s.unique_coins || 0) + ' coins</div></div>';
      cards += '<div class="perf-card"><div class="p-label">Win Streak</div><div class="p-val green">' + (streaks.max_win || 0) + '</div><div class="p-sub">Current: ' + (streaks.current || 0) + (streaks.current_type || '') + '</div></div>';
      cards += '<div class="perf-card"><div class="p-label">Loss Streak</div><div class="p-val red">' + (streaks.max_loss || 0) + '</div><div class="p-sub">max consecutive</div></div>';

      // Significance badge
      var sig = s.significance || {};
      var sigLabel = sig.confidence || 'insufficient_data';
      var sigColor = sigLabel === 'highly_significant' ? 'green' : sigLabel === 'significant' ? 'cyan' : sigLabel === 'trending_positive' ? 'gold' : 'dim';
      cards += '<div class="perf-card"><div class="p-label">Significance</div><div class="p-val ' + sigColor + '" style="font-size:12px">' + sigLabel.replace(/_/g, ' ') + '</div><div class="p-sub">' + (sig.sample_size || 0) + ' samples</div></div>';
      document.getElementById('perf-summary').innerHTML = cards;

      // Daily breakdown table
      var daily = data.daily || [];
      if (daily.length === 0) {
        document.getElementById('perf-daily').innerHTML = '<div class="loading">No daily data yet.</div>';
      } else {
        var html = '<table class="daily-table"><tr><th>Date</th><th>Signals</th><th>W</th><th>L</th><th>Win Rate</th><th>Avg P&L</th><th>Best</th><th>Worst</th><th>Coins</th></tr>';
        for (var i = 0; i < Math.min(daily.length, 30); i++) {
          var d = daily[i];
          var dWr = d.win_rate !== null ? d.win_rate : '--';
          var dWrCls = d.win_rate >= 60 ? 'green' : d.win_rate >= 50 ? 'gold' : d.win_rate !== null ? 'red' : '';
          html += '<tr>';
          html += '<td style="color:#fff">' + d.trade_date + '</td>';
          html += '<td>' + d.signals + '</td>';
          html += '<td class="green">' + d.wins + '</td>';
          html += '<td class="red">' + d.losses + '</td>';
          html += '<td class="' + dWrCls + '">' + (dWr !== '--' ? dWr + '%' : '--') + '</td>';
          html += '<td>' + (d.avg_pnl !== null ? formatPnl(d.avg_pnl) : '--') + '</td>';
          html += '<td class="green">' + (d.best_trade ? '+' + parseFloat(d.best_trade).toFixed(1) + '%' : '--') + '</td>';
          html += '<td class="red">' + (d.worst_trade ? parseFloat(d.worst_trade).toFixed(1) + '%' : '--') + '</td>';
          html += '<td>' + d.unique_coins + '</td>';
          html += '</tr>';
        }
        html += '</table>';
        document.getElementById('perf-daily').innerHTML = html;
      }

      // Top coins
      var top = data.top_coins || [];
      if (top.length === 0) {
        document.getElementById('perf-top-coins').innerHTML = '<div class="loading">No coin data yet.</div>';
      } else {
        var html2 = '<table class="daily-table"><tr><th>Coin</th><th>Tier</th><th>Signals</th><th>Win Rate</th><th>Avg P&L</th><th>Best</th><th>Days Active</th></tr>';
        for (var j = 0; j < top.length; j++) {
          var c = top[j];
          var cPair = (c.pair || '').replace('_USDT', '/USDT');
          var cWr = c.win_rate !== null ? c.win_rate + '%' : '--';
          var cWrCls = c.win_rate >= 60 ? 'green' : c.win_rate >= 50 ? 'gold' : 'red';
          html2 += '<tr>';
          html2 += '<td style="font-weight:600;color:#fff">' + cPair + '</td>';
          html2 += '<td>' + tierBadge(c.tier) + '</td>';
          html2 += '<td>' + c.signals + '</td>';
          html2 += '<td class="' + cWrCls + '">' + cWr + '</td>';
          html2 += '<td>' + (c.avg_pnl !== null ? formatPnl(c.avg_pnl) : '--') + '</td>';
          html2 += '<td class="green">' + (c.best_trade ? '+' + parseFloat(c.best_trade).toFixed(1) + '%' : '--') + '</td>';
          html2 += '<td>' + (c.days_active || 0) + '</td>';
          html2 += '</tr>';
        }
        html2 += '</table>';
        document.getElementById('perf-top-coins').innerHTML = html2;
      }
    }

    function loadPerf(period, btn) {
      // Update tab active state
      var tabs = document.querySelectorAll('#perf-tabs .tab-btn');
      for (var t = 0; t < tabs.length; t++) tabs[t].className = 'tab-btn';
      if (btn) btn.className = 'tab-btn active';

      api('performance&period=' + period, renderPerformance);
    }

    // ‚îÄ‚îÄ Data Freshness Tracker ‚îÄ‚îÄ
    var lastScanTime = null;
    function updateFreshness(statsData) {
      if (!statsData || !statsData.ok || !statsData.stats) return;
      var s = statsData.stats;
      if (s.last_scan) {
        lastScanTime = new Date(s.last_scan.replace(' ', 'T') + 'Z');
      }
      refreshFreshnessUI();
    }

    function refreshFreshnessUI() {
      var bar = document.getElementById('freshness-bar');
      var text = document.getElementById('freshness-text');
      var time = document.getElementById('freshness-time');
      if (!bar || !lastScanTime) return;

      var ageMs = Date.now() - lastScanTime.getTime();
      var ageMin = Math.floor(ageMs / 60000);
      var ageSec = Math.floor((ageMs % 60000) / 1000);

      bar.className = 'freshness-bar';
      if (ageMin < 5) {
        bar.classList.add('freshness-fresh');
        text.innerHTML = '<strong style="color:#22c55e">LIVE</strong> &mdash; Data is fresh (' + ageMin + 'm ' + ageSec + 's ago)';
      } else if (ageMin < 15) {
        bar.classList.add('freshness-aging');
        text.innerHTML = '<strong style="color:#f59e0b">AGING</strong> &mdash; Last scan ' + ageMin + ' minutes ago. Verify prices before acting.';
      } else {
        bar.classList.add('freshness-stale');
        text.innerHTML = '<strong style="color:#ef4444">STALE</strong> &mdash; Last scan ' + ageMin + ' minutes ago. Prices may have moved significantly.';
      }
      time.textContent = lastScanTime.toISOString().substring(11, 19) + ' UTC';
    }
    // Update freshness clock every 10 seconds
    setInterval(refreshFreshnessUI, 10000);

    // Wrap original renderStats to also update freshness
    var _origRenderStats = renderStats;
    renderStats = function (data) {
      _origRenderStats(data);
      updateFreshness(data);
    };

    // ‚îÄ‚îÄ Price Verification Modal ‚îÄ‚îÄ
    var PRICE_CHECK_API = '/findcryptopairs/api/price_check.php';

    function openVerifyModal(idx) {
      var w = window.currentWinners[idx];
      if (!w) return;

      var overlay = document.getElementById('verify-overlay');
      var title = document.getElementById('verify-title');
      var body = document.getElementById('verify-body');

      var pair = (w.pair || '').replace('_USDT', '/USDT');
      title.textContent = 'Verify: ' + pair;
      body.innerHTML = '<div class="loading">Fetching live price across 7 sources (Crypto.com, Binance, KuCoin, Gate.io, MEXC, CoinGecko, DexScreener)...</div>';
      overlay.classList.add('active');

      // Auto-fetch live price
      var url = PRICE_CHECK_API + '?action=verify&pair=' + encodeURIComponent(w.pair) +
        '&signal_price=' + w.price_at_signal +
        '&target_pct=' + w.target_pct +
        '&risk_pct=' + w.risk_pct;

      var x = new XMLHttpRequest();
      x.open('GET', url);
      x.onload = function () {
        try {
          var r = JSON.parse(x.responseText);
          renderVerifyResult(r, w, idx);
        } catch (e) {
          body.innerHTML = '<div style="color:var(--red);text-align:center;padding:20px">Failed to fetch price. Use manual input below.</div>' + manualInputHtml(w, idx);
        }
      };
      x.onerror = function () {
        body.innerHTML = '<div style="color:var(--red);text-align:center;padding:20px">Network error. Use manual input below.</div>' + manualInputHtml(w, idx);
      };
      x.send();
    }

    function renderVerifyResult(r, w, idx) {
      var body = document.getElementById('verify-body');
      if (!r.ok) {
        var sourcesTried = (r.sources_tried || []).join(', ') || 'unknown';
        body.innerHTML = '<div style="color:var(--red);text-align:center;padding:20px">' + (r.error || 'Price fetch failed') + '</div>' +
          '<div style="color:var(--dim);text-align:center;font-size:11px;margin-bottom:12px">Sources tried: ' + sourcesTried + '</div>' +
          manualInputHtml(w, idx);
        return;
      }

      var entryPrice = parseFloat(w.price_at_signal || 0);
      var priceDecimals = entryPrice >= 1 ? 4 : entryPrice >= 0.01 ? 6 : entryPrice >= 0.0001 ? 8 : 10;

      var verdictClass = 'verdict-green';
      if (r.verdict === 'INVALIDATED') verdictClass = 'verdict-red';
      else if (r.verdict === 'CAUTION') verdictClass = 'verdict-yellow';

      var html = '';
      html += '<div class="verify-verdict ' + verdictClass + '">';
      html += r.verdict.replace('_', ' ');
      html += '<div style="font-size:12px;font-weight:400;margin-top:4px">' + r.verdict_detail + '</div>';
      html += '</div>';

      html += '<div class="verify-row"><span class="vr-label">Signal Price</span><span class="vr-value">$' + entryPrice.toFixed(priceDecimals) + '</span></div>';
      html += '<div class="verify-row"><span class="vr-label">Current Price</span><span class="vr-value" style="color:' + (r.price_change_pct >= 0 ? 'var(--green)' : 'var(--red)') + '">$' + parseFloat(r.current_price).toFixed(priceDecimals) + '</span></div>';
      html += '<div class="verify-row"><span class="vr-label">Price Change</span><span class="vr-value" style="color:' + (r.price_change_pct >= 0 ? 'var(--green)' : 'var(--red)') + '">' + (r.price_change_pct >= 0 ? '+' : '') + r.price_change_pct.toFixed(2) + '%</span></div>';
      html += '<div class="verify-row"><span class="vr-label">Remaining Upside</span><span class="vr-value">' + r.remaining_upside_pct.toFixed(2) + '%</span></div>';
      html += '<div class="verify-row"><span class="vr-label">New R:R</span><span class="vr-value">1:' + r.new_rr_ratio + '</span></div>';
      html += '<div class="verify-row"><span class="vr-label">Target Price</span><span class="vr-value" style="color:var(--green)">$' + parseFloat(r.target_price).toFixed(priceDecimals) + '</span></div>';
      html += '<div class="verify-row"><span class="vr-label">Stop Price</span><span class="vr-value" style="color:var(--red)">$' + parseFloat(r.stop_price).toFixed(priceDecimals) + '</span></div>';
      var sourceDisplay = r.price_source + ' (' + r.latency_ms + 'ms)';
      if (r.price_source === 'kraken') {
        sourceDisplay = '<span style="color:#9b7cdb;font-weight:700">&#127464;&#127462; Kraken</span> <span style="color:var(--dim)">(' + r.latency_ms + 'ms) ‚Äî Canadian-eligible</span>';
      }
      html += '<div class="verify-row"><span class="vr-label">Source</span><span class="vr-value">' + sourceDisplay + '</span></div>';
      html += '<div class="verify-row"><span class="vr-label">Checked at</span><span class="vr-value" style="color:var(--dim);font-size:11px">' + r.timestamp + '</span></div>';

      // Disclaimer
      html += '<div style="margin-top:12px;font-size:10px;color:#555;text-align:center">This is a momentum pattern detector, not a buy recommendation. Not financial advice.</div>';

      // Manual input section
      html += manualInputHtml(w, idx);

      body.innerHTML = html;
    }

    function manualInputHtml(w, idx) {
      return '<div class="verify-manual">' +
        '<label>Or enter the price you see on your exchange:</label>' +
        '<input type="number" id="manual-price-input" step="0.000001" placeholder="e.g. 0.1823">' +
        '<button class="vm-btn" onclick="verifyManualPrice(' + idx + ')">Verify This Price</button>' +
        '</div>';
    }

    function verifyManualPrice(idx) {
      var w = window.currentWinners[idx];
      if (!w) return;

      var inputEl = document.getElementById('manual-price-input');
      var userPrice = parseFloat(inputEl.value);
      if (!userPrice || userPrice <= 0) {
        inputEl.style.borderColor = 'var(--red)';
        return;
      }
      inputEl.style.borderColor = 'var(--accent)';

      var body = document.getElementById('verify-body');
      body.innerHTML = '<div class="loading">Verifying with your price...</div>';

      var url = PRICE_CHECK_API + '?action=verify&pair=' + encodeURIComponent(w.pair) +
        '&signal_price=' + w.price_at_signal +
        '&target_pct=' + w.target_pct +
        '&risk_pct=' + w.risk_pct +
        '&user_price=' + userPrice;

      var x = new XMLHttpRequest();
      x.open('GET', url);
      x.onload = function () {
        try {
          var r = JSON.parse(x.responseText);
          renderVerifyResult(r, w, idx);
        } catch (e) {
          body.innerHTML = '<div style="color:var(--red)">Verification failed.</div>' + manualInputHtml(w, idx);
        }
      };
      x.onerror = function () {
        body.innerHTML = '<div style="color:var(--red)">Network error.</div>' + manualInputHtml(w, idx);
      };
      x.send();
    }

    function closeVerifyModal() {
      document.getElementById('verify-overlay').classList.remove('active');
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  AUDIT TRAIL MODAL ‚Äî View methodology and copy for AI analysis
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    var currentAuditData = null;
    var currentAuditText = '';
    
    function openAuditModal(symbol, type, triedFallback) {
      var overlay = document.getElementById('audit-overlay');
      var body = document.getElementById('audit-body');
      var title = document.getElementById('audit-title');
      
      title.textContent = 'üîç Audit Trail: ' + symbol;
      if (!triedFallback) {
        body.innerHTML = '<div class="loading">Loading audit data...</div>';
      }
      overlay.classList.add('active');
      
      // Fetch audit data
      var url = '/findcryptopairs/api/audit_recommendation.php?type=' + type + '&symbol=' + symbol + '&_=' + Date.now();
      var x = new XMLHttpRequest();
      x.open('GET', url);
      x.onload = function() {
        try {
          var r = JSON.parse(x.responseText);
          if (r.ok) {
            currentAuditData = r.audit_data;
            currentAuditText = r.formatted_for_ai || r.audit_text;
            renderAuditBody(r);
          } else {
            // If coin not found and we haven't tried fallback, try the other source
            var errorMsg = (r.error || '').toLowerCase();
            if (!triedFallback && (errorMsg.indexOf('not found') >= 0 || errorMsg.indexOf('no data') >= 0)) {
              var fallbackType = type === 'kraken' ? 'hot' : 'kraken';
              body.innerHTML = '<div class="loading">Trying ' + fallbackType + ' data...</div>';
              openAuditModal(symbol, fallbackType, true);
              return;
            }
            // Both failed or other error
            body.innerHTML = '<div style="color:#ef4444;padding:20px;">' + 
              '<strong>Audit Unavailable</strong><br><br>' + 
              (r.error || 'Unknown error') + '<br><br>' +
              '<span style="color:#888;font-size:11px;">This coin may not be in the current rankings or hot trending lists. The scanner tracks 43 Kraken-listed meme coins plus top CMC trending coins.</span>' +
              '</div>';
          }
        } catch (e) {
          // Show raw response for debugging
          var preview = x.responseText.substring(0, 200).replace(/</g, '&lt;');
          body.innerHTML = '<div style="color:#ef4444;padding:20px;">' + 
            '<strong>Error parsing response</strong><br><br>' +
            '<span style="color:#888;font-size:11px;">Raw response preview:</span><br>' +
            '<pre style="background:rgba(0,0,0,0.3);padding:8px;margin-top:8px;font-size:10px;color:#888;overflow:auto;">' + preview + '...</pre>' +
            '</div>';
        }
      };
      x.onerror = function() {
        body.innerHTML = '<div style="color:#ef4444;padding:20px;">Network error</div>';
      };
      x.send();
    }
    
    function renderAuditBody(data) {
      var body = document.getElementById('audit-body');
      var html = '';
      
      // Summary section
      html += '<div style="background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);border-radius:8px;padding:16px;margin-bottom:16px;">';
      html += '<div style="font-size:13px;font-weight:600;color:#fff;margin-bottom:12px;">üìä Summary</div>';
      html += '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px;font-size:12px;">';
      html += '<div><span style="color:var(--dim);">Coin:</span> <strong style="color:#fff;">' + data.symbol + '</strong></div>';
      html += '<div><span style="color:var(--dim);">Type:</span> <strong style="color:#fff;">' + data.type + '</strong></div>';
      if (data.audit_data.rating_10 || data.audit_data.rating) {
        html += '<div><span style="color:var(--dim);">Rating:</span> <strong style="color:#22c55e;">' + (data.audit_data.rating_10 || data.audit_data.rating) + '/10</strong></div>';
      }
      if (data.audit_data.confidence) {
        html += '<div><span style="color:var(--dim);">Confidence:</span> <strong style="color:#22c55e;">' + data.audit_data.confidence + '%</strong></div>';
      }
      html += '</div></div>';
      
      // Scoring breakdown
      if (data.audit_data.scores) {
        html += '<div style="background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);border-radius:8px;padding:16px;margin-bottom:16px;">';
        html += '<div style="font-size:13px;font-weight:600;color:#fff;margin-bottom:12px;">üéØ Scoring Breakdown</div>';
        html += '<div style="font-size:12px;line-height:1.8;">';
        var scores = data.audit_data.scores;
        html += _auditScoreRow('Momentum (35%)', scores.momentum, 35, '24h price change sweet spot');
        html += _auditScoreRow('Volume (25%)', scores.volume, 25, '24h USD volume');
        html += _auditScoreRow('Social Buzz (15%)', scores.trending, 15, 'CoinGecko trending bonus');
        html += _auditScoreRow('Entry Position (15%)', scores.entry_position, 15, 'Position in 24h range');
        html += _auditScoreRow('Spread (10%)', scores.spread, 10, 'Bid/ask tightness');
        html += '</div></div>';
      }
      
      // Technical analysis
      if (data.audit_data.technical) {
        html += '<div style="background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);border-radius:8px;padding:16px;margin-bottom:16px;">';
        html += '<div style="font-size:13px;font-weight:600;color:#fff;margin-bottom:12px;">üìà Technical Analysis</div>';
        html += '<div style="font-size:12px;line-height:1.8;">';
        var t = data.audit_data.technical;
        if (t.rsi) html += '<div><span style="color:var(--dim);">RSI:</span> <strong style="color:#fff;">' + t.rsi.toFixed(1) + '</strong> (50-75 sweet spot)</div>';
        if (t.volume_ratio) html += '<div><span style="color:var(--dim);">Volume Ratio:</span> <strong style="color:#fff;">' + t.volume_ratio.toFixed(1) + 'x</strong> avg</div>';
        if (t.ema_12) html += '<div><span style="color:var(--dim);">EMA-12:</span> <strong style="color:#fff;">$' + t.ema_12.toFixed(6) + '</strong></div>';
        if (t.ema_26) html += '<div><span style="color:var(--dim);">EMA-26:</span> <strong style="color:#fff;">$' + t.ema_26.toFixed(6) + '</strong></div>';
        if (t.momentum_5m !== undefined) html += '<div><span style="color:var(--dim);">Momentum 5m:</span> <strong style="color:#fff;">' + t.momentum_5m.toFixed(2) + '%</strong></div>';
        if (t.momentum_acceleration !== undefined) html += '<div><span style="color:var(--dim);">Acceleration:</span> <strong style="color:#fff;">' + (t.momentum_acceleration ? '‚úì Yes' : '‚úó No') + '</strong></div>';
        if (t.factors && t.factors.length > 0) {
          html += '<div style="margin-top:8px;"><span style="color:var(--dim);">Active Factors:</span></div>';
          html += '<div style="display:flex;flex-wrap:wrap;gap:4px;margin-top:4px;">';
          for (var i = 0; i < t.factors.length; i++) {
            html += '<span style="font-size:10px;padding:2px 6px;background:rgba(34,197,94,0.15);color:#22c55e;border-radius:3px;">' + t.factors[i].replace(/_/g, ' ') + '</span>';
          }
          html += '</div>';
        }
        html += '</div></div>';
      }
      
      // Warnings
      var warnings = [];
      if (data.audit_data.chasing_warning) warnings.push({type: 'error', text: 'Chasing Penalty: -' + data.audit_data.chasing_penalty + ' pts (buying near daily high)'});
      if (data.audit_data.pump_dump_risk && data.audit_data.pump_dump_risk !== 'none') warnings.push({type: 'error', text: 'Pump & Dump Risk: ' + data.audit_data.pump_dump_risk});
      if ((data.audit_data.scores && data.audit_data.scores.entry_position <= 3)) warnings.push({type: 'warning', text: 'Poor Entry Position: Near 24h high'});
      
      if (warnings.length > 0) {
        html += '<div style="background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);border-radius:8px;padding:16px;margin-bottom:16px;">';
        html += '<div style="font-size:13px;font-weight:600;color:#ef4444;margin-bottom:8px;">‚ö†Ô∏è Warnings</div>';
        html += '<ul style="margin:0;padding-left:16px;font-size:12px;color:#fca5a5;line-height:1.8;">';
        for (var w = 0; w < warnings.length; w++) {
          html += '<li>' + warnings[w].text + '</li>';
        }
        html += '</ul></div>';
      }
      
      // Methodology
      html += '<div style="background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);border-radius:8px;padding:16px;margin-bottom:16px;">';
      html += '<div style="font-size:13px;font-weight:600;color:#fff;margin-bottom:8px;">üìñ Methodology Notes</div>';
      html += '<div style="font-size:11px;color:var(--dim);line-height:1.6;">';
      html += 'This recommendation is based on technical analysis of price action, volume, and momentum indicators. ';
      html += 'The algorithm does NOT consider fundamental analysis, social sentiment (beyond CoinGecko trending), or on-chain data. ';
      html += 'Past performance does not guarantee future results. Always do your own research.';
      html += '</div></div>';
      
      // Raw data toggle
      html += '<div style="margin-top:16px;">';
      html += '<button onclick="this.nextElementSibling.style.display=this.nextElementSibling.style.display===\'none\'?\'block\':\'none\'" style="font-size:11px;padding:6px 12px;background:rgba(255,255,255,0.05);border:1px solid var(--border);color:var(--dim);border-radius:4px;cursor:pointer;">Toggle Raw Data</button>';
      html += '<pre style="display:none;margin-top:8px;padding:12px;background:#0a0a1a;border-radius:4px;font-size:10px;color:#889;overflow-x:auto;">' + JSON.stringify(data.audit_data, null, 2) + '</pre>';
      html += '</div>';
      
      body.innerHTML = html;
    }
    
    function _auditScoreRow(name, score, max, desc) {
      var pct = max > 0 ? (score / max) : 0;
      var color = pct >= 0.7 ? '#22c55e' : pct >= 0.4 ? '#f59e0b' : '#ef4444';
      return '<div style="display:flex;justify-content:space-between;align-items:center;padding:4px 0;border-bottom:1px solid rgba(255,255,255,0.03);">' +
        '<span style="color:var(--dim);">' + name + '</span>' +
        '<span style="color:' + color + ';font-weight:600;">' + score + '/' + max + '</span>' +
        '</div>' +
        '<div style="font-size:10px;color:#555;margin-bottom:4px;">' + desc + '</div>';
    }
    
    function closeAuditModal() {
      document.getElementById('audit-overlay').classList.remove('active');
      currentAuditData = null;
      currentAuditText = '';
    }
    
    function copyAuditToClipboard() {
      if (!currentAuditText) return;
      
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(currentAuditText).then(function() {
          alert('‚úÖ Audit data copied! Paste into ChatGPT, Claude, or any AI for analysis.');
        });
      } else {
        // Fallback
        var textarea = document.createElement('textarea');
        textarea.value = currentAuditText;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('‚úÖ Audit data copied! Paste into ChatGPT, Claude, or any AI for analysis.');
      }
    }
    
    function copyAuditRaw() {
      if (!currentAuditData) return;
      var raw = JSON.stringify(currentAuditData, null, 2);
      
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(raw).then(function() {
          alert('‚úÖ Raw JSON data copied!');
        });
      } else {
        var textarea = document.createElement('textarea');
        textarea.value = raw;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('‚úÖ Raw JSON data copied!');
      }
    }

    // ‚îÄ‚îÄ Hide Invalidated toggle ‚Äî on by default ‚îÄ‚îÄ
    var hideInvalidated = true;
    var krakenOnlyMode = true;
    var lastPriceMap = null; // cached for re-render on toggle
    // Apply default states on load
    document.getElementById('winners-list').parentNode.classList.add('hide-invalidated');
    document.getElementById('winners-list').parentNode.classList.add('kraken-only-mode');

    function toggleHideInvalidated() {
      hideInvalidated = !hideInvalidated;
      var toggle = document.getElementById('hide-invalid-toggle');
      var label = document.getElementById('hide-invalid-label');
      var wrapper = document.getElementById('winners-list');

      if (hideInvalidated) {
        toggle.classList.add('active');
        label.classList.add('active');
        label.textContent = 'Hide Invalidated: ON';
        if (wrapper && wrapper.parentNode) wrapper.parentNode.classList.add('hide-invalidated');
      } else {
        toggle.classList.remove('active');
        label.classList.remove('active');
        label.textContent = 'Hide Invalidated: OFF';
        if (wrapper && wrapper.parentNode) wrapper.parentNode.classList.remove('hide-invalidated');
      }
      updateHiddenCount();
    }

    function updateHiddenCount() {
      var invalidCards = document.querySelectorAll('.winner-card.card-invalidated');
      var nonKrakenCards = document.querySelectorAll('.winner-card.card-not-kraken');
      var parts = [];
      if (invalidCards.length > 0 && hideInvalidated) {
        parts.push(invalidCards.length + ' invalidated');
      }
      if (nonKrakenCards.length > 0 && krakenOnlyMode) {
        parts.push(nonKrakenCards.length + ' non-Kraken');
      }
      var status = document.getElementById('live-status');
      if (parts.length > 0 && status) {
        status.textContent = parts.join(', ') + ' hidden';
      } else if (status) {
        status.textContent = '';
      }
    }

    function toggleKrakenOnly() {
      krakenOnlyMode = !krakenOnlyMode;
      var toggle = document.getElementById('kraken-only-toggle');
      var label = document.getElementById('kraken-only-label');
      var wrapper = document.getElementById('winners-list');

      if (krakenOnlyMode) {
        toggle.classList.add('active');
        label.style.color = '#9b7cdb';
        if (wrapper && wrapper.parentNode) wrapper.parentNode.classList.add('kraken-only-mode');
      } else {
        toggle.classList.remove('active');
        label.style.color = 'var(--dim)';
        if (wrapper && wrapper.parentNode) wrapper.parentNode.classList.remove('kraken-only-mode');
      }
      // Re-render summary banner with updated Kraken counts
      if (lastPriceMap) applyAutoVerifyResults(lastPriceMap);
      updateHiddenCount();
    }

    // ‚îÄ‚îÄ Live Mode ‚Äî polls live prices for active winners ‚îÄ‚îÄ
    var liveModeActive = false;
    var liveModeInterval = null;

    function toggleLiveMode() {
      liveModeActive = !liveModeActive;
      var toggle = document.getElementById('live-toggle');
      var label = document.getElementById('live-label');
      var status = document.getElementById('live-status');

      if (liveModeActive) {
        toggle.classList.add('active');
        label.innerHTML = '<span class="live-pulse"></span> Live Price Updates: ON';
        label.classList.add('active');
        status.textContent = 'Updating every 30s...';
        fetchLivePrices();
        liveModeInterval = setInterval(fetchLivePrices, 30000);
      } else {
        toggle.classList.remove('active');
        label.textContent = 'Live Price Updates: OFF';
        label.classList.remove('active');
        status.textContent = '';
        if (liveModeInterval) clearInterval(liveModeInterval);
        liveModeInterval = null;
        // Hide all live price slots
        for (var h = 0; h < window.currentWinners.length; h++) {
          var slot = document.getElementById('live-price-' + h);
          if (slot) slot.style.display = 'none';
        }
      }
    }

    function fetchLivePrices() {
      if (!window.currentWinners || window.currentWinners.length === 0) return;
      var pairs = [];
      for (var p = 0; p < Math.min(window.currentWinners.length, 10); p++) {
        pairs.push(window.currentWinners[p].pair);
      }

      var url = PRICE_CHECK_API + '?action=batch_price&pairs=' + pairs.join(',');
      var x = new XMLHttpRequest();
      x.open('GET', url);
      x.onload = function () {
        try {
          var r = JSON.parse(x.responseText);
          if (r.ok && r.prices) {
            var status = document.getElementById('live-status');
            status.textContent = 'Updated ' + new Date().toLocaleTimeString();
            for (var li = 0; li < r.prices.length; li++) {
              updateLivePriceSlot(li, r.prices[li]);
            }
          }
        } catch (e) { /* silent fail */ }
      };
      x.send();
    }

    function updateLivePriceSlot(idx, priceData) {
      var slot = document.getElementById('live-price-' + idx);
      if (!slot || !priceData.price) return;

      var w = window.currentWinners[idx];
      if (!w) return;

      var entry = parseFloat(w.price_at_signal || 0);
      var targetPct = parseFloat(w.target_pct || 0);
      var riskPct = parseFloat(w.risk_pct || 0);
      var current = parseFloat(priceData.price);
      var changePct = entry > 0 ? ((current - entry) / entry * 100) : 0;
      var priceDecimals = entry >= 1 ? 4 : entry >= 0.01 ? 6 : entry >= 0.0001 ? 8 : 10;
      var remainingUp = targetPct - changePct;

      var color = changePct >= 0 ? 'var(--green)' : 'var(--red)';
      var statusText = '';
      if (changePct > targetPct * 0.8) statusText = '<span style="color:var(--red);font-weight:700">TARGET NEARLY HIT</span>';
      else if (changePct < -riskPct) statusText = '<span style="color:var(--red);font-weight:700">STOP HIT</span>';
      else if (changePct > targetPct * 0.5) statusText = '<span style="color:var(--gold)">Approaching target</span>';
      else statusText = '<span style="color:var(--green)">Signal active</span>';

      slot.style.display = 'block';
      slot.innerHTML = '<div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:4px">' +
        '<span><strong style="color:var(--cyan)">LIVE:</strong> $' + current.toFixed(priceDecimals) + ' <span style="color:' + color + '">(' + (changePct >= 0 ? '+' : '') + changePct.toFixed(2) + '%)</span></span>' +
        '<span>' + statusText + '</span>' +
        '<span style="color:var(--dim)">Upside left: ' + remainingUp.toFixed(1) + '% | via ' + priceData.source + '</span>' +
        '</div>';
    }

    // Load all data
    api('stats', renderStats);
    api('winners', renderWinners);
    api('leaderboard', renderLeaderboard);
    api('history&limit=50', renderHistory);
    loadScanLog('');
    loadDailyPicks('');
    loadPerf('all', null);

    // Auto-refresh every 90 seconds (memes move fast)
    setInterval(function () {
      api('winners', renderWinners);
      api('stats', renderStats);
    }, 90000);

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  MARKET PULSE ‚Äî Real-time Kraken Meme Scanner
    //  Scans 35 meme coins on Kraken, cross-references CoinGecko trending,
    //  produces #1 Top Pick with TP/SL, shows all gainers in a grid.
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    var PULSE_API = '/findcryptopairs/api/meme_market_pulse.php';
    var pulseLiveMode = false;
    var pulseLiveInterval = null;

    function loadMarketPulse(force) {
      var pickEl = document.getElementById('pulse-top-pick');
      var moodEl = document.getElementById('pulse-mood-bar');
      if (!force) {
        pickEl.innerHTML = '<div class="loading">Scanning Kraken meme coins...</div>';
      }

      var url = PULSE_API + '?action=pulse' + (force ? '&force=1' : '') + '&_=' + Date.now();
      var x = new XMLHttpRequest();
      x.open('GET', url);
      x.onload = function () {
        try {
          var r = JSON.parse(x.responseText);
          if (!r.ok) {
            pickEl.innerHTML = '<div style="color:var(--red)">Error: ' + (r.error || 'Unknown') + '</div>';
            return;
          }
          renderPulseMood(r.mood);
          renderPulseTopPick(r.top_pick);
          renderPulseGainers(r.kraken_gainers, r.kraken_total);
          renderPulseTrending(r.trending, r.cg_gainers);
          var ts = document.getElementById('pulse-last-updated');
          if (ts) ts.textContent = 'Updated: ' + new Date().toLocaleTimeString() + (r.cached ? ' (cached ' + r.cache_age_s + 's)' : ' (live)');
        } catch (e) {
          pickEl.innerHTML = '<div style="color:var(--red)">Error parsing response</div>';
        }
      };
      x.onerror = function () {
        pickEl.innerHTML = '<div style="color:var(--red)">Network error ‚Äî check connection</div>';
      };
      x.send();
    }

    function renderPulseMood(mood) {
      var el = document.getElementById('pulse-mood-bar');
      if (!el || !mood) return;

      var moodConfig = {
        'euphoric': { icon: '&#128293;', color: '#22c55e', bg: 'rgba(34,197,94,0.08)', border: 'rgba(34,197,94,0.3)' },
        'bullish': { icon: '&#128994;', color: '#86efac', bg: 'rgba(34,197,94,0.06)', border: 'rgba(34,197,94,0.25)' },
        'mild_bull': { icon: '&#128154;', color: '#6ee7b7', bg: 'rgba(34,197,94,0.04)', border: 'rgba(34,197,94,0.2)' },
        'neutral': { icon: '&#128992;', color: '#fcd34d', bg: 'rgba(245,158,11,0.06)', border: 'rgba(245,158,11,0.25)' },
        'mild_bear': { icon: '&#128308;', color: '#fca5a5', bg: 'rgba(239,68,68,0.04)', border: 'rgba(239,68,68,0.2)' },
        'bearish': { icon: '&#128308;', color: '#ef4444', bg: 'rgba(239,68,68,0.06)', border: 'rgba(239,68,68,0.25)' },
        'panic': { icon: '&#128680;', color: '#ef4444', bg: 'rgba(239,68,68,0.1)', border: 'rgba(239,68,68,0.4)' }
      };
      var cfg = moodConfig[mood.mood] || moodConfig['neutral'];
      
      // Show correlation warning if applicable
      var corrWarning = '';
      var corrBanner = document.getElementById('correlation-warning');
      if (mood.correlation_warning) {
        corrWarning = ' <span style="background:rgba(245,158,11,0.15);color:#f59e0b;padding:1px 6px;border-radius:4px;font-size:10px;font-weight:600;border:1px solid rgba(245,158,11,0.3);margin-left:8px;">‚ö†Ô∏è HIGH CORRELATION</span>';
        if (corrBanner) corrBanner.style.display = 'flex';
      } else {
        if (corrBanner) corrBanner.style.display = 'none';
      }

      el.style.background = cfg.bg;
      el.style.borderColor = cfg.border;
      el.innerHTML = '<span style="font-size:16px">' + cfg.icon + '</span>' +
        '<span style="color:' + cfg.color + ';font-weight:700;font-size:13px">' + mood.label + '</span>' + corrWarning +
        '<span style="color:var(--dim);font-size:12px">' +
        '<span style="color:var(--green)">' + mood.gainers + ' gaining</span> / ' +
        '<span style="color:var(--red)">' + mood.losers + ' dropping</span> / ' +
        mood.flat + ' flat' +
        '</span>' +
        '<span style="margin-left:auto;font-size:11px;color:var(--dim)">Avg: ' +
        '<span style="color:' + (mood.avg_chg >= 0 ? 'var(--green)' : 'var(--red)') + '">' + (mood.avg_chg >= 0 ? '+' : '') + mood.avg_chg + '%</span>' +
        ' | Vol: $' + formatLargeNum(mood.total_vol) + ' | ' + mood.coins_scanned + ' coins</span>';
    }

    function renderPulseTopPick(pick) {
      var el = document.getElementById('pulse-top-pick');
      if (!el) return;

      if (!pick || !pick.available) {
        el.innerHTML = '<div style="text-align:center;padding:20px;color:var(--dim)">' +
          '<div style="font-size:36px;margin-bottom:8px">&#128056;</div>' +
          '<div style="font-size:16px;color:#fff;margin-bottom:6px">No Strong Buy Right Now</div>' +
          '<div style="font-size:12px">' + (pick ? pick.reason : 'No Kraken meme data') + '. Check the gainers below for emerging setups.</div>' +
          '</div>';
        return;
      }

      var priceDecimals = pick.price >= 1 ? 4 : pick.price >= 0.01 ? 6 : pick.price >= 0.0001 ? 8 : 10;
      var tpDecimals = pick.tp_price >= 1 ? 4 : pick.tp_price >= 0.01 ? 6 : pick.tp_price >= 0.0001 ? 8 : 10;
      var slDecimals = pick.sl_price >= 1 ? 4 : pick.sl_price >= 0.01 ? 6 : pick.sl_price >= 0.0001 ? 8 : 10;

      var confColors = { 'STRONG': '#22c55e', 'BUY': '#a78bfa', 'LEAN': '#f59e0b', 'SKIP': '#888' };
      var confColor = confColors[pick.confidence] || '#888';
      var confBgs = { 'STRONG': 'rgba(34,197,94,0.1)', 'BUY': 'rgba(167,139,250,0.1)', 'LEAN': 'rgba(245,158,11,0.1)', 'SKIP': 'rgba(255,255,255,0.03)' };
      var confBg = confBgs[pick.confidence] || 'rgba(255,255,255,0.03)';

      var html = '<div style="position:relative">';

      // TOP PICK badge
      if (pick.confidence === 'STRONG' || pick.confidence === 'BUY') {
        html += '<div style="position:absolute;top:-8px;right:-8px;background:linear-gradient(135deg,#e879f9,#06b6d4);color:#fff;padding:5px 12px;border-radius:20px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;box-shadow:0 2px 8px rgba(232,121,249,0.4)">#1 TOP PICK</div>';
      }

      // Header
      html += '<div style="display:flex;align-items:center;gap:12px;margin-bottom:14px;flex-wrap:wrap">';
      html += '<div style="font-size:22px;font-weight:700;color:#fff">' + pick.symbol + '/USD</div>';
      html += '<span style="font-size:11px;padding:2px 8px;border-radius:4px;font-weight:700;background:' + confBg + ';color:' + confColor + ';border:1px solid ' + confColor + '40;letter-spacing:0.5px">' + pick.confidence + ' BUY</span>';
      html += '<span style="font-size:11px;padding:2px 8px;border-radius:4px;background:rgba(232,121,249,0.15);color:#e879f9;border:1px solid rgba(232,121,249,0.3);font-weight:700">Score: ' + pick.pulse_score + '/100</span>';
      if (pick.is_trending) {
        html += '<span style="font-size:11px;padding:2px 8px;border-radius:4px;background:rgba(6,182,212,0.15);color:#06b6d4;border:1px solid rgba(6,182,212,0.3);font-weight:700">TRENDING</span>';
      }
      html += '</div>';

      // Price grid
      html += '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:10px;margin-bottom:14px">';
      html += '<div style="background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;text-align:center">';
      html += '<div style="font-size:10px;color:var(--dim);text-transform:uppercase;letter-spacing:0.5px">Kraken Price</div>';
      html += '<div style="font-size:18px;font-weight:700;color:#fff">$' + pick.price.toFixed(priceDecimals) + '</div>';
      html += '<div style="font-size:11px;color:' + (pick.chg_24h >= 0 ? 'var(--green)' : 'var(--red)') + '">' + (pick.chg_24h >= 0 ? '+' : '') + pick.chg_24h + '% (24h)</div>';
      html += '</div>';
      html += '<div style="background:rgba(34,197,94,0.06);padding:10px;border-radius:8px;text-align:center;border:1px solid rgba(34,197,94,0.15)">';
      html += '<div style="font-size:10px;color:var(--dim);text-transform:uppercase;letter-spacing:0.5px">Take Profit</div>';
      html += '<div style="font-size:18px;font-weight:700;color:var(--green)">$' + pick.tp_price.toFixed(tpDecimals) + '</div>';
      html += '<div style="font-size:11px;color:var(--green)">+' + pick.tp_pct + '%</div>';
      html += '</div>';
      html += '<div style="background:rgba(239,68,68,0.06);padding:10px;border-radius:8px;text-align:center;border:1px solid rgba(239,68,68,0.15)">';
      html += '<div style="font-size:10px;color:var(--dim);text-transform:uppercase;letter-spacing:0.5px">Stop Loss</div>';
      html += '<div style="font-size:18px;font-weight:700;color:var(--red)">$' + pick.sl_price.toFixed(slDecimals) + '</div>';
      html += '<div style="font-size:11px;color:var(--red)">-' + pick.sl_pct + '%</div>';
      html += '</div>';
      html += '<div style="background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;text-align:center">';
      html += '<div style="font-size:10px;color:var(--dim);text-transform:uppercase;letter-spacing:0.5px">R:R Ratio</div>';
      html += '<div style="font-size:18px;font-weight:700;color:var(--cyan)">' + pick.rr_ratio + ':1</div>';
      html += '<div style="font-size:11px;color:var(--dim)">Risk/Reward</div>';
      html += '</div>';

      // Extra stats
      html += '<div style="background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;text-align:center">';
      html += '<div style="font-size:10px;color:var(--dim);text-transform:uppercase;letter-spacing:0.5px">Volume</div>';
      html += '<div style="font-size:18px;font-weight:700;color:#fff">$' + formatLargeNum(pick.vol_24h_usd) + '</div>';
      html += '<div style="font-size:11px;color:var(--dim)">' + (pick.trades_24h ? pick.trades_24h.toLocaleString() + ' trades' : '24h') + '</div>';
      html += '</div>';
      html += '<div style="background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;text-align:center">';
      html += '<div style="font-size:10px;color:var(--dim);text-transform:uppercase;letter-spacing:0.5px">Spread</div>';
      html += '<div style="font-size:18px;font-weight:700;color:#fff">' + pick.spread_pct + '%</div>';
      html += '<div style="font-size:11px;color:var(--dim)">Bid/Ask</div>';
      html += '</div>';
      html += '</div>';

      // Score breakdown
      if (pick.scores) {
        var sc = pick.scores;
        html += '<div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px">';
        var scoreItems = [
          { name: 'Momentum', val: sc.momentum, max: 35, color: sc.momentum >= 25 ? 'var(--green)' : sc.momentum >= 15 ? 'var(--gold)' : 'var(--red)' },
          { name: 'Volume', val: sc.volume, max: 25, color: sc.volume >= 18 ? 'var(--green)' : sc.volume >= 10 ? 'var(--gold)' : 'var(--red)' },
          { name: 'Trending', val: sc.trending, max: 15, color: sc.trending > 0 ? 'var(--cyan)' : 'var(--dim)' },
          { name: 'Entry Pos', val: sc.entry_position, max: 15, color: sc.entry_position >= 10 ? 'var(--green)' : sc.entry_position >= 5 ? 'var(--gold)' : 'var(--red)' },
          { name: 'Spread', val: sc.spread, max: 10, color: sc.spread >= 6 ? 'var(--green)' : 'var(--gold)' }
        ];
        for (var si = 0; si < scoreItems.length; si++) {
          var s = scoreItems[si];
          html += '<div style="flex:1;min-width:80px;background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:6px;text-align:center;font-size:11px">';
          html += '<div style="color:var(--dim);font-size:9px;text-transform:uppercase;letter-spacing:0.5px">' + s.name + '</div>';
          html += '<div style="font-weight:700;color:' + s.color + '">' + s.val + '/' + s.max + '</div>';
          html += '</div>';
        }
        html += '</div>';
      }

      // Reasons
      if (pick.reasons && pick.reasons.length > 0) {
        html += '<div style="background:rgba(255,255,255,0.03);padding:10px 12px;border-radius:8px;margin-bottom:14px;font-size:12px;line-height:1.7">';
        html += '<strong style="color:#fff;font-size:11px;text-transform:uppercase;letter-spacing:0.5px">Why this pick?</strong><br>';
        for (var ri = 0; ri < pick.reasons.length; ri++) {
          html += '<span style="color:var(--dim)">&bull; ' + pick.reasons[ri] + '</span><br>';
        }
        html += '</div>';
      }

      // Trade actions
      var baseSym = pick.symbol.toLowerCase();
      html += '<div style="display:flex;gap:8px;flex-wrap:wrap">';
      html += '<a href="https://pro.kraken.com/app/trade/' + baseSym + '-usd" target="_blank" style="flex:1;min-width:140px;text-align:center;padding:10px 16px;background:linear-gradient(135deg,rgba(114,66,200,0.25),rgba(114,66,200,0.15));color:#9b7cdb;border:1px solid rgba(114,66,200,0.4);border-radius:8px;text-decoration:none;font-weight:700;font-size:13px;transition:all 0.15s" onmouseover="this.style.background=\'rgba(114,66,200,0.35)\'" onmouseout="this.style.background=\'linear-gradient(135deg,rgba(114,66,200,0.25),rgba(114,66,200,0.15))\'">Trade on Kraken</a>';
      html += '<a href="https://www.coingecko.com/en/coins/' + (pick.coingecko_id || baseSym) + '" target="_blank" style="flex:1;min-width:100px;text-align:center;padding:10px 16px;background:rgba(255,255,255,0.05);color:var(--dim);border:1px solid var(--border);border-radius:8px;text-decoration:none;font-size:12px;transition:all 0.15s" onmouseover="this.style.borderColor=\'var(--accent)\'" onmouseout="this.style.borderColor=\'var(--border)\'">CoinGecko</a>';
      html += '</div>';
      html += '</div>';

      // Runner-up
      if (pick.runner_up) {
        var ru = pick.runner_up;
        var ruDec = ru.price >= 1 ? 4 : ru.price >= 0.01 ? 6 : 8;
        html += '<div style="margin-top:12px;padding:10px 14px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);border-radius:8px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:6px;font-size:12px">';
        html += '<span style="color:var(--dim)">Runner-up:</span>';
        html += '<span style="color:#fff;font-weight:700">' + ru.symbol + '/USD</span>';
        html += '<span style="color:var(--dim)">$' + ru.price.toFixed(ruDec) + '</span>';
        html += '<span style="color:' + (ru.chg_24h >= 0 ? 'var(--green)' : 'var(--red)') + '">' + (ru.chg_24h >= 0 ? '+' : '') + ru.chg_24h + '%</span>';
        html += '<span style="color:var(--accent);font-weight:700">Score: ' + ru.pulse_score + '</span>';
        html += '</div>';
      }

      el.innerHTML = html;
    }

    function renderPulseGainers(gainers, total) {
      var grid = document.getElementById('pulse-gainers-grid');
      var countEl = document.getElementById('pulse-gainer-count');
      if (!grid) return;

      if (countEl) countEl.textContent = '(' + total + ' coins on Kraken)';

      if (!gainers || gainers.length === 0) {
        grid.innerHTML = '<div style="color:var(--dim);font-size:12px;padding:8px">No Kraken meme data available</div>';
        return;
      }

      var html = '';
      for (var i = 0; i < gainers.length; i++) {
        var g = gainers[i];
        var chg = parseFloat(g.chg_24h);
        var chgColor = chg >= 5 ? 'var(--green)' : chg >= 0 ? '#6ee7b7' : chg >= -3 ? 'var(--gold)' : 'var(--red)';
        var borderColor = chg >= 5 ? 'rgba(34,197,94,0.3)' : chg >= 0 ? 'rgba(34,197,94,0.15)' : 'rgba(239,68,68,0.15)';
        var bgGlow = chg >= 10 ? 'rgba(34,197,94,0.06)' : chg >= 5 ? 'rgba(34,197,94,0.03)' : 'transparent';
        var prDec = g.price >= 1 ? 4 : g.price >= 0.01 ? 6 : g.price >= 0.0001 ? 8 : 10;

        html += '<div style="background:' + bgGlow + ';border:1px solid ' + borderColor + ';border-radius:8px;padding:10px 12px;transition:all 0.15s;cursor:default" onmouseover="this.style.transform=\'translateY(-1px)\';this.style.boxShadow=\'0 2px 8px rgba(0,0,0,0.2)\'" onmouseout="this.style.transform=\'\';this.style.boxShadow=\'\'">';
        html += '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px">';
        html += '<span style="font-weight:700;font-size:13px;color:#fff">' + g.symbol + '</span>';
        html += '<span style="font-weight:700;font-size:13px;color:' + chgColor + '">' + (chg >= 0 ? '+' : '') + chg.toFixed(1) + '%</span>';
        html += '</div>';
        html += '<div style="display:flex;justify-content:space-between;font-size:11px;color:var(--dim)">';
        html += '<span>$' + g.price.toFixed(prDec) + '</span>';
        html += '<span>Vol: $' + formatLargeNum(g.vol_24h_usd) + '</span>';
        html += '</div>';
        // Mini bar showing position in daily range
        if (g.high_24h > g.low_24h) {
          var rangePos = ((g.price - g.low_24h) / (g.high_24h - g.low_24h)) * 100;
          html += '<div style="margin-top:4px;height:3px;background:rgba(255,255,255,0.06);border-radius:2px;position:relative">';
          html += '<div style="position:absolute;left:0;top:0;height:100%;width:' + rangePos.toFixed(0) + '%;background:' + chgColor + ';border-radius:2px;opacity:0.6"></div>';
          html += '</div>';
        }
        html += '</div>';
      }
      grid.innerHTML = html;
    }

    function renderPulseTrending(trending, cgGainers) {
      var el = document.getElementById('pulse-trending');
      if (!el) return;

      // Combine trending + CG gainers, remove duplicates, show chips
      var seen = {};
      var items = [];

      if (trending) {
        for (var i = 0; i < trending.length; i++) {
          var t = trending[i];
          if (seen[t.symbol]) continue;
          seen[t.symbol] = true;
          items.push({ symbol: t.symbol, name: t.name, chg: t.chg_24h, on_kraken: t.on_kraken, type: 'trending', rank: t.trending_rank });
        }
      }
      if (cgGainers) {
        for (var j = 0; j < Math.min(cgGainers.length, 10); j++) {
          var g = cgGainers[j];
          if (seen[g.symbol]) continue;
          seen[g.symbol] = true;
          if (g.chg_24h > 0) {
            items.push({ symbol: g.symbol, name: g.name, chg: g.chg_24h, on_kraken: g.on_kraken, type: 'gainer', vol: g.vol_24h });
          }
        }
      }

      if (items.length === 0) {
        el.innerHTML = '<span style="color:var(--dim);font-size:12px">No trending data available</span>';
        return;
      }

      var html = '';
      for (var k = 0; k < items.length; k++) {
        var item = items[k];
        var chg = parseFloat(item.chg) || 0;
        var chgStr = chg !== 0 ? (' ' + (chg >= 0 ? '+' : '') + chg.toFixed(1) + '%') : '';
        var chgColor = chg >= 0 ? 'var(--green)' : 'var(--red)';
        var krakenFlag = item.on_kraken ? ' <span title="Available on Kraken" style="font-size:10px">&#127464;&#127462;</span>' : '';
        var typeBadge = item.type === 'trending' ? '<span style="font-size:9px;color:var(--cyan)">#' + item.rank + '</span> ' : '';
        var borderCol = item.on_kraken ? 'rgba(114,66,200,0.3)' : 'var(--border)';
        var bgCol = item.on_kraken ? 'rgba(114,66,200,0.06)' : 'rgba(255,255,255,0.03)';

        html += '<div style="background:' + bgCol + ';border:1px solid ' + borderCol + ';border-radius:6px;padding:4px 10px;font-size:12px;display:flex;align-items:center;gap:4px">';
        html += typeBadge + '<strong style="color:#fff">' + item.symbol + '</strong>' + krakenFlag;
        if (chgStr) html += '<span style="color:' + chgColor + ';font-size:11px;font-weight:600">' + chgStr + '</span>';
        html += '</div>';
      }
      el.innerHTML = html;
    }

    function togglePulseLiveMode() {
      pulseLiveMode = !pulseLiveMode;
      var btn = document.getElementById('pulse-live-toggle');

      if (pulseLiveMode) {
        btn.innerHTML = '<span class="live-pulse"></span> Live Updates: ON';
        btn.style.background = 'rgba(34,197,94,0.15)';
        btn.style.color = '#22c55e';
        btn.style.borderColor = 'rgba(34,197,94,0.3)';
        loadMarketPulse(true);
        pulseLiveInterval = setInterval(function () { loadMarketPulse(true); }, 60000);
      } else {
        btn.innerHTML = 'Enable Live Updates (60s)';
        btn.style.background = 'rgba(255,255,255,0.05)';
        btn.style.color = 'var(--dim)';
        btn.style.borderColor = 'var(--border)';
        if (pulseLiveInterval) clearInterval(pulseLiveInterval);
        pulseLiveInterval = null;
      }
    }

    function formatLargeNum(n) {
      n = parseFloat(n) || 0;
      if (n >= 1000000000) return (n / 1000000000).toFixed(1) + 'B';
      if (n >= 1000000) return (n / 1000000).toFixed(1) + 'M';
      if (n >= 1000) return (n / 1000).toFixed(0) + 'K';
      return '' + Math.round(n);
    }

    // Load Market Pulse on page load
    loadMarketPulse(false);

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  KRAKEN RANKINGS ‚Äî Full ranked list of ALL Kraken meme coins (1-10)
    //  The primary "what should I buy right now?" view
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    var RANKED_API = '/findcryptopairs/api/meme_market_pulse.php';
    var rankingLiveMode = false;
    var rankingLiveInterval = null;

    function loadKrakenRankings(force) {
      var container = document.getElementById('kraken-rankings-list');
      if (!force && container) {
        container.innerHTML = '<div class="loading">Scanning all Kraken meme coins...</div>';
      }

      var url = RANKED_API + '?action=kraken_ranked' + (force ? '&force=1' : '') + '&_=' + Date.now();
      var x = new XMLHttpRequest();
      x.open('GET', url);
      x.onload = function () {
        try {
          var r = JSON.parse(x.responseText);
          if (!r.ok) {
            container.innerHTML = '<div style="color:var(--red);padding:16px">Error: ' + (r.error || 'Unknown') + '</div>';
            return;
          }
          renderKrakenRankings(r.rankings, r.total_coins);
          if (r.mood) renderPulseMood(r.mood);
          var ts = document.getElementById('ranking-last-updated');
          if (ts) ts.textContent = 'Updated: ' + new Date().toLocaleTimeString() + (r.cached ? ' (cached ' + r.cache_age_s + 's)' : ' (live)');
          var cc = document.getElementById('ranking-coin-count');
          if (cc) cc.textContent = r.total_coins + ' coins on Kraken';
          
          // Update scan stats
          if (r.scan_stats) {
            var ss = document.getElementById('scan-stats-bar');
            if (ss) ss.style.display = 'flex';
            var ssc = document.getElementById('scan-success-count');
            if (ssc) ssc.textContent = r.scan_stats.successful;
            var sst = document.getElementById('scan-total-count');
            if (sst) sst.textContent = r.scan_stats.configured;
            var ssp = document.getElementById('scan-coverage-pct');
            if (ssp) ssp.textContent = r.scan_stats.coverage_pct + '%';
          }

          // Also render top pick if rankings have it
          if (r.rankings && r.rankings.length > 0) {
            var topCoin = r.rankings[0];
            if (topCoin.rating_10 >= 6) {
              renderPulseTopPick(topCoin);
            } else {
              renderPulseTopPick({ available: false, reason: 'Best coin is only ' + topCoin.rating_10 + '/10 ‚Äî no strong buy signal right now' });
            }
          }
        } catch (e) {
          if (container) container.innerHTML = '<div style="color:var(--red);padding:16px">Error parsing response: ' + e.message + '</div>';
        }
      };
      x.onerror = function () {
        if (container) container.innerHTML = '<div style="color:var(--red);padding:16px">Network error ‚Äî check connection</div>';
      };
      x.send();
    }

    function renderKrakenRankings(rankings, total) {
      var container = document.getElementById('kraken-rankings-list');
      if (!container || !rankings) return;

      if (rankings.length === 0) {
        container.innerHTML = '<div style="text-align:center;padding:20px;color:var(--dim)">No Kraken meme data available. Try refreshing.</div>';
        return;
      }
      
      // Check for correlation warning and entry quality issues
      var topCoinsPoorEntry = 0;
      var topCoinsChecked = Math.min(5, rankings.length);
      for (var tc = 0; tc < topCoinsChecked; tc++) {
        var scores = rankings[tc].scores || {};
        if ((scores.entry_position || 0) <= 3) topCoinsPoorEntry++;
      }
      
      // Show/hide entry quality warning
      var entryWarn = document.getElementById('entry-quality-warning');
      if (entryWarn && topCoinsPoorEntry >= 3) {
        entryWarn.style.display = 'flex';
      } else if (entryWarn) {
        entryWarn.style.display = 'none';
      }

      var html = '<table class="scan-log-table" style="font-size:12px">';
      html += '<tr>';
      html += '<th style="width:30px">#</th>';
      html += '<th style="text-align:left">Coin</th>';
      html += '<th style="width:70px">Rating</th>';
      html += '<th style="text-align:left;width:90px">Signal</th>';
      html += '<th>Price</th>';
      html += '<th>24h</th>';
      html += '<th>Volume</th>';
      html += '<th>Mom</th><th>Vol</th><th>Buzz</th><th>Entry</th><th>Sprd</th>';
      html += '<th style="width:60px">Trade</th>';
      html += '</tr>';

      for (var i = 0; i < rankings.length; i++) {
        var c = rankings[i];
        var r10 = c.rating_10 || 1;
        var zone = c.rating_zone || 'quiet';
        var chg = parseFloat(c.chg_24h) || 0;
        var prDec = c.price >= 1 ? 4 : c.price >= 0.01 ? 6 : c.price >= 0.0001 ? 8 : 10;

        // Row styling by zone
        var rowBg = '';
        if (zone === 'strong_buy') rowBg = 'background:rgba(34,197,94,0.05);';
        else if (zone === 'warming_up') rowBg = 'background:rgba(245,158,11,0.03);';

        // Rating badge colors
        var ratingColor, ratingBg, ratingBorder;
        if (r10 >= 8) { ratingColor = '#22c55e'; ratingBg = 'rgba(34,197,94,0.15)'; ratingBorder = 'rgba(34,197,94,0.3)'; }
        else if (r10 >= 5) { ratingColor = '#f59e0b'; ratingBg = 'rgba(245,158,11,0.15)'; ratingBorder = 'rgba(245,158,11,0.3)'; }
        else { ratingColor = '#6b7280'; ratingBg = 'rgba(107,114,128,0.1)'; ratingBorder = 'rgba(107,114,128,0.2)'; }

        // Signal label
        var signalHtml = '';
        if (r10 >= 9) signalHtml = '<span style="color:#22c55e;font-weight:700;font-size:11px">EXCEPTIONAL</span>';
        else if (r10 >= 8) signalHtml = '<span style="color:#22c55e;font-weight:700;font-size:11px">STRONG BUY</span>';
        else if (r10 >= 7) signalHtml = '<span style="color:#86efac;font-weight:600;font-size:11px">BUY</span>';
        else if (r10 >= 6) signalHtml = '<span style="color:#fcd34d;font-weight:600;font-size:11px">LEAN BUY</span>';
        else if (r10 >= 5) signalHtml = '<span style="color:#f59e0b;font-size:11px">WARMING</span>';
        else if (r10 >= 4) signalHtml = '<span style="color:#9ca3af;font-size:11px">MILD</span>';
        else if (r10 >= 3) signalHtml = '<span style="color:#6b7280;font-size:11px">QUIET</span>';
        else signalHtml = '<span style="color:#4b5563;font-size:11px">DEAD</span>';

        var scores = c.scores || {};

        html += '<tr style="' + rowBg + '">';
        html += '<td style="color:var(--dim);font-size:11px">' + (i + 1) + '</td>';
        // Check if this is a v2.2 trending coin
        var trendingCoins = ['TOSHI','ME','KEEP','LRC','PEP','CAMP','SRM','ESP','SOSO','AZTEC'];
        var isNewTrending = trendingCoins.indexOf(c.symbol) >= 0;
        
        html += '<td style="text-align:left"><strong style="color:#fff;font-size:13px">' + c.symbol + '</strong>';
        if (isNewTrending) html += ' <span style="font-size:9px;color:#a855f7;background:rgba(168,85,247,0.15);padding:1px 4px;border-radius:3px;border:1px solid rgba(168,85,247,0.3)" title="New v2.2 trending coin from Kraken Explore">üî• NEW</span>';
        if (c.is_trending) html += ' <span style="font-size:9px;color:var(--cyan)" title="Trending on CoinGecko (+15 pts). This can change quickly.">üê∏ TREND</span>';
        if (c.chasing_warning) html += ' <span style="font-size:9px;color:#ef4444;background:rgba(239,68,68,0.15);padding:1px 4px;border-radius:3px;border:1px solid rgba(239,68,68,0.3)" title="Momentum is high but entry position is poor. You\'d be chasing the pump (-' + c.chasing_penalty + ' pts)">‚ö†Ô∏è CHASING</span>';
        if (c.pump_dump_risk === 'critical') html += ' <span style="font-size:9px;color:#ef4444;background:rgba(239,68,68,0.15);padding:1px 4px;border-radius:3px;border:1px solid rgba(239,68,68,0.3)" title="P&D signals: ' + (c.pump_dump_signals || []).join(', ') + '">‚ö†Ô∏è P&D</span>';
        else if (c.pump_dump_risk === 'elevated') html += ' <span style="font-size:9px;color:#f59e0b;background:rgba(245,158,11,0.1);padding:1px 4px;border-radius:3px;border:1px solid rgba(245,158,11,0.2)" title="P&D signal: ' + (c.pump_dump_signals || []).join(', ') + '">‚ö† RISK</span>';
        // Entry position warning for poor entries
        var entryScore = scores.entry_position || 0;
        if (entryScore <= 3 && !c.chasing_warning) html += ' <span style="font-size:9px;color:#f59e0b;background:rgba(245,158,11,0.1);padding:1px 4px;border-radius:3px;border:1px solid rgba(245,158,11,0.2)" title="Price is ' + (c.price_in_range_pct || 99) + '% up the daily range. Entry position: ' + entryScore + '/15">üìà HIGH</span>';
        html += '</td>';

        // Rating badge - big and prominent
        html += '<td><div style="display:inline-flex;align-items:center;justify-content:center;min-width:40px;padding:4px 10px;border-radius:6px;background:' + ratingBg + ';color:' + ratingColor + ';border:1px solid ' + ratingBorder + ';font-weight:800;font-size:16px">' + r10 + '<span style="font-size:10px;font-weight:400;opacity:0.7">/10</span></div></td>';

        html += '<td style="text-align:left">' + signalHtml + '</td>';
        html += '<td style="color:#fff;font-weight:600">$' + c.price.toFixed(prDec) + '</td>';
        html += '<td style="color:' + (chg >= 0 ? 'var(--green)' : 'var(--red)') + ';font-weight:600">' + (chg >= 0 ? '+' : '') + chg.toFixed(1) + '%</td>';
        html += '<td style="color:var(--dim)">$' + formatLargeNum(c.vol_24h_usd) + '</td>';

        // Factor mini-scores
        html += '<td>' + _ratingFactorCell(scores.momentum || 0, 35) + '</td>';
        html += '<td>' + _ratingFactorCell(scores.volume || 0, 25) + '</td>';
        html += '<td>' + _ratingFactorCell(scores.trending || 0, 15) + '</td>';
        html += '<td>' + _ratingFactorCell(scores.entry_position || 0, 15) + '</td>';
        html += '<td>' + _ratingFactorCell(scores.spread || 0, 10) + '</td>';

        // Trade + Audit buttons
        var symLower = c.symbol.toLowerCase();
        html += '<td style="white-space:nowrap;">';
        html += '<a href="https://pro.kraken.com/app/trade/' + symLower + '-usd" target="_blank" style="font-size:10px;padding:3px 8px;background:rgba(114,66,200,0.15);color:#9b7cdb;border:1px solid rgba(114,66,200,0.3);border-radius:4px;text-decoration:none;font-weight:600;margin-right:4px;">BUY</a>';
        html += '<button onclick="openAuditModal(\'' + c.symbol + '\', \'kraken\')" style="font-size:10px;padding:3px 6px;background:rgba(99,102,241,0.15);color:#818cf8;border:1px solid rgba(99,102,241,0.3);border-radius:4px;cursor:pointer;font-weight:600;" title="View audit trail for AI analysis">üîç</button>';
        html += '</td>';
        html += '</tr>';
      }
      html += '</table>';
      container.innerHTML = html;
    }

    function _ratingFactorCell(val, max) {
      var pct = max > 0 ? (val / max) : 0;
      var cls = pct >= 0.7 ? 'f-high' : pct >= 0.4 ? 'f-mid' : 'f-low';
      return '<span class="factor-cell ' + cls + '">' + val + '</span>';
    }

    function toggleRankingModel() {
      var el = document.getElementById('ranking-model-explain');
      if (el) el.style.display = el.style.display === 'none' ? 'block' : 'none';
    }

    function toggleRankingLiveMode() {
      rankingLiveMode = !rankingLiveMode;
      var btn = document.getElementById('ranking-live-toggle');
      if (rankingLiveMode) {
        btn.innerHTML = '<span class="live-pulse"></span> Auto-Refresh: ON';
        btn.style.background = 'rgba(34,197,94,0.15)';
        btn.style.color = '#22c55e';
        btn.style.borderColor = 'rgba(34,197,94,0.3)';
        loadKrakenRankings(true);
        rankingLiveInterval = setInterval(function () { loadKrakenRankings(true); }, 45000);
      } else {
        btn.innerHTML = 'Auto-Refresh (45s)';
        btn.style.background = 'rgba(255,255,255,0.05)';
        btn.style.color = 'var(--dim)';
        btn.style.borderColor = 'var(--border)';
        if (rankingLiveInterval) clearInterval(rankingLiveInterval);
        rankingLiveInterval = null;
      }
    }

    // Load Kraken Rankings on page load (the primary view)
    loadKrakenRankings(false);
  </script>
  <script src="/findstocks/portfolio2/stock-nav.js"></script>
  <script src="/live-monitor/api/scope_labels.js"></script>
</body>

</html>