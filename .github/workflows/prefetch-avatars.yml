name: Prefetch Creator Avatars

on:
  schedule:
    # Run daily at 6:00 AM UTC (1:00 AM EST)
    - cron: '0 6 * * *'
  workflow_dispatch:  # Allow manual trigger

jobs:
  prefetch-avatars:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Run avatar prefetch
      env:
        FC_API_BASE: 'https://findtorontoevents.ca/fc'
        AVATAR_CACHE_TOKEN: ${{ secrets.AVATAR_CACHE_TOKEN }}
        AVATAR_MAX_CREATORS: '200'
      run: |
        python .github/scripts/prefetch_avatars.py

    - name: Upload results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: avatar-prefetch-results
        path: avatar_prefetch_results.json
        retention-days: 7
